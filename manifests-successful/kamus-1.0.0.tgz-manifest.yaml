---
# Source: kamus/templates/serviceaccount-controller.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: kamus-controller
---
# Source: kamus/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: kamus
---
# Source: kamus/templates/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: kamus
type: Opaque
data:
  appsettings.secrets.json: CnsKCiJLZXlNYW5hZ2VtZW50IjogeyAKCQkiQUVTIjogeyAiS2V5IjogInJXbldiYUZ1dGF2ZG9lcVVpVllNTkpHdm1qUWgzMXFhSWVqL3ZBeEo5RzA9IiB9IH19
---
# Source: kamus/templates/configmap-controller.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: kamus-controller
data:
  KeyManagement__Provider: AESKey
  KeyManagement__AES__UseKeyDeriviation: "false"
  Controller__ReconciliationIntervalInSeconds: "60"
---
# Source: kamus/templates/configmap-decryptor.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: kamus-decryptor
data:
  KeyManagement__Provider: AESKey
  KeyManagement__AES__UseKeyDeriviation: "false"
---
# Source: kamus/templates/configmap-encryptor.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: kamus-encryptor
data:
  KeyManagement__Provider: AESKey
  KeyManagement__AES__UseKeyDeriviation: "false"
---
# Source: kamus/templates/kamussecret-crd.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  # name must match the spec fields below, and be in the form: <plural>.<group>
  name: kamussecrets.soluto.com
spec:
  # group name to use for REST API: /apis/<group>/<version>
  group: soluto.com
  # version name to use for REST API: /apis/<group>/<version>
  versions:
  - name: v1alpha2
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          data:
            type: object
            additionalProperties: true
          stringData:
            type: object
            additionalProperties: true
          serviceAccount: 
            type: string
          type:
            type: string
          propagateAnnotations:
            type: boolean
  # either Namespaced or Cluster
  scope: Namespaced
  names:
    # plural name to be used in the URL: /apis/<group>/<version>/<plural>
    plural: kamussecrets
    # singular name to be used as an alias on the CLI and for display
    singular: kamussecret
    # kind is normally the CamelCased singular type. Your resource manifests use this.
    kind: KamusSecret
    # shortNames allow shorter string to match your resource on the CLI
    shortNames:
     - ks
---
# Source: kamus/templates/clusterrole-controller.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: kamus-controller
rules:
- apiGroups: ["soluto.com"] # "" indicates the core API group
  resources: ["kamussecrets"]
  verbs: ["watch"]
- apiGroups: ["soluto.com"]
  resources: ["kamussecrets/finalizers"]
  verbs: ["update"]
- apiGroups: [""] # "" indicates the core API group
  resources: ["secrets"]
  verbs: ["create", "delete", "patch"]
---
# Source: kamus/templates/clusterrole.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: kamus
rules:
- apiGroups: ["authentication.k8s.io"]
  resources: ["tokenreviews"]
  verbs: ["create"]
---
# Source: kamus/templates/clusterrolebinding-controller.yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: kamus-controller
subjects:
- kind: ServiceAccount
  name: kamus-controller
  namespace: kamus-1.0.0.tgz
roleRef:
  kind: ClusterRole
  name: kamus-controller
  apiGroup: rbac.authorization.k8s.io
---
# Source: kamus/templates/clusterrolebinding.yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: kamus
subjects:
- kind: ServiceAccount
  name: kamus
  namespace: kamus-1.0.0.tgz
roleRef:
  kind: ClusterRole
  name: kamus
  apiGroup: rbac.authorization.k8s.io
---
# Source: kamus/templates/service-controller.yaml
apiVersion: v1
kind: Service
metadata:
  name: kamus-controller
  annotations:
    prometheus.io/scrape: "true"
  labels:
    app: kamus
    component: controller
    chart: kamus-1.0.0
    release: my-release
    heritage: Helm
spec:
  type: ClusterIP
  ports:
    - port: 443
      targetPort: 8888
      protocol: TCP
      name: kamus-controller

  selector:
    app: kamus
    component: controller
    release: my-release
---
# Source: kamus/templates/service-decryptor.yaml
apiVersion: v1
kind: Service
metadata:
  name: kamus-decryptor
  annotations:
    prometheus.io/scrape: "true"
  labels:
    app: kamus
    component: decryptor
    chart: kamus-1.0.0
    release: my-release
    heritage: Helm
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: 9999
      protocol: TCP
      name: kamus-decryptor
  selector:
    app: kamus
    component: decryptor
    release: my-release
---
# Source: kamus/templates/service-encryptor.yaml
apiVersion: v1
kind: Service
metadata:
  name: kamus-encryptor
  annotations:
    prometheus.io/scrape: "true"
  labels:
    app: kamus
    component: encryptor
    chart: kamus-1.0.0
    release: my-release
    heritage: Helm
spec:
  type: ClusterIP
  ports:
    - port: 80 
      targetPort: 9999
      protocol: TCP
      name: kamus-encryptor
  selector:
    app: kamus
    component: encryptor
    release: my-release
---
# Source: kamus/templates/deployment-controller.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kamus-controller
  labels:
    app: kamus
    component: controller
    chart: kamus-1.0.0
    release: my-release
    heritage: Helm
spec:
  strategy:
    rollingUpdate:
      maxUnavailable: 0
  replicas: 1
  selector:
      matchLabels:
        app: kamus
        release: my-release
        component: controller
  template:
    metadata:
      annotations:
        checksum/config: ca9541ec4bb053e9617ded5f8a9a441ffefe8685da2f8922bde19c5b3e9f29a1
        checksum/secret: ee4c8b9698d6c782497c64eaa785505899f2451f097b3d55783030d5f6825524
      labels:
        app: kamus
        release: my-release
        component: controller
    spec:
      serviceAccountName: kamus-controller
      automountServiceAccountToken: true
      containers:
        - name: controller
          image: ghcr.io/soluto/kamus:controller-0.9.0.7
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: secret-volume
              mountPath: /home/dotnet/app/secrets
          livenessProbe:
            httpGet:
              path: /healthz
              port: 9999
          readinessProbe:
            httpGet:
              path: /healthz
              port: 9999
          resources:
            limits:
              cpu: 500m
              memory: 600Mi
            requests:
              cpu: 100m
              memory: 128Mi
          envFrom:
           - configMapRef:
              name: kamus-controller
      volumes:
        - name: secret-volume
          secret:
            secretName: kamus
---
# Source: kamus/templates/deployment-decryptor.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kamus-decryptor
  labels:
    app: kamus
    component: decryptor
    chart: kamus-1.0.0
    release: my-release
    heritage: Helm
spec:
  strategy:
    rollingUpdate:
      maxUnavailable: 0
  replicas: 1
  selector:
      matchLabels:
        app: kamus
        release: my-release
        component: decryptor
  template:
    metadata:
      annotations:
        checksum/config: e00ae16334b15414fe1a9aeb1f978419d2e1e7ec4df0c7e0645ccf7f52730e65
        checksum/secret: ee4c8b9698d6c782497c64eaa785505899f2451f097b3d55783030d5f6825524
      labels:
        app: kamus
        release: my-release
        component: decryptor
    spec:
      serviceAccountName: kamus
      automountServiceAccountToken: true
      containers:
        - name: decryptor-api
          image: ghcr.io/soluto/kamus:decryptor-0.9.0.7
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: secret-volume
              mountPath: /home/dotnet/app/secrets
          ports:
            - containerPort: 9999
          livenessProbe:
            httpGet:
              path: /api/v1/isAlive
              port: 9999
          readinessProbe:
            httpGet:
              path: /api/v1/isAlive
              port: 9999
          resources:
            limits:
              cpu: 500m
              memory: 600Mi
            requests:
              cpu: 100m
              memory: 128Mi
          envFrom:
           - configMapRef:
              name: kamus-decryptor
      volumes:
        - name: secret-volume
          secret:
            secretName: kamus
---
# Source: kamus/templates/deployment-encryptor.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kamus-encryptor
  labels:
    app: kamus
    component: encryptor
    chart: kamus-1.0.0
    release: my-release
    heritage: Helm
spec:
  strategy:
    rollingUpdate:
      maxUnavailable: 0
  replicas: 1
  selector:
    matchLabels:
      app: kamus
      component: encryptor
      release: my-release
  template:
    metadata:
      annotations:
        checksum/config: cd5914f256e6ebaf19e73716f990051113e9a8ffd5bc22f60c14189b891aa7da
        checksum/secret: ee4c8b9698d6c782497c64eaa785505899f2451f097b3d55783030d5f6825524
      labels:
        app: kamus
        component: encryptor
        release: my-release
    spec:
      serviceAccountName: kamus
      automountServiceAccountToken: false
      containers:
        - name: encryptor-api
          image: ghcr.io/soluto/kamus:encryptor-0.9.0.7
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: secret-volume
              mountPath: /home/dotnet/app/secrets
          ports:
            - containerPort: 9999
          livenessProbe:
            httpGet:
              path: /api/v1/isAlive
              port: 9999
          readinessProbe:
            httpGet:
              path: /api/v1/isAlive
              port: 9999
          resources:
            limits:
              cpu: 500m
              memory: 600Mi
            requests:
              cpu: 100m
              memory: 128Mi
          envFrom:
           - configMapRef:
              name: kamus-encryptor


        
      volumes:
        - name: secret-volume
          secret:
            secretName: kamus
---
# Source: kamus/templates/autoscaling-decryptor.yaml
apiVersion: autoscaling/v1
kind: HorizontalPodAutoscaler
metadata:
  name: kamus-decryptor
  labels:
    app: kamus
    component: decryptor
    chart: kamus-1.0.0
    release: my-release
    heritage: Helm
spec:
  scaleTargetRef:
    apiVersion: apps/v1beta1
    kind: Deployment
    name: kamus-decryptor
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 50
---
# Source: kamus/templates/autoscaling-encryptor.yaml
apiVersion: autoscaling/v1
kind: HorizontalPodAutoscaler
metadata:
  name: kamus-encryptor
  labels:
    app: kamus
    component: encryptor
    chart: kamus-1.0.0
    release: my-release
    heritage: Helm
spec:
  scaleTargetRef:
    apiVersion: apps/v1beta1
    kind: Deployment
    name: kamus-encryptor
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 50
