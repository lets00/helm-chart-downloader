---
# Source: altinity-clickhouse-operator/templates/generated/ServiceAccount-clickhouse-operator.yaml
# Template Parameters:
#
# COMMENT=
# NAMESPACE=kube-system
# NAME=clickhouse-operator
#
# Setup ServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-release-altinity-clickhouse-operator
  namespace: altinity-clickhouse-operator-0.23.5.tgz
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
  annotations: 
    {}

# Template Parameters:
#
# NAMESPACE=kube-system
# COMMENT=#
# ROLE_KIND=ClusterRole
# ROLE_NAME=clickhouse-operator-kube-system
# ROLE_BINDING_KIND=ClusterRoleBinding
# ROLE_BINDING_NAME=clickhouse-operator-kube-system
#
---
# Source: altinity-clickhouse-operator/templates/generated/Secret-clickhouse-operator.yaml
#
# Template parameters available:
#   NAMESPACE=kube-system
#   COMMENT=
#   OPERATOR_VERSION=0.23.5
#   CH_USERNAME_SECRET_PLAIN=clickhouse_operator
#   CH_PASSWORD_SECRET_PLAIN=clickhouse_operator_password
#
apiVersion: v1
kind: Secret
metadata:
  name: my-release-altinity-clickhouse-operator
  namespace: altinity-clickhouse-operator-0.23.5.tgz
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  username: Y2xpY2tob3VzZV9vcGVyYXRvcg==
  password: Y2xpY2tob3VzZV9vcGVyYXRvcl9wYXNzd29yZA==
---
# Source: altinity-clickhouse-operator/templates/generated/ConfigMap-etc-clickhouse-operator-confd-files.yaml
# Template Parameters:
#
# NAME=etc-clickhouse-operator-confd-files
# NAMESPACE=kube-system
# COMMENT=
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-altinity-clickhouse-operator-confd-files
  namespace: altinity-clickhouse-operator-0.23.5.tgz
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
data: 
  null
---
# Source: altinity-clickhouse-operator/templates/generated/ConfigMap-etc-clickhouse-operator-configd-files.yaml
# Template Parameters:
#
# NAME=etc-clickhouse-operator-configd-files
# NAMESPACE=kube-system
# COMMENT=
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-altinity-clickhouse-operator-configd-files
  namespace: altinity-clickhouse-operator-0.23.5.tgz
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
data: 
  01-clickhouse-01-listen.xml: |
    <!-- IMPORTANT -->
    <!-- This file is auto-generated -->
    <!-- Do not edit this file - all changes would be lost -->
    <!-- Edit appropriate template in the following folder: -->
    <!-- deploy/builder/templates-config -->
    <!-- IMPORTANT -->
    <yandex>
        <!-- Listen wildcard address to allow accepting connections from other containers and host network. -->
        <listen_host>::</listen_host>
        <listen_host>0.0.0.0</listen_host>
        <listen_try>1</listen_try>
    </yandex>
  01-clickhouse-02-logger.xml: |
    <!-- IMPORTANT -->
    <!-- This file is auto-generated -->
    <!-- Do not edit this file - all changes would be lost -->
    <!-- Edit appropriate template in the following folder: -->
    <!-- deploy/builder/templates-config -->
    <!-- IMPORTANT -->
    <yandex>
        <logger>
            <!-- Possible levels: https://github.com/pocoproject/poco/blob/devel/Foundation/include/Poco/Logger.h#L439 -->
            <level>debug</level>
            <log>/var/log/clickhouse-server/clickhouse-server.log</log>
            <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
            <size>1000M</size>
            <count>10</count>
            <!-- Default behavior is autodetection (log to console if not daemon mode and is tty) -->
            <console>1</console>
        </logger>
    </yandex>
  01-clickhouse-03-query_log.xml: |
    <!-- IMPORTANT -->
    <!-- This file is auto-generated -->
    <!-- Do not edit this file - all changes would be lost -->
    <!-- Edit appropriate template in the following folder: -->
    <!-- deploy/builder/templates-config -->
    <!-- IMPORTANT -->
    <yandex>
        <query_log replace="1">
            <database>system</database>
            <table>query_log</table>
            <engine>Engine = MergeTree PARTITION BY event_date ORDER BY event_time TTL event_date + interval 30 day</engine>
            <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        </query_log>
        <query_thread_log remove="1"/>
    </yandex>
  01-clickhouse-04-part_log.xml: |
    <!-- IMPORTANT -->
    <!-- This file is auto-generated -->
    <!-- Do not edit this file - all changes would be lost -->
    <!-- Edit appropriate template in the following folder: -->
    <!-- deploy/builder/templates-config -->
    <!-- IMPORTANT -->
    <yandex>
        <part_log replace="1">
            <database>system</database>
            <table>part_log</table>
            <engine>Engine = MergeTree PARTITION BY event_date ORDER BY event_time TTL event_date + interval 30 day</engine>
            <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        </part_log>
    </yandex>
  01-clickhouse-05-trace_log.xml: |-
    <!-- IMPORTANT -->
    <!-- This file is auto-generated -->
    <!-- Do not edit this file - all changes would be lost -->
    <!-- Edit appropriate template in the following folder: -->
    <!-- deploy/builder/templates-config -->
    <!-- IMPORTANT -->
    <yandex>
        <trace_log replace="1">
            <database>system</database>
            <table>trace_log</table>
            <engine>Engine = MergeTree PARTITION BY event_date ORDER BY event_time TTL event_date + interval 30 day</engine>
            <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        </trace_log>
    </yandex>
---
# Source: altinity-clickhouse-operator/templates/generated/ConfigMap-etc-clickhouse-operator-files.yaml
# Template Parameters:
#
# NAME=etc-clickhouse-operator-files
# NAMESPACE=kube-system
# COMMENT=
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-altinity-clickhouse-operator-files
  namespace: altinity-clickhouse-operator-0.23.5.tgz
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
data: 
  config.yaml: |-
    annotation:
      exclude: []
      include: []
    clickhouse:
      access:
        password: ""
        port: 8123
        rootCA: ""
        scheme: auto
        secret:
          name: 'my-release-altinity-clickhouse-operator'
          namespace: ""
        timeouts:
          connect: 1
          query: 4
        username: ""
      configuration:
        file:
          path:
            common: config.d
            host: conf.d
            user: users.d
        network:
          hostRegexpTemplate: (chi-{chi}-[^.]+\d+-\d+|clickhouse\-{chi})\.{namespace}\.svc\.cluster\.local$
        user:
          default:
            networksIP:
            - ::1
            - 127.0.0.1
            password: default
            profile: default
            quota: default
      configurationRestartPolicy:
        rules:
        - rules:
          - settings/*: "yes"
          - settings/access_control_path: "no"
          - settings/dictionaries_config: "no"
          - settings/max_server_memory_*: "no"
          - settings/max_*_to_drop: "no"
          - settings/max_concurrent_queries: "no"
          - settings/models_config: "no"
          - settings/user_defined_executable_functions_config: "no"
          - settings/logger/*: "no"
          - settings/macros/*: "no"
          - settings/remote_servers/*: "no"
          - settings/user_directories/*: "no"
          - zookeeper/*: "yes"
          - files/*.xml: "yes"
          - files/config.d/*.xml: "yes"
          - files/config.d/*dict*.xml: "no"
          - profiles/default/background_*_pool_size: "yes"
          - profiles/default/max_*_for_server: "yes"
          version: '*'
        - rules:
          - settings/logger: "yes"
          version: 21.*
      metrics:
        timeouts:
          collect: 9
    label:
      appendScope: "no"
      exclude: []
      include: []
    logger:
      alsologtostderr: "false"
      log_backtrace_at: ""
      logtostderr: "true"
      stderrthreshold: ""
      v: "1"
      vmodule: ""
    pod:
      terminationGracePeriod: 30
    reconcile:
      host:
        wait:
          exclude: true
          include: false
          queries: true
      runtime:
        reconcileCHIsThreadsNumber: 10
        reconcileShardsMaxConcurrencyPercent: 50
        reconcileShardsThreadsNumber: 5
      statefulSet:
        create:
          onFailure: ignore
        update:
          onFailure: abort
          pollInterval: 5
          timeout: 300
    statefulSet:
      revisionHistoryLimit: 0
    template:
      chi:
        path: templates.d
        policy: ApplyOnNextReconcile
    watch:
      namespaces: []
---
# Source: altinity-clickhouse-operator/templates/generated/ConfigMap-etc-clickhouse-operator-templatesd-files.yaml
# Template Parameters:
#
# NAME=etc-clickhouse-operator-templatesd-files
# NAMESPACE=kube-system
# COMMENT=
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-altinity-clickhouse-operator-templatesd-files
  namespace: altinity-clickhouse-operator-0.23.5.tgz
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
data: 
  001-templates.json.example: |
    {
      "apiVersion": "clickhouse.altinity.com/v1",
      "kind": "ClickHouseInstallationTemplate",
      "metadata": {
        "name": "01-default-volumeclaimtemplate"
      },
      "spec": {
        "templates": {
          "volumeClaimTemplates": [
            {
              "name": "chi-default-volume-claim-template",
              "spec": {
                "accessModes": [
                  "ReadWriteOnce"
                ],
                "resources": {
                  "requests": {
                    "storage": "2Gi"
                  }
                }
              }
            }
          ],
          "podTemplates": [
            {
              "name": "chi-default-oneperhost-pod-template",
              "distribution": "OnePerHost",
              "spec": {
                "containers" : [
                  {
                    "name": "clickhouse",
                    "image": "clickhouse/clickhouse-server:23.8",
                    "ports": [
                      {
                        "name": "http",
                        "containerPort": 8123
                      },
                      {
                        "name": "client",
                        "containerPort": 9000
                      },
                      {
                        "name": "interserver",
                        "containerPort": 9009
                      }
                    ]
                  }
                ]
              }
            }
          ]
        }
      }
    }
  default-pod-template.yaml.example: |
    apiVersion: "clickhouse.altinity.com/v1"
    kind: "ClickHouseInstallationTemplate"
    metadata:
      name: "default-oneperhost-pod-template"
    spec:
      templates:
        podTemplates:
          - name: default-oneperhost-pod-template
            distribution: "OnePerHost"
  default-storage-template.yaml.example: |
    apiVersion: "clickhouse.altinity.com/v1"
    kind: "ClickHouseInstallationTemplate"
    metadata:
      name: "default-storage-template-2Gi"
    spec:
      templates:
        volumeClaimTemplates:
          - name: default-storage-template-2Gi
            spec:
              accessModes:
                - ReadWriteOnce
              resources:
                requests:
                  storage: 2Gi
  readme: Templates in this folder are packaged with an operator and available via 'useTemplate'
---
# Source: altinity-clickhouse-operator/templates/generated/ConfigMap-etc-clickhouse-operator-usersd-files.yaml
# Template Parameters:
#
# NAME=etc-clickhouse-operator-usersd-files
# NAMESPACE=kube-system
# COMMENT=
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-altinity-clickhouse-operator-usersd-files
  namespace: altinity-clickhouse-operator-0.23.5.tgz
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
data: 
  01-clickhouse-operator-profile.xml: |
    <!-- IMPORTANT -->
    <!-- This file is auto-generated -->
    <!-- Do not edit this file - all changes would be lost -->
    <!-- Edit appropriate template in the following folder: -->
    <!-- deploy/builder/templates-config -->
    <!-- IMPORTANT -->
    <!--
    #
    # Template parameters available:
    #
    -->
    <yandex>
        <!-- clickhouse-operator user is generated by the operator based on config.yaml in runtime -->
        <profiles>
            <clickhouse_operator>
                <log_queries>0</log_queries>
                <skip_unavailable_shards>1</skip_unavailable_shards>
                <http_connection_timeout>10</http_connection_timeout>
                <max_concurrent_queries_for_all_users>0</max_concurrent_queries_for_all_users>
                <os_thread_priority>0</os_thread_priority>
            </clickhouse_operator>
        </profiles>
    </yandex>
  02-clickhouse-default-profile.xml: |-
    <!-- IMPORTANT -->
    <!-- This file is auto-generated -->
    <!-- Do not edit this file - all changes would be lost -->
    <!-- Edit appropriate template in the following folder: -->
    <!-- deploy/builder/templates-config -->
    <!-- IMPORTANT -->
    <yandex>
      <profiles>
        <default>
          <os_thread_priority>2</os_thread_priority>
          <log_queries>1</log_queries>
          <connect_timeout_with_failover_ms>1000</connect_timeout_with_failover_ms>
          <distributed_aggregation_memory_efficient>1</distributed_aggregation_memory_efficient>
          <parallel_view_processing>1</parallel_view_processing>
          <do_not_merge_across_partitions_select_final>1</do_not_merge_across_partitions_select_final>
          <load_balancing>nearest_hostname</load_balancing>
          <prefer_localhost_replica>0</prefer_localhost_replica>
          <!-- materialize_ttl_recalculate_only>1</materialize_ttl_recalculate_only> 21.10 and above -->
        </default>
      </profiles>
    </yandex>
---
# Source: altinity-clickhouse-operator/templates/generated/ClusterRole-clickhouse-operator-kube-system.yaml
# Specifies either
#   ClusterRole
# or
#   Role
# to be bound to ServiceAccount.
# ClusterRole is namespace-less and must have unique name
# Role is namespace-bound
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: my-release-altinity-clickhouse-operator
  #namespace: kube-system
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
  namespace: altinity-clickhouse-operator-0.23.5.tgz
rules:
  #
  # Core API group
  #
  - apiGroups:
      - ""
    resources:
      - configmaps
      - services
      - persistentvolumeclaims
      - secrets
    verbs:
      - get
      - list
      - patch
      - update
      - watch
      - create
      - delete
  - apiGroups:
      - ""
    resources:
      - endpoints
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      - create
  - apiGroups:
      - ""
    resources:
      - persistentvolumes
    verbs:
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - ""
    resources:
      - pods
    verbs:
      - get
      - list
      - patch
      - update
      - watch
      - delete
  - apiGroups:
      - ""
    resources:
      - secrets
    verbs:
      - get
      - list
  #
  # apps.* resources
  #
  - apiGroups:
      - apps
    resources:
      - statefulsets
    verbs:
      - get
      - list
      - patch
      - update
      - watch
      - create
      - delete
  - apiGroups:
      - apps
    resources:
      - replicasets
    verbs:
      - get
      - patch
      - update
      - delete
  # The operator deployment personally, identified by name
  - apiGroups:
      - apps
    resources:
      - deployments
    resourceNames:
      - my-release-altinity-clickhouse-operator
    verbs:
      - get
      - patch
      - update
      - delete
  #
  # policy.* resources
  #
  - apiGroups:
      - policy
    resources:
      - poddisruptionbudgets
    verbs:
      - get
      - list
      - patch
      - update
      - watch
      - create
      - delete
  #
  # apiextensions
  #
  - apiGroups:
      - apiextensions.k8s.io
    resources:
      - customresourcedefinitions
    verbs:
      - get
      - list
  # clickhouse - related resources
  - apiGroups:
      - clickhouse.altinity.com
    #
    # The operators specific Custom Resources
    #

    resources:
      - clickhouseinstallations
    verbs:
      - get
      - list
      - watch
      - patch
      - update
      - delete
  - apiGroups:
      - clickhouse.altinity.com
    resources:
      - clickhouseinstallationtemplates
      - clickhouseoperatorconfigurations
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - clickhouse.altinity.com
    resources:
      - clickhouseinstallations/finalizers
      - clickhouseinstallationtemplates/finalizers
      - clickhouseoperatorconfigurations/finalizers
    verbs:
      - update
  - apiGroups:
      - clickhouse.altinity.com
    resources:
      - clickhouseinstallations/status
      - clickhouseinstallationtemplates/status
      - clickhouseoperatorconfigurations/status
    verbs:
      - get
      - update
      - patch
      - create
      - delete
  # clickhouse-keeper - related resources
  - apiGroups:
      - clickhouse-keeper.altinity.com
    resources:
      - clickhousekeeperinstallations
    verbs:
      - get
      - list
      - watch
      - patch
      - update
      - delete
  - apiGroups:
      - clickhouse-keeper.altinity.com
    resources:
      - clickhousekeeperinstallations/finalizers
    verbs:
      - update
  - apiGroups:
      - clickhouse-keeper.altinity.com
    resources:
      - clickhousekeeperinstallations/status
    verbs:
      - get
      - update
      - patch
      - create
      - delete
---
# Source: altinity-clickhouse-operator/templates/generated/ClusterRoleBinding-clickhouse-operator-kube-system.yaml
# Specifies either
#   ClusterRoleBinding between ClusterRole and ServiceAccount.
# or
#   RoleBinding between Role and ServiceAccount.
# ClusterRoleBinding is namespace-less and must have unique name
# RoleBinding is namespace-bound
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: my-release-altinity-clickhouse-operator
  #namespace: kube-system
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
  namespace: altinity-clickhouse-operator-0.23.5.tgz
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: my-release-altinity-clickhouse-operator
subjects:
  - kind: ServiceAccount
    name: my-release-altinity-clickhouse-operator
    namespace: altinity-clickhouse-operator-0.23.5.tgz
---
# Source: altinity-clickhouse-operator/templates/generated/Service-clickhouse-operator-metrics.yaml
# Template Parameters:
#
# NAMESPACE=kube-system
# COMMENT=
#
# Setup ClusterIP Service to provide monitoring metrics for Prometheus
# Service would be created in kubectl-specified namespace
# In order to get access outside of k8s it should be exposed as:
# kubectl --namespace prometheus port-forward service/prometheus 9090
# and point browser to localhost:9090
kind: Service
apiVersion: v1
metadata:
  name: my-release-altinity-clickhouse-operator-metrics
  namespace: altinity-clickhouse-operator-0.23.5.tgz
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
spec:
  ports:
    - port: 8888
      name: clickhouse-metrics
    - port: 9999
      name: operator-metrics
  selector: 
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
---
# Source: altinity-clickhouse-operator/templates/generated/Deployment-clickhouse-operator.yaml
# Template Parameters:
#
# NAMESPACE=kube-system
# COMMENT=
# OPERATOR_IMAGE=altinity/clickhouse-operator:0.23.5
# OPERATOR_IMAGE_PULL_POLICY=Always
# METRICS_EXPORTER_IMAGE=altinity/metrics-exporter:0.23.5
# METRICS_EXPORTER_IMAGE_PULL_POLICY=Always
#
# Setup Deployment for clickhouse-operator
# Deployment would be created in kubectl-specified namespace
kind: Deployment
apiVersion: apps/v1
metadata:
  name: my-release-altinity-clickhouse-operator
  namespace: altinity-clickhouse-operator-0.23.5.tgz
  labels: 
    helm.sh/chart: altinity-clickhouse-operator-0.23.5
    app.kubernetes.io/name: altinity-clickhouse-operator
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "0.23.5"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels: 
      app.kubernetes.io/name: altinity-clickhouse-operator
      app.kubernetes.io/instance: my-release
  template:
    metadata:
      labels: 
        helm.sh/chart: altinity-clickhouse-operator-0.23.5
        app.kubernetes.io/name: altinity-clickhouse-operator
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/version: "0.23.5"
        app.kubernetes.io/managed-by: Helm
      annotations:
        
        clickhouse-operator-metrics/port: "9999"
        clickhouse-operator-metrics/scrape: "true"
        prometheus.io/port: "8888"
        prometheus.io/scrape: "true"
        checksum/files: 2d3e472630a9e071a877eebbb71b7af5cc3c956257348ef2e4e5ef1c042d92c1
        checksum/confd-files: d0dff12666cad4471693e400c82c2df1749d28aad996b8ac78f29f24c90f0814
        checksum/configd-files: ed5b0a24dcaaf0f8cae0446221bcb19d0f84ad2d69a9049b9840e1da10839a16
        checksum/templatesd-files: d2b49cb654ffc82bb443496d9d63ebdc7f1092a049c089efc1914ef39a137a94
        checksum/usersd-files: d2ce92cd171ca5cc4124ccacaa0b38d0e9534067ccec00db6167ac9efcb8dda6
    spec:
      serviceAccountName: my-release-altinity-clickhouse-operator
      volumes:
        - name: etc-clickhouse-operator-folder
          configMap:
            name: my-release-altinity-clickhouse-operator-files
        - name: etc-clickhouse-operator-confd-folder
          configMap:
            name: my-release-altinity-clickhouse-operator-confd-files
        - name: etc-clickhouse-operator-configd-folder
          configMap:
            name: my-release-altinity-clickhouse-operator-configd-files
        - name: etc-clickhouse-operator-templatesd-folder
          configMap:
            name: my-release-altinity-clickhouse-operator-templatesd-files
        - name: etc-clickhouse-operator-usersd-folder
          configMap:
            name: my-release-altinity-clickhouse-operator-usersd-files
      containers:
        - name: altinity-clickhouse-operator
          image: altinity/clickhouse-operator:0.23.5
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: etc-clickhouse-operator-folder
              mountPath: /etc/clickhouse-operator
            - name: etc-clickhouse-operator-confd-folder
              mountPath: /etc/clickhouse-operator/conf.d
            - name: etc-clickhouse-operator-configd-folder
              mountPath: /etc/clickhouse-operator/config.d
            - name: etc-clickhouse-operator-templatesd-folder
              mountPath: /etc/clickhouse-operator/templates.d
            - name: etc-clickhouse-operator-usersd-folder
              mountPath: /etc/clickhouse-operator/users.d
          env:
            # Pod-specific
            # spec.nodeName: ip-172-20-52-62.ec2.internal
            - name: OPERATOR_POD_NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            # metadata.name: clickhouse-operator-6f87589dbb-ftcsf
            - name: OPERATOR_POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            # metadata.namespace: kube-system
            - name: OPERATOR_POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            # status.podIP: 100.96.3.2
            - name: OPERATOR_POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            # spec.serviceAccount: clickhouse-operator
            # spec.serviceAccountName: clickhouse-operator
            - name: OPERATOR_POD_SERVICE_ACCOUNT
              valueFrom:
                fieldRef:
                  fieldPath: spec.serviceAccountName
            # Container-specific
            - name: OPERATOR_CONTAINER_CPU_REQUEST
              valueFrom:
                resourceFieldRef:
                  containerName: altinity-clickhouse-operator
                  resource: requests.cpu
            - name: OPERATOR_CONTAINER_CPU_LIMIT
              valueFrom:
                resourceFieldRef:
                  containerName: altinity-clickhouse-operator
                  resource: limits.cpu
            - name: OPERATOR_CONTAINER_MEM_REQUEST
              valueFrom:
                resourceFieldRef:
                  containerName: altinity-clickhouse-operator
                  resource: requests.memory
            - name: OPERATOR_CONTAINER_MEM_LIMIT
              valueFrom:
                resourceFieldRef:
                  containerName: altinity-clickhouse-operator
                  resource: limits.memory
            
          ports:
            - containerPort: 9999
              name: metrics
          resources: 
            {}
          securityContext: 
            {}

        - name: metrics-exporter
          image: altinity/metrics-exporter:0.23.5
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: etc-clickhouse-operator-folder
              mountPath: /etc/clickhouse-operator
            - name: etc-clickhouse-operator-confd-folder
              mountPath: /etc/clickhouse-operator/conf.d
            - name: etc-clickhouse-operator-configd-folder
              mountPath: /etc/clickhouse-operator/config.d
            - name: etc-clickhouse-operator-templatesd-folder
              mountPath: /etc/clickhouse-operator/templates.d
            - name: etc-clickhouse-operator-usersd-folder
              mountPath: /etc/clickhouse-operator/users.d
          env:
            # Pod-specific
            # spec.nodeName: ip-172-20-52-62.ec2.internal
            - name: OPERATOR_POD_NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            # metadata.name: clickhouse-operator-6f87589dbb-ftcsf
            - name: OPERATOR_POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            # metadata.namespace: kube-system
            - name: OPERATOR_POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            # status.podIP: 100.96.3.2
            - name: OPERATOR_POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            # spec.serviceAccount: clickhouse-operator
            # spec.serviceAccountName: clickhouse-operator
            - name: OPERATOR_POD_SERVICE_ACCOUNT
              valueFrom:
                fieldRef:
                  fieldPath: spec.serviceAccountName
            # Container-specific
            - name: OPERATOR_CONTAINER_CPU_REQUEST
              valueFrom:
                resourceFieldRef:
                  containerName: altinity-clickhouse-operator
                  resource: requests.cpu
            - name: OPERATOR_CONTAINER_CPU_LIMIT
              valueFrom:
                resourceFieldRef:
                  containerName: altinity-clickhouse-operator
                  resource: limits.cpu
            - name: OPERATOR_CONTAINER_MEM_REQUEST
              valueFrom:
                resourceFieldRef:
                  containerName: altinity-clickhouse-operator
                  resource: requests.memory
            - name: OPERATOR_CONTAINER_MEM_LIMIT
              valueFrom:
                resourceFieldRef:
                  containerName: altinity-clickhouse-operator
                  resource: limits.memory
            
          ports:
            - containerPort: 8888
              name: metrics
          resources: 
            {}
          securityContext: 
            {}

      imagePullSecrets: 
        []
      nodeSelector: 
        {}
      affinity: 
        {}
      tolerations: 
        []
      securityContext: 
        {}
