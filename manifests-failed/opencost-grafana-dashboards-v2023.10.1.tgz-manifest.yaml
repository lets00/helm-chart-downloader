---
# Source: opencost-grafana-dashboards/templates/dashboard.yaml
apiVersion: openviz.dev/v1alpha1
kind: GrafanaDashboard
metadata:
  name: ace-costandutilizations
  namespace: opencost-grafana-dashboards-v2023.10.1.tgz
  labels:
    k8s.io/group: cost.k8s.appscode.com
    k8s.io/kind: CostReport
    helm.sh/chart: opencost-grafana-dashboards-v2023.10.1
    app.kubernetes.io/name: opencost-grafana-dashboards
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v2023.10.1"
    app.kubernetes.io/managed-by: Helm
spec:
  model:
    annotations:
      list:
      - builtIn: 1
        datasource: -- Grafana --
        enable: true
        hide: true
        iconColor: rgba(0, 211, 255, 1)
        name: Annotations & Alerts
        type: dashboard
    editable: true
    gnetId: null
    graphTooltip: 0
    iteration: 1694511975312
    links: []
    panels:
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      description: Monthly projected CPU cost given last 10m
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 6
        w: 6
        x: 0
        "y": 0
      hiddenSeries: false
      id: 2
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: |-
          sum(
            avg(container_cpu_allocation) by (pod,node)
    
            * on (node) group_left()
            avg(avg_over_time(node_cpu_hourly_cost[10m])) by (node)
    
            * on (pod) group_left()
              max(kube_pod_labels{}) by (pod)
          ) * 730
        interval: ""
        legendFormat: '{{ node }} '
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: CPU cost
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      description: Based on memory usage over last 24 hours
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 6
        w: 6
        x: 6
        "y": 0
      hiddenSeries: false
      id: 4
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: |-
          sum(
            avg(container_memory_allocation_bytes) by (pod,node) / 1024 / 1024 / 1024
    
            * on (node) group_left()
            avg(avg_over_time(node_ram_hourly_cost[10m])) by (node)
    
            * on (pod) group_left()
              max(kube_pod_labels) by (pod)
          ) * 730
        interval: ""
        legendFormat: '{{ node }}'
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: Memory cost
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 6
        w: 6
        x: 12
        "y": 0
      hiddenSeries: false
      id: 6
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: "sum(\n sum(kube_persistentvolumeclaim_info{storageclass!=\".*ssd.*\"})
          by (persistentvolumeclaim, storageclass)\n * on (persistentvolumeclaim) group_right(storageclass)\n
          sum(kube_persistentvolumeclaim_resource_requests_storage_bytes) by (persistentvolumeclaim)\n
          * on (persistentvolumeclaim) group_left(label_app)\n max(kube_persistentvolumeclaim_labels{})
          by (persistentvolumeclaim) or up * 0\n) / 1024 / 1024 /1024 * .04 \n\n+\n\nsum(\n
          sum(kube_persistentvolumeclaim_info{storageclass=~\".*ssd.*\"}) by (persistentvolumeclaim,
          storageclass)\n * on (persistentvolumeclaim) group_right(storageclass)\n sum(kube_persistentvolumeclaim_resource_requests_storage_bytes)
          by (persistentvolumeclaim)\n * on (persistentvolumeclaim) group_left(label_app)\n
          max(kube_persistentvolumeclaim_labels{}) by (persistentvolumeclaim) or up *
          0\n) / 1024 / 1024 /1024 * .17 \n"
        interval: ""
        legendFormat: '{{ node }}'
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: Storage cost
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 6
        w: 6
        x: 18
        "y": 0
      hiddenSeries: false
      id: 8
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: "sum(\n  avg(container_cpu_allocation) by (pod,node)\n\n  * on (node) group_left()\n
          \ avg(avg_over_time(node_cpu_hourly_cost[10m])) by (node)\n\n  * on (pod) group_left()\n
          \   max(kube_pod_labels{}) by (pod)\n) * 730\n\n+ \nsum(\n  avg(container_memory_allocation_bytes)
          by (pod,node) / 1024 / 1024 / 1024\n\n  * on (node) group_left()\n  avg(avg_over_time(node_ram_hourly_cost[10m]))
          by (node)\n\n  * on (pod) group_left()\n    max(kube_pod_labels) by (pod)\n)
          * 730\n\n+\nsum(\n sum(kube_persistentvolumeclaim_info{storageclass!=\".*ssd.*\"})
          by (persistentvolumeclaim, storageclass)\n * on (persistentvolumeclaim) group_right(storageclass)\n
          sum(kube_persistentvolumeclaim_resource_requests_storage_bytes) by (persistentvolumeclaim)\n
          * on (persistentvolumeclaim) group_left(label_app)\n max(kube_persistentvolumeclaim_labels{})
          by (persistentvolumeclaim) or up * 0\n) / 1024 / 1024 /1024 * .04 \n\n+\n\nsum(\n
          sum(kube_persistentvolumeclaim_info{storageclass=~\".*ssd.*\"}) by (persistentvolumeclaim,
          storageclass)\n * on (persistentvolumeclaim) group_right(storageclass)\n sum(kube_persistentvolumeclaim_resource_requests_storage_bytes)
          by (persistentvolumeclaim)\n * on (persistentvolumeclaim) group_left(label_app)\n
          max(kube_persistentvolumeclaim_labels{}) by (persistentvolumeclaim) or up *
          0\n) / 1024 / 1024 /1024 * .17 \n"
        interval: ""
        legendFormat: ""
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: Total cost
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 7
        w: 5
        x: 0
        "y": 6
      hiddenSeries: false
      id: 10
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: "sum(\n sum (kube_pod_container_resource_requests{resource=\"cpu\", unit=\"core\"})
          by (pod)\n * on (pod) group_left()\n max(kube_pod_labels{}) by (pod)\n or up
          * 0\n) "
        interval: ""
        legendFormat: '{{ }}'
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: CPU request
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 7
        w: 5
        x: 5
        "y": 6
      hiddenSeries: false
      id: 12
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: "sum(\n sum(rate(container_cpu_usage_seconds_total{image!=\"\",container_name!=\"POD\"}[1h]))
          by (ndoe,pod)\n * on (pod) group_left()\n max(kube_pod_labels{}) by (pod) or
          up * 0\n) "
        interval: ""
        legendFormat: '{{ }}'
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: CPU used
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 7
        w: 4
        x: 10
        "y": 6
      hiddenSeries: false
      id: 14
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: "sum(\n sum (kube_pod_container_resource_requests{resource=\"memory\", unit=\"byte\"})
          by (pod)\n * on (pod) group_left()\n max(kube_pod_labels{}) by (pod)\n or up
          * 0\n) "
        interval: ""
        legendFormat: ""
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: Memory request
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 7
        w: 5
        x: 14
        "y": 6
      hiddenSeries: false
      id: 16
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: |-
          sum(
           sum (container_memory_working_set_bytes{pod!="",container!="POD",container!=""}) by (pod)
           * on (pod) group_left()
           max(kube_pod_labels{}) by (pod)
           or up * 0
          )
        interval: ""
        legendFormat: ""
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: Memory used
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 7
        w: 5
        x: 19
        "y": 6
      hiddenSeries: false
      id: 22
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: "sum(\n max(kube_persistentvolumeclaim_info) by (persistentvolumeclaim,
          storageclass)\n * on (persistentvolumeclaim) group_right(storageclass)\n sum(kube_persistentvolumeclaim_resource_requests_storage_bytes)
          by (persistentvolumeclaim)\n * on (persistentvolumeclaim) group_left(label_app)\n
          max(kube_persistentvolumeclaim_labels{}) by (persistentvolumeclaim) or up *
          0\n) \n"
        interval: ""
        legendFormat: ""
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: Storage request
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 8
        w: 7
        x: 0
        "y": 13
      hiddenSeries: false
      id: 18
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: "sum(\n label_replace(\n sum (kube_pod_container_resource_limits{resource=\"cpu\",
          unit=\"core\"}) by (pod, container)\n * on (pod) group_left()\n max(kube_pod_labels{})
          by (pod,container),\n \"container_name\",\n \"$1\", \n \"container\", \n \"(.+)\"\n
          )\n) \n"
        interval: ""
        legendFormat: ""
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: CPU Usage vs Requests vs Limits
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      description: ""
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 8
        w: 8
        x: 7
        "y": 13
      hiddenSeries: false
      id: 20
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: "sum(\n label_replace(\n sum (kube_pod_container_resource_limits{resource=\"memory\",
          unit=\"byte\"}) by (pod, container)\n * on (pod) group_left()\n max(kube_pod_labels{})
          by (pod,container),\n \"container_name\",\n \"$1\", \n \"container\", \n \"(.+)\"\n
          )\n) \n"
        interval: ""
        legendFormat: ""
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: Memory Usage vs Requests vs Limits
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    schemaVersion: 27
    style: dark
    tags: []
    templating:
      list:
      - current:
          selected: false
          text: Prometheus
          value: Prometheus
        description: null
        error: null
        hide: 0
        includeAll: false
        label: null
        multi: false
        name: datasource
        options: []
        query: prometheus
        refresh: 1
        regex: ""
        skipUrlSync: false
        type: datasource
    time:
      from: now-24h
      to: now
    timepicker: {}
    timezone: ""
    title: ACE / Cost and Utilizations
    version: 1
  overwrite: true
  templatize:
    title: false
    datasource: false
---
# Source: opencost-grafana-dashboards/templates/dashboard.yaml
apiVersion: openviz.dev/v1alpha1
kind: GrafanaDashboard
metadata:
  name: ace-namespaceutilization
  namespace: opencost-grafana-dashboards-v2023.10.1.tgz
  labels:
    k8s.io/group: cost.k8s.appscode.com
    k8s.io/kind: CostReport
    helm.sh/chart: opencost-grafana-dashboards-v2023.10.1
    app.kubernetes.io/name: opencost-grafana-dashboards
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v2023.10.1"
    app.kubernetes.io/managed-by: Helm
spec:
  model:
    annotations:
      list:
      - builtIn: 1
        datasource: -- Grafana --
        enable: true
        hide: true
        iconColor: rgba(0, 211, 255, 1)
        name: Annotations & Alerts
        type: dashboard
    description: A dashboard to help with utilization and resource allocation
    editable: true
    gnetId: 8673
    graphTooltip: 0
    iteration: 1694412266026
    links: []
    panels:
    - columns:
      - text: Avg
        value: avg
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fontSize: 100%
      gridPos:
        h: 9
        w: 16
        x: 0
        "y": 0
      hideTimeOverride: true
      id: 73
      links: []
      pageSize: 8
      repeat: null
      repeatDirection: v
      scroll: true
      showHeader: true
      sort:
        col: 2
        desc: false
      styles:
      - alias: Pod
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(50, 172, 45, 0.97)
        - '#c15c17'
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        link: false
        linkTooltip: ""
        linkUrl: ""
        pattern: pod_name
        thresholds:
        - "30"
        - "80"
        type: string
        unit: currencyUSD
      - alias: RAM
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        pattern: 'Value #B'
        thresholds: []
        type: number
        unit: decbytes
      - alias: CPU %
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #A'
        thresholds: []
        type: number
        unit: percent
      - alias: ""
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: Time
        thresholds: []
        type: hidden
        unit: short
      - alias: Storage
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #C'
        thresholds: []
        type: number
        unit: currencyUSD
      - alias: Total
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #D'
        thresholds: []
        type: number
        unit: currencyUSD
      - alias: CPU Utilization
        align: auto
        colorMode: value
        colors:
        - '#bf1b00'
        - rgba(50, 172, 45, 0.97)
        - '#ef843c'
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #E'
        thresholds:
        - "30"
        - "80"
        type: number
        unit: percent
      - alias: RAM Utilization
        align: auto
        colorMode: value
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(50, 172, 45, 0.97)
        - '#ef843c'
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #F'
        thresholds:
        - "30"
        - "80"
        type: number
        unit: percent
      targets:
      - expr: sum (rate (container_cpu_usage_seconds_total{namespace="$namespace"}[10m]))
          by (pod_name) * 100
        format: table
        hide: false
        instant: true
        interval: ""
        intervalFactor: 1
        legendFormat: '{{ pod_name }}'
        refId: A
      - expr: sum (avg_over_time (container_memory_working_set_bytes{namespace="$namespace",
          container_name!="POD"}[10m])) by (pod_name)
        format: table
        hide: false
        instant: true
        intervalFactor: 1
        legendFormat: '{{ pod_name }}'
        refId: B
      timeFrom: 1M
      timeShift: null
      title: Pod utilization analysis
      transform: timeseries_to_rows
      type: table-old
    - columns:
      - text: Avg
        value: avg
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fontSize: 100%
      gridPos:
        h: 9
        w: 8
        x: 16
        "y": 0
      hideTimeOverride: true
      id: 90
      links: []
      pageSize: 8
      repeatDirection: v
      scroll: true
      showHeader: true
      sort:
        col: 4
        desc: true
      styles:
      - alias: Namespace
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: namespace
        thresholds: []
        type: hidden
        unit: short
      - alias: PVC Name
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: persistentvolumeclaim
        thresholds: []
        type: number
        unit: short
      - alias: Storage Class
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: storageclass
        thresholds: []
        type: number
        unit: short
      - alias: Size
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 1
        mappingType: 1
        pattern: Value
        thresholds: []
        type: number
        unit: gbytes
      - alias: ""
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: Time
        thresholds: []
        type: hidden
        unit: short
      targets:
      - expr: "sum (\n sum(kube_persistentvolumeclaim_info) by (persistentvolumeclaim,
          namespace, storageclass)\n + on (persistentvolumeclaim, namespace) group_right
          (storageclass)\n sum(kube_persistentvolumeclaim_resource_requests_storage_bytes{namespace=~\"$namespace\"})
          by (persistentvolumeclaim, namespace)\n) by (namespace,persistentvolumeclaim,storageclass)
          / 1024 / 1024 /1024 "
        format: table
        hide: false
        instant: true
        interval: ""
        intervalFactor: 1
        legendFormat: '{{ persistentvolumeclaim }}'
        refId: A
      timeFrom: null
      timeShift: null
      title: Persistent Volume Claims
      transform: table
      type: table-old
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      description: CPU requests by pod divided by the rate of CPU usage over the last
        hour
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 9
        w: 24
        x: 0
        "y": 9
      hiddenSeries: false
      id: 100
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      links: []
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 5
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: |-
          topk(
            10,
                sum by (pod) (
                  kube_pod_container_resource_requests{namespace="$namespace",resource="cpu",unit="core"}
                )
            / on (pod)
              sum by (pod) (
                rate(container_cpu_usage_seconds_total{namespace="$namespace",pod=~".+"}[1h])
              )
          )
        format: time_series
        interval: ""
        intervalFactor: 1
        legendFormat: ""
        refId: A
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: Ratio of CPU requests to usage (Top 10 pods)
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      decimals: 3
      description: This panel shows historical utilization as an average across all pods
        in this namespace. It only accounts for currently deployed pods
      editable: true
      error: false
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 0
      fillGradient: 0
      grid: {}
      gridPos:
        h: 6
        w: 12
        x: 0
        "y": 18
      height: ""
      hiddenSeries: false
      id: 94
      isNew: true
      legend:
        alignAsTable: false
        avg: false
        current: false
        hideEmpty: false
        hideZero: false
        max: false
        min: false
        rightSide: false
        show: false
        sideWidth: null
        sort: current
        sortDesc: true
        total: false
        values: true
      lines: true
      linewidth: 2
      links: []
      nullPointMode: connected
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 5
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: true
      targets:
      - exemplar: true
        expr: |
          sum (rate (container_cpu_usage_seconds_total{namespace="$namespace"}[10m])) by (namespace)
        format: time_series
        hide: false
        instant: false
        interval: 10s
        intervalFactor: 1
        legendFormat: cpu utilization
        metric: container_cpu
        refId: A
        step: 10
      thresholds: []
      timeFrom: ""
      timeRegions: []
      timeShift: null
      title: Overall CPU Utilization
      tooltip:
        msResolution: true
        shared: true
        sort: 2
        value_type: cumulative
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - decimals: null
        format: percent
        label: ""
        logBase: 1
        max: "110"
        min: "0"
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: false
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      decimals: 2
      description: This panel shows historical utilization as an average across all pods
        in this namespace. It only accounts for currently deployed pods
      editable: true
      error: false
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 0
      fillGradient: 0
      grid: {}
      gridPos:
        h: 6
        w: 12
        x: 12
        "y": 18
      hiddenSeries: false
      id: 92
      isNew: true
      legend:
        alignAsTable: false
        avg: false
        current: false
        max: false
        min: false
        rightSide: false
        show: false
        sideWidth: 200
        sort: current
        sortDesc: true
        total: false
        values: true
      lines: true
      linewidth: 2
      links: []
      nullPointMode: connected
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 5
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: true
      targets:
      - expr: |-
          sum (container_memory_working_set_bytes{namespace="$namespace"})
          /
          sum(node_memory_MemTotal_bytes)
        format: time_series
        instant: false
        intervalFactor: 1
        legendFormat: mem utilization
        refId: B
      thresholds: []
      timeFrom: ""
      timeRegions: []
      timeShift: null
      title: Overall RAM Utilization
      tooltip:
        msResolution: false
        shared: true
        sort: 2
        value_type: cumulative
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - decimals: null
        format: percent
        label: null
        logBase: 1
        max: "110"
        min: "0"
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: false
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      decimals: 2
      description: Traffic in and out of this namespace, as a sum of the pods within it
      editable: true
      error: false
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      grid: {}
      gridPos:
        h: 6
        w: 12
        x: 0
        "y": 24
      height: ""
      hiddenSeries: false
      id: 96
      isNew: true
      legend:
        alignAsTable: false
        avg: true
        current: true
        hideEmpty: false
        hideZero: false
        max: false
        min: false
        rightSide: false
        show: true
        sideWidth: null
        sort: current
        sortDesc: true
        total: false
        values: true
      lines: true
      linewidth: 2
      links: []
      nullPointMode: connected
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 5
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - expr: sum (rate (container_network_receive_bytes_total{namespace="$namespace"}[10m]))
          by (namespace)
        format: time_series
        hide: false
        instant: false
        interval: ""
        intervalFactor: 1
        legendFormat: <- in
        metric: container_cpu
        refId: A
        step: 10
      - expr: '- sum (rate (container_network_transmit_bytes_total{namespace="$namespace"}[10m]))
          by (namespace)'
        format: time_series
        hide: false
        instant: false
        interval: ""
        intervalFactor: 1
        legendFormat: -> out
        refId: B
      thresholds: []
      timeFrom: ""
      timeRegions: []
      timeShift: null
      title: Network IO
      tooltip:
        msResolution: true
        shared: true
        sort: 2
        value_type: cumulative
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: Bps
        label: ""
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: false
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      decimals: 2
      description: Disk reads and writes for the namespace, as a sum of the pods within
        it
      editable: true
      error: false
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      grid: {}
      gridPos:
        h: 6
        w: 12
        x: 12
        "y": 24
      height: ""
      hiddenSeries: false
      id: 98
      isNew: true
      legend:
        alignAsTable: false
        avg: true
        current: true
        hideEmpty: false
        hideZero: false
        max: false
        min: false
        rightSide: false
        show: true
        sideWidth: null
        sort: current
        sortDesc: true
        total: false
        values: true
      lines: true
      linewidth: 2
      links: []
      nullPointMode: connected
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 5
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - expr: sum (rate (container_fs_writes_bytes_total{namespace="$namespace"}[10m]))
          by (namespace)
        format: time_series
        hide: false
        instant: false
        interval: ""
        intervalFactor: 1
        legendFormat: <- write
        metric: container_cpu
        refId: A
        step: 10
      - expr: '- sum (rate (container_fs_reads_bytes_total{namespace="$namespace"}[10m]))
          by (namespace)'
        format: time_series
        hide: false
        instant: false
        interval: ""
        intervalFactor: 1
        legendFormat: -> read
        refId: B
      thresholds: []
      timeFrom: ""
      timeRegions: []
      timeShift: null
      title: Disk IO
      tooltip:
        msResolution: true
        shared: true
        sort: 2
        value_type: cumulative
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: Bps
        label: ""
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: false
      yaxis:
        align: false
        alignLevel: null
    refresh: 10s
    schemaVersion: 27
    style: dark
    tags:
    - cost
    - utilization
    - metrics
    templating:
      list:
      - current:
          selected: true
          text: "23.06"
          value: "23.06"
        description: null
        error: null
        hide: 0
        label: CPU
        name: costcpu
        options:
        - selected: true
          text: "23.06"
          value: "23.06"
        query: "23.06"
        skipUrlSync: false
        type: textbox
      - current:
          selected: true
          text: "7.28"
          value: "7.28"
        description: null
        error: null
        hide: 0
        label: PE CPU
        name: costpcpu
        options:
        - selected: true
          text: "7.28"
          value: "7.28"
        query: "7.28"
        skipUrlSync: false
        type: textbox
      - current:
          selected: true
          text: "3.25"
          value: "3.25"
        description: null
        error: null
        hide: 0
        label: RAM
        name: costram
        options:
        - selected: true
          text: "3.25"
          value: "3.25"
        query: "3.25"
        skipUrlSync: false
        type: textbox
      - current:
          selected: true
          text: "0.6862"
          value: "0.6862"
        description: null
        error: null
        hide: 0
        label: PE RAM
        name: costpram
        options:
        - selected: true
          text: "0.6862"
          value: "0.6862"
        query: "0.6862"
        skipUrlSync: false
        type: textbox
      - current:
          selected: true
          text: "0.04"
          value: "0.04"
        description: null
        error: null
        hide: 0
        label: Storage
        name: costStorageStandard
        options:
        - selected: true
          text: "0.04"
          value: "0.04"
        query: "0.04"
        skipUrlSync: false
        type: textbox
      - current:
          selected: true
          text: ".17"
          value: ".17"
        description: null
        error: null
        hide: 0
        label: SSD
        name: costStorageSSD
        options:
        - selected: true
          text: ".17"
          value: ".17"
        query: ".17"
        skipUrlSync: false
        type: textbox
      - current:
          selected: true
          text: "30"
          value: "30"
        description: null
        error: null
        hide: 0
        label: Disc.
        name: costDiscount
        options:
        - selected: true
          text: "30"
          value: "30"
        query: "30"
        skipUrlSync: false
        type: textbox
      - allValue: null
        current:
          selected: true
          text: falco
          value: falco
        datasource: ${datasource}
        definition: ""
        description: null
        error: null
        hide: 0
        includeAll: false
        label: NS
        multi: false
        name: namespace
        options: []
        query:
          query: query_result(sum(kube_namespace_created{namespace!=""}) by (namespace))
          refId: Prometheus-namespace-Variable-Query
        refresh: 1
        regex: /namespace=\"(.*?)(\")/
        skipUrlSync: false
        sort: 0
        tagValuesQuery: ""
        tags: []
        tagsQuery: ""
        type: query
        useTags: false
      - datasource: ${datasource}
        description: null
        error: null
        filters: []
        hide: 0
        label: ""
        name: Filters
        skipUrlSync: false
        type: adhoc
      - current:
          selected: false
          text: Prometheus
          value: Prometheus
        description: null
        error: null
        hide: 0
        includeAll: false
        label: null
        multi: false
        name: datasource
        options: []
        query: prometheus
        refresh: 1
        regex: ""
        skipUrlSync: false
        type: datasource
    time:
      from: now-24h
      to: now
    timepicker:
      hidden: false
      refresh_intervals:
      - 5s
      - 10s
      - 30s
      - 1m
      - 5m
      - 15m
      - 30m
      - 1h
      - 2h
      - 1d
      time_options:
      - 5m
      - 15m
      - 1h
      - 6h
      - 12h
      - 24h
      - 2d
      - 7d
      - 30d
    timezone: browser
    title: ACE / Namespace Utilization
    version: 2
  overwrite: true
  templatize:
    title: false
    datasource: false
---
# Source: opencost-grafana-dashboards/templates/dashboard.yaml
apiVersion: openviz.dev/v1alpha1
kind: GrafanaDashboard
metadata:
  name: ace-nodeutilization
  namespace: opencost-grafana-dashboards-v2023.10.1.tgz
  labels:
    k8s.io/group: cost.k8s.appscode.com
    k8s.io/kind: CostReport
    helm.sh/chart: opencost-grafana-dashboards-v2023.10.1
    app.kubernetes.io/name: opencost-grafana-dashboards
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v2023.10.1"
    app.kubernetes.io/managed-by: Helm
spec:
  model:
    annotations:
      list:
      - builtIn: 1
        datasource: -- Grafana --
        enable: true
        hide: true
        iconColor: rgba(0, 211, 255, 1)
        name: Annotations & Alerts
        type: dashboard
    editable: true
    gnetId: null
    graphTooltip: 0
    iteration: 1694153963044
    links: []
    panels:
    - cacheTimeout: null
      colorBackground: false
      colorValue: false
      colors:
      - '#299c46'
      - rgba(237, 129, 40, 0.89)
      - '#d44a3a'
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      format: percentunit
      gauge:
        maxValue: 100
        minValue: 0
        show: true
        thresholdLabels: false
        thresholdMarkers: true
      gridPos:
        h: 7
        w: 8
        x: 0
        "y": 0
      id: 2
      interval: null
      links: []
      mappingType: 1
      mappingTypes:
      - name: value to text
        value: 1
      - name: range to text
        value: 2
      maxDataPoints: 100
      nullPointMode: connected
      nullText: null
      postfix: ""
      postfixFontSize: 50%
      prefix: ""
      prefixFontSize: 50%
      rangeMaps:
      - from: "null"
        text: N/A
        to: "null"
      sparkline:
        fillColor: rgba(31, 118, 189, 0.18)
        full: false
        lineColor: rgb(31, 120, 193)
        show: false
      tableColumn: ""
      targets:
      - exemplar: true
        expr: sum(irate(container_cpu_usage_seconds_total{node="$node"}[10m]))
        format: time_series
        interval: ""
        intervalFactor: 1
        legendFormat: ""
        refId: A
      thresholds: ""
      title: CPU Usage
      type: singlestat
      valueFontSize: 80%
      valueMaps:
      - op: =
        text: N/A
        value: "null"
      valueName: avg
    - cacheTimeout: null
      colorBackground: false
      colorValue: false
      colors:
      - '#299c46'
      - rgba(237, 129, 40, 0.89)
      - '#d44a3a'
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      format: percentunit
      gauge:
        maxValue: 100
        minValue: 0
        show: true
        thresholdLabels: false
        thresholdMarkers: true
      gridPos:
        h: 7
        w: 8
        x: 8
        "y": 0
      id: 3
      interval: null
      links: []
      mappingType: 1
      mappingTypes:
      - name: value to text
        value: 1
      - name: range to text
        value: 2
      maxDataPoints: 100
      nullPointMode: connected
      nullText: null
      postfix: ""
      postfixFontSize: 50%
      prefix: ""
      prefixFontSize: 50%
      rangeMaps:
      - from: "null"
        text: N/A
        to: "null"
      sparkline:
        fillColor: rgba(31, 118, 189, 0.18)
        full: false
        lineColor: rgb(31, 120, 193)
        show: false
      tableColumn: ""
      targets:
      - exemplar: true
        expr: SUM(container_memory_usage_bytes{namespace!="",node="$node"}) / SUM(kube_node_status_capacity{resource="memory",
          unit="byte", node="$node"})
        format: time_series
        interval: ""
        intervalFactor: 1
        legendFormat: ""
        refId: A
      thresholds: ""
      title: Memory Usage
      type: singlestat
      valueFontSize: 80%
      valueMaps:
      - op: =
        text: N/A
        value: "null"
      valueName: avg
    - cacheTimeout: null
      colorBackground: false
      colorValue: false
      colors:
      - '#299c46'
      - rgba(237, 129, 40, 0.89)
      - '#d44a3a'
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      format: percentunit
      gauge:
        maxValue: 100
        minValue: 0
        show: true
        thresholdLabels: false
        thresholdMarkers: true
      gridPos:
        h: 7
        w: 8
        x: 16
        "y": 0
      id: 4
      interval: null
      links: []
      mappingType: 1
      mappingTypes:
      - name: value to text
        value: 1
      - name: range to text
        value: 2
      maxDataPoints: 100
      nullPointMode: connected
      nullText: null
      postfix: ""
      postfixFontSize: 50%
      prefix: ""
      prefixFontSize: 50%
      rangeMaps:
      - from: "null"
        text: N/A
        to: "null"
      sparkline:
        fillColor: rgba(31, 118, 189, 0.18)
        full: false
        lineColor: rgb(31, 120, 193)
        show: false
      tableColumn: ""
      targets:
      - exemplar: true
        expr: |-
          sum(container_fs_usage_bytes{device=~"^/dev/[sv]d[a-z][1-9]$",id="/",instance="$node"}) /
          sum(container_fs_limit_bytes{device=~"^/dev/[sv]d[a-z][1-9]$",id="/",instance="$node"})
        format: time_series
        interval: ""
        intervalFactor: 1
        legendFormat: ""
        refId: A
      thresholds: ""
      title: Storage Usage
      type: singlestat
      valueFontSize: 80%
      valueMaps:
      - op: =
        text: N/A
        value: "null"
      valueName: avg
    - columns:
      - text: Avg
        value: avg
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fontSize: 100%
      gridPos:
        h: 8
        w: 16
        x: 0
        "y": 7
      hideTimeOverride: true
      id: 21
      links: []
      pageSize: 8
      repeat: null
      repeatDirection: v
      scroll: true
      showHeader: true
      sort:
        col: 4
        desc: true
      styles:
      - alias: Pod
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(50, 172, 45, 0.97)
        - '#c15c17'
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        link: false
        linkTooltip: ""
        linkUrl: ""
        pattern: pod_name
        thresholds:
        - "30"
        - "80"
        type: string
        unit: currencyUSD
      - alias: ""
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: Time
        thresholds: []
        type: hidden
        unit: short
      - alias: CPU Usage
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #C'
        thresholds: []
        type: number
        unit: short
      - alias: CPU Request
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #A'
        thresholds: []
        type: number
        unit: short
      - alias: CPU Limit
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #B'
        thresholds: []
        type: number
        unit: short
      - alias: Mem Usage
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #D'
        thresholds: []
        type: number
        unit: bytes
      - alias: Mem Request
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #E'
        thresholds: []
        type: number
        unit: bytes
      - alias: Mem Limit
        align: auto
        colorMode: null
        colors:
        - rgba(245, 54, 54, 0.9)
        - rgba(237, 129, 40, 0.89)
        - rgba(50, 172, 45, 0.97)
        dateFormat: YYYY-MM-DD HH:mm:ss
        decimals: 2
        mappingType: 1
        pattern: 'Value #F'
        thresholds: []
        type: number
        unit: bytes
      targets:
      - expr: sum(rate(container_cpu_usage_seconds_total{container_name!="",container_name!="POD",pod_name!="",instance="$node"}[24h]))
          by (pod_name)
        format: table
        instant: true
        intervalFactor: 1
        refId: C
      - expr: "sum(label_replace(\nsum(avg_over_time(kube_pod_container_resource_requests{resource=\"cpu\",
          unit=\"core\", container!=\"\",container!=\"POD\",node=\"$node\"}[24h])) by
          (pod), \n\"pod_name\",\"$1\",\"pod\",\"(.+)\")\nor up * 0\n) by (pod_name)"
        format: table
        instant: true
        intervalFactor: 1
        refId: A
      - expr: |
          sum(avg_over_time(container_memory_usage_bytes{container_name!="",container_name!="POD",pod_name!="",instance="$node"}[24h])) by (pod_name)
        format: table
        instant: true
        intervalFactor: 1
        refId: D
      - expr: |
          sum(label_replace(label_replace(
          sum(avg_over_time(kube_pod_container_resource_requests{resource="memory", unit="byte", container!="",container!="POD",node="$node"}[24h])) by (pod),
          "container_name","$1","container","(.+)"), "pod_name","$1","pod","(.+)")
          or up * 0
          ) by (pod_name)
        format: table
        instant: true
        intervalFactor: 1
        refId: E
      timeFrom: 1M
      timeShift: null
      title: Current pods
      transform: table
      type: table-old
    - cacheTimeout: null
      colorBackground: false
      colorValue: false
      colors:
      - '#299c46'
      - rgba(237, 129, 40, 0.89)
      - '#d44a3a'
      datasource: ${datasource}
      decimals: 0
      fieldConfig:
        defaults: {}
        overrides: []
      format: none
      gauge:
        maxValue: 100
        minValue: 0
        show: false
        thresholdLabels: false
        thresholdMarkers: true
      gridPos:
        h: 4
        w: 4
        x: 16
        "y": 7
      id: 8
      interval: null
      links: []
      mappingType: 1
      mappingTypes:
      - name: value to text
        value: 1
      - name: range to text
        value: 2
      maxDataPoints: 100
      nullPointMode: connected
      nullText: null
      postfix: ""
      postfixFontSize: 50%
      prefix: ""
      prefixFontSize: 50%
      rangeMaps:
      - from: "null"
        text: N/A
        to: "null"
      sparkline:
        fillColor: rgba(31, 118, 189, 0.18)
        full: false
        lineColor: rgb(31, 120, 193)
        show: false
      tableColumn: ""
      targets:
      - expr: |-
          sum(
           count(avg_over_time(kube_pod_container_resource_requests{resource="cpu", unit="core", container!="",container!="POD",node="$node"}[24h])) by (pod)
           * on (pod) group_right()
           sum(kube_pod_container_status_running) by (pod)
          )
        format: time_series
        instant: true
        intervalFactor: 1
        refId: A
      thresholds: ""
      title: Pods Running
      type: singlestat
      valueFontSize: 80%
      valueMaps:
      - op: =
        text: N/A
        value: "null"
      valueName: current
    - cacheTimeout: null
      colorBackground: false
      colorValue: false
      colors:
      - '#299c46'
      - rgba(237, 129, 40, 0.89)
      - '#d44a3a'
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      format: bytes
      gauge:
        maxValue: 100
        minValue: 0
        show: false
        thresholdLabels: false
        thresholdMarkers: true
      gridPos:
        h: 4
        w: 4
        x: 20
        "y": 7
      id: 18
      interval: null
      links: []
      mappingType: 1
      mappingTypes:
      - name: value to text
        value: 1
      - name: range to text
        value: 2
      maxDataPoints: 100
      nullPointMode: connected
      nullText: null
      postfix: ""
      postfixFontSize: 50%
      prefix: ""
      prefixFontSize: 50%
      rangeMaps:
      - from: "null"
        text: N/A
        to: "null"
      sparkline:
        fillColor: rgba(31, 118, 189, 0.18)
        full: false
        lineColor: rgb(31, 120, 193)
        show: false
      tableColumn: ""
      targets:
      - expr: sum(container_fs_limit_bytes{device=~"^/dev/[sv]d[a-z][1-9]$",id="/",instance="$node"})
        format: time_series
        intervalFactor: 1
        refId: A
      thresholds: ""
      title: Storage Capacity
      type: singlestat
      valueFontSize: 80%
      valueMaps:
      - op: =
        text: N/A
        value: "null"
      valueName: current
    - cacheTimeout: null
      colorBackground: false
      colorValue: false
      colors:
      - '#299c46'
      - rgba(237, 129, 40, 0.89)
      - '#d44a3a'
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      format: none
      gauge:
        maxValue: 100
        minValue: 0
        show: false
        thresholdLabels: false
        thresholdMarkers: true
      gridPos:
        h: 4
        w: 4
        x: 16
        "y": 11
      id: 9
      interval: null
      links: []
      mappingType: 1
      mappingTypes:
      - name: value to text
        value: 1
      - name: range to text
        value: 2
      maxDataPoints: 100
      nullPointMode: connected
      nullText: null
      postfix: ""
      postfixFontSize: 50%
      prefix: ""
      prefixFontSize: 50%
      rangeMaps:
      - from: "null"
        text: N/A
        to: "null"
      sparkline:
        fillColor: rgba(31, 118, 189, 0.18)
        full: false
        lineColor: rgb(31, 120, 193)
        show: false
      tableColumn: ""
      targets:
      - expr: kube_node_status_capacity{resource="cpu", unit="core", node="$node"}
        format: time_series
        intervalFactor: 1
        refId: A
      thresholds: ""
      title: CPU Capacity
      type: singlestat
      valueFontSize: 80%
      valueMaps:
      - op: =
        text: N/A
        value: "null"
      valueName: avg
    - cacheTimeout: null
      colorBackground: false
      colorValue: false
      colors:
      - '#299c46'
      - rgba(237, 129, 40, 0.89)
      - '#d44a3a'
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      format: bytes
      gauge:
        maxValue: 100
        minValue: 0
        show: false
        thresholdLabels: false
        thresholdMarkers: true
      gridPos:
        h: 4
        w: 4
        x: 20
        "y": 11
      id: 19
      interval: null
      links: []
      mappingType: 1
      mappingTypes:
      - name: value to text
        value: 1
      - name: range to text
        value: 2
      maxDataPoints: 100
      nullPointMode: connected
      nullText: null
      postfix: ""
      postfixFontSize: 50%
      prefix: ""
      prefixFontSize: 50%
      rangeMaps:
      - from: "null"
        text: N/A
        to: "null"
      sparkline:
        fillColor: rgba(31, 118, 189, 0.18)
        full: false
        lineColor: rgb(31, 120, 193)
        show: false
      tableColumn: ""
      targets:
      - expr: kube_node_status_capacity{resource="memory", unit="byte", node="$node"}
        format: time_series
        intervalFactor: 1
        refId: A
      thresholds: ""
      title: RAM Capacity
      type: singlestat
      valueFontSize: 80%
      valueMaps:
      - op: =
        text: N/A
        value: "null"
      valueName: current
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      decimals: 3
      description: This panel shows historical utilization for the node.
      editable: true
      error: false
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 0
      fillGradient: 0
      grid: {}
      gridPos:
        h: 6
        w: 12
        x: 0
        "y": 15
      height: ""
      hiddenSeries: false
      id: 11
      isNew: true
      legend:
        alignAsTable: false
        avg: false
        current: false
        hideEmpty: false
        hideZero: false
        max: false
        min: false
        rightSide: false
        show: false
        sideWidth: null
        sort: current
        sortDesc: true
        total: false
        values: true
      lines: true
      linewidth: 2
      links: []
      nullPointMode: connected
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 5
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: true
      targets:
      - exemplar: true
        expr: sum(irate(container_cpu_usage_seconds_total{node="$node"}[10m]))
        format: time_series
        hide: false
        instant: false
        interval: 10s
        intervalFactor: 1
        legendFormat: cpu utilization
        metric: container_cpu
        refId: A
        step: 10
      thresholds: []
      timeFrom: ""
      timeRegions: []
      timeShift: null
      title: CPU Utilization
      tooltip:
        msResolution: true
        shared: true
        sort: 2
        value_type: cumulative
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - decimals: null
        format: percentunit
        label: ""
        logBase: 1
        max: "1.1"
        min: "0"
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: false
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      decimals: 2
      description: This panel shows historical utilization for the node.
      editable: true
      error: false
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 0
      fillGradient: 0
      grid: {}
      gridPos:
        h: 6
        w: 12
        x: 12
        "y": 15
      hiddenSeries: false
      id: 13
      isNew: true
      legend:
        alignAsTable: false
        avg: false
        current: false
        max: false
        min: false
        rightSide: false
        show: false
        sideWidth: 200
        sort: current
        sortDesc: true
        total: false
        values: true
      lines: true
      linewidth: 2
      links: []
      nullPointMode: connected
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 5
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: true
      targets:
      - exemplar: true
        expr: SUM(container_memory_usage_bytes{namespace!="",node="$node"}) / SUM(kube_node_status_capacity{resource="memory",
          unit="byte", node="$node"})
        format: time_series
        instant: false
        interval: 10s
        intervalFactor: 1
        legendFormat: ram utilization
        metric: container_memory_usage:sort_desc
        refId: A
        step: 10
      thresholds: []
      timeFrom: ""
      timeRegions: []
      timeShift: null
      title: RAM Utilization
      tooltip:
        msResolution: false
        shared: true
        sort: 2
        value_type: cumulative
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - decimals: null
        format: percentunit
        label: null
        logBase: 1
        max: "1.1"
        min: "0"
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: false
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      decimals: 2
      description: Traffic in and out of this namespace, as a sum of the pods within it
      editable: true
      error: false
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      grid: {}
      gridPos:
        h: 6
        w: 12
        x: 0
        "y": 21
      height: ""
      hiddenSeries: false
      id: 15
      isNew: true
      legend:
        alignAsTable: false
        avg: true
        current: true
        hideEmpty: false
        hideZero: false
        max: false
        min: false
        rightSide: false
        show: true
        sideWidth: null
        sort: current
        sortDesc: true
        total: false
        values: true
      lines: true
      linewidth: 2
      links: []
      nullPointMode: connected
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 5
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: sum (rate (container_network_receive_bytes_total{node="$node"}[10m]))
        format: time_series
        hide: false
        instant: false
        interval: ""
        intervalFactor: 1
        legendFormat: <- in
        metric: container_cpu
        refId: A
        step: 10
      - exemplar: true
        expr: '- sum (rate (container_network_transmit_bytes_total{node="$node"}[10m]))'
        format: time_series
        hide: false
        instant: false
        interval: ""
        intervalFactor: 1
        legendFormat: -> out
        refId: B
      thresholds: []
      timeFrom: ""
      timeRegions: []
      timeShift: null
      title: Network IO
      tooltip:
        msResolution: true
        shared: true
        sort: 2
        value_type: cumulative
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: Bps
        label: ""
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: false
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      decimals: 2
      description: Disk reads and writes for the namespace, as a sum of the pods within
        it
      editable: true
      error: false
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      grid: {}
      gridPos:
        h: 6
        w: 12
        x: 12
        "y": 21
      height: ""
      hiddenSeries: false
      id: 17
      isNew: true
      legend:
        alignAsTable: false
        avg: true
        current: true
        hideEmpty: false
        hideZero: false
        max: false
        min: false
        rightSide: false
        show: true
        sideWidth: null
        sort: current
        sortDesc: true
        total: false
        values: true
      lines: true
      linewidth: 2
      links: []
      nullPointMode: connected
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 5
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: sum (rate (container_fs_writes_bytes_total{node="$node"}[10m]))
        format: time_series
        hide: false
        instant: false
        interval: ""
        intervalFactor: 1
        legendFormat: <- write
        metric: container_cpu
        refId: A
        step: 10
      - exemplar: true
        expr: '- sum (rate (container_fs_reads_bytes_total{node="$node"}[10m]))'
        format: time_series
        hide: false
        instant: false
        interval: ""
        intervalFactor: 1
        legendFormat: -> read
        refId: B
      thresholds: []
      timeFrom: ""
      timeRegions: []
      timeShift: null
      title: Disk IO
      tooltip:
        msResolution: true
        shared: true
        sort: 2
        value_type: cumulative
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: Bps
        label: ""
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: false
      yaxis:
        align: false
        alignLevel: null
    schemaVersion: 27
    style: dark
    tags:
    - cost
    - utilization
    - metrics
    templating:
      list:
      - allValue: null
        current:
          selected: false
          text: kind-control-plane
          value: kind-control-plane
        datasource: ${datasource}
        definition: query_result(kube_node_created)
        description: null
        error: null
        hide: 0
        includeAll: false
        label: null
        multi: false
        name: node
        options: []
        query:
          query: query_result(kube_node_created)
          refId: StandardVariableQuery
        refresh: 1
        regex: /node=\"(.*?)(\")/
        skipUrlSync: false
        sort: 0
        tagValuesQuery: ""
        tags: []
        tagsQuery: ""
        type: query
        useTags: false
      - current:
          selected: false
          text: Prometheus
          value: Prometheus
        description: null
        error: null
        hide: 0
        includeAll: false
        label: null
        multi: false
        name: datasource
        options: []
        query: prometheus
        refresh: 1
        regex: ""
        skipUrlSync: false
        type: datasource
    time:
      from: now-24h
      to: now
    timepicker:
      refresh_intervals:
      - 5s
      - 10s
      - 30s
      - 1m
      - 5m
      - 15m
      - 30m
      - 1h
      - 2h
      - 1d
      time_options:
      - 5m
      - 15m
      - 1h
      - 6h
      - 12h
      - 24h
      - 2d
      - 7d
      - 30d
    timezone: ""
    title: ACE / Node Utilization
    version: 3
  overwrite: true
  templatize:
    title: false
    datasource: false
---
# Source: opencost-grafana-dashboards/templates/dashboard.yaml
apiVersion: openviz.dev/v1alpha1
kind: GrafanaDashboard
metadata:
  name: ace-podutilization
  namespace: opencost-grafana-dashboards-v2023.10.1.tgz
  labels:
    k8s.io/group: cost.k8s.appscode.com
    k8s.io/kind: CostReport
    helm.sh/chart: opencost-grafana-dashboards-v2023.10.1
    app.kubernetes.io/name: opencost-grafana-dashboards
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v2023.10.1"
    app.kubernetes.io/managed-by: Helm
spec:
  model:
    annotations:
      list:
      - builtIn: 1
        datasource: -- Grafana --
        enable: true
        hide: true
        iconColor: rgba(0, 211, 255, 1)
        name: Annotations & Alerts
        target:
          limit: 100
          matchAny: false
          tags: []
          type: dashboard
        type: dashboard
    editable: true
    fiscalYearStartMonth: 0
    gnetId: null
    graphTooltip: 0
    iteration: 1694001975850
    links: []
    liveNow: false
    panels:
    - datasource: ${datasource}
      description: Maximum CPU Core Usage vs Requested
      fieldConfig:
        defaults:
          color:
            mode: palette-classic
          custom:
            axisLabel: ""
            axisPlacement: auto
            barAlignment: 0
            drawStyle: line
            fillOpacity: 0
            gradientMode: none
            hideFrom:
              legend: false
              tooltip: false
              viz: false
            lineInterpolation: linear
            lineWidth: 1
            pointSize: 5
            scaleDistribution:
              type: linear
            showPoints: auto
            spanNulls: false
            stacking:
              group: A
              mode: none
            thresholdsStyle:
              mode: "off"
          mappings: []
          thresholds:
            mode: absolute
            steps:
            - color: green
              value: null
            - color: red
              value: 80
        overrides: []
      gridPos:
        h: 9
        w: 12
        x: 0
        "y": 0
      id: 2
      options:
        legend:
          calcs: []
          displayMode: list
          placement: bottom
        tooltip:
          mode: single
      targets:
      - exemplar: true
        expr: |-
          max by (namespace, pod, container) (
            irate(container_cpu_usage_seconds_total{container="$container",namespace="$ns",pod="$pod"}[$__rate_interval])
          )
        interval: ""
        legendFormat: '{{pod}}/{{container}} (usage max)'
        refId: A
      - exemplar: true
        expr: |-
          avg by (namespace, pod, container) (
            kube_pod_container_resource_requests{container="$container",namespace="$ns",pod="$pod",resource="cpu"}
          )
        hide: false
        interval: ""
        legendFormat: ' {{pod}}/{{container}} (avg requested)'
        refId: B
      title: CPU Core Usage vs Requested
      type: timeseries
    - datasource: ${datasource}
      description: Max Memory usage vs avg requested
      fieldConfig:
        defaults:
          color:
            mode: palette-classic
          custom:
            axisLabel: ""
            axisPlacement: auto
            barAlignment: 0
            drawStyle: line
            fillOpacity: 0
            gradientMode: none
            hideFrom:
              legend: false
              tooltip: false
              viz: false
            lineInterpolation: linear
            lineWidth: 1
            pointSize: 5
            scaleDistribution:
              type: linear
            showPoints: auto
            spanNulls: false
            stacking:
              group: A
              mode: none
            thresholdsStyle:
              mode: "off"
          mappings: []
          thresholds:
            mode: absolute
            steps:
            - color: green
              value: null
            - color: red
              value: 80
        overrides: []
      gridPos:
        h: 9
        w: 12
        x: 12
        "y": 0
      id: 4
      options:
        legend:
          calcs: []
          displayMode: list
          placement: bottom
        tooltip:
          mode: single
      targets:
      - exemplar: true
        expr: "max(max_over_time(\n  container_memory_working_set_bytes\n  {namespace=~\"$ns\",pod=~\"$pod\",container=~\"$container\"}\n
          \ [$__rate_interval])) \nby (namespace,pod,container)"
        interval: ""
        legendFormat: '{{pod}}/{{container}} (usage max)'
        refId: A
      - exemplar: true
        expr: |-
          avg by (cluster_id, namespace, pod, container) (
            kube_pod_container_resource_requests{container=~"$container",namespace=~"$ns",pod=~"$pod",resource="memory",unit="byte"}
          )
        hide: false
        interval: ""
        legendFormat: '{{pod}}/{{container}} (avg requested)'
        refId: B
      title: Memory Usage vs Requested
      type: timeseries
    - datasource: ${datasource}
      description: Network traffic by pod
      fieldConfig:
        defaults:
          color:
            mode: palette-classic
          custom:
            axisLabel: ""
            axisPlacement: auto
            barAlignment: 0
            drawStyle: line
            fillOpacity: 0
            gradientMode: none
            hideFrom:
              legend: false
              tooltip: false
              viz: false
            lineInterpolation: linear
            lineWidth: 1
            pointSize: 5
            scaleDistribution:
              type: linear
            showPoints: auto
            spanNulls: false
            stacking:
              group: A
              mode: none
            thresholdsStyle:
              mode: "off"
          mappings: []
          thresholds:
            mode: absolute
            steps:
            - color: green
              value: null
            - color: red
              value: 80
        overrides: []
      gridPos:
        h: 9
        w: 12
        x: 0
        "y": 9
      id: 6
      options:
        legend:
          calcs: []
          displayMode: list
          placement: bottom
        tooltip:
          mode: single
      targets:
      - exemplar: true
        expr: "sum(irate(container_network_receive_bytes_total\n  {namespace=~\"$ns\",pod=~\"$pod\"}\n
          \ [$__rate_interval])) \nby (namespace, pod)"
        interval: ""
        legendFormat: '{{namespace}}/{{pod}}<- in'
        refId: A
      - exemplar: true
        expr: "- sum(irate(container_network_transmit_bytes_total\n  {namespace=~\"$ns\",pod=~\"$pod\"}\n
          \ [$__rate_interval])) \nby (namespace, pod)"
        hide: false
        interval: ""
        legendFormat: '{{namespace}}/{{pod}}-> out'
        refId: B
      title: Network IO
      type: timeseries
    - datasource: ${datasource}
      description: Disk read writes
      fieldConfig:
        defaults:
          color:
            mode: palette-classic
          custom:
            axisLabel: ""
            axisPlacement: auto
            barAlignment: 0
            drawStyle: line
            fillOpacity: 0
            gradientMode: none
            hideFrom:
              legend: false
              tooltip: false
              viz: false
            lineInterpolation: linear
            lineWidth: 1
            pointSize: 5
            scaleDistribution:
              type: linear
            showPoints: auto
            spanNulls: false
            stacking:
              group: A
              mode: none
            thresholdsStyle:
              mode: "off"
          mappings: []
          thresholds:
            mode: absolute
            steps:
            - color: green
              value: null
            - color: red
              value: 80
        overrides: []
      gridPos:
        h: 9
        w: 12
        x: 12
        "y": 9
      id: 8
      options:
        legend:
          calcs: []
          displayMode: list
          placement: bottom
        tooltip:
          mode: single
      targets:
      - exemplar: true
        expr: "sum(irate(container_fs_writes_bytes_total\n    {pod=~\"$pod\",container=~\"$container\"}\n
          \    [$__rate_interval])) \nby (namespace,pod,container)"
        interval: ""
        legendFormat: '{{pod}}/{{container}}<- write'
        refId: A
      - exemplar: true
        expr: "- sum(irate(container_fs_reads_bytes_total\n     {pod=~\"$pod\",container=~\"$container\"}\n
          \    [$__rate_interval])) \nby (namespace,pod,container)"
        hide: false
        interval: ""
        legendFormat: '{{pod}}/{{container}}-> read'
        refId: B
      title: Disk IO
      type: timeseries
    - datasource: ${datasource}
      description: This graph shows the % of periods where a pod is being throttled. Values
        range from 0-100
      fieldConfig:
        defaults:
          color:
            mode: palette-classic
          custom:
            axisLabel: ""
            axisPlacement: auto
            barAlignment: 0
            drawStyle: line
            fillOpacity: 0
            gradientMode: none
            hideFrom:
              legend: false
              tooltip: false
              viz: false
            lineInterpolation: linear
            lineWidth: 1
            pointSize: 5
            scaleDistribution:
              type: linear
            showPoints: auto
            spanNulls: false
            stacking:
              group: A
              mode: none
            thresholdsStyle:
              mode: "off"
          mappings: []
          thresholds:
            mode: absolute
            steps:
            - color: green
              value: null
            - color: red
              value: 80
        overrides: []
      gridPos:
        h: 10
        w: 24
        x: 0
        "y": 18
      id: 10
      options:
        legend:
          calcs: []
          displayMode: list
          placement: bottom
        tooltip:
          mode: single
      targets:
      - exemplar: true
        expr: |-
          100
            * sum by(namespace, pod, container) (increase(container_cpu_cfs_throttled_periods_total{namespace=~"$ns", pod=~"$pod", container=~"$container"}[$__rate_interval]))
            / sum by(cluster_id, namespace, pod, container) (increase(container_cpu_cfs_periods_total{namespace=~"$ns", pod=~"$pod", container=~"$container"}[$__rate_interval]))
        interval: ""
        legendFormat: __auto
        refId: A
      title: CPU throttle percent
      type: timeseries
    schemaVersion: 31
    style: dark
    tags: []
    templating:
      list:
      - allValue: null
        current:
          selected: false
          text: monitoring
          value: monitoring
        datasource: ${datasource}
        definition: label_values(kube_namespace_created,namespace)
        description: null
        error: null
        hide: 0
        includeAll: false
        label: ns
        multi: false
        name: ns
        options: []
        query:
          query: label_values(kube_namespace_created,namespace)
          refId: StandardVariableQuery
        refresh: 1
        regex: ""
        skipUrlSync: false
        sort: 0
        type: query
      - allValue: null
        current:
          selected: false
          text: prometheus-kube-prometheus-stack-prometheus-0
          value: prometheus-kube-prometheus-stack-prometheus-0
        datasource: ${datasource}
        definition: 'label_values(kube_pod_info{namespace=~"$ns"}, pod) '
        description: null
        error: null
        hide: 0
        includeAll: false
        label: pod
        multi: false
        name: pod
        options: []
        query:
          query: 'label_values(kube_pod_info{namespace=~"$ns"}, pod) '
          refId: StandardVariableQuery
        refresh: 1
        regex: ""
        skipUrlSync: false
        sort: 0
        type: query
      - allValue: null
        current:
          selected: false
          text: config-reloader
          value: config-reloader
        datasource: ${datasource}
        definition: 'label_values(container_memory_working_set_bytes{namespace=~"$ns",pod=~"$pod",
          container!="POD"}, container) '
        description: null
        error: null
        hide: 0
        includeAll: false
        label: container
        multi: false
        name: container
        options: []
        query:
          query: 'label_values(container_memory_working_set_bytes{namespace=~"$ns",pod=~"$pod",
            container!="POD"}, container) '
          refId: StandardVariableQuery
        refresh: 1
        regex: ""
        skipUrlSync: false
        sort: 0
        type: query
      - current:
          selected: false
          text: Prometheus
          value: Prometheus
        description: null
        error: null
        hide: 0
        includeAll: false
        label: null
        multi: false
        name: datasource
        options: []
        query: prometheus
        refresh: 1
        regex: ""
        skipUrlSync: false
        type: datasource
      - current:
          selected: true
          text: "23.06"
          value: "23.06"
        description: null
        error: null
        hide: 0
        label: rate_interval
        name: __rate_interval
        options:
        - selected: true
          text: 10m
          value: 10m
        query: 10m
        skipUrlSync: false
        type: textbox
    time:
      from: now-24h
      to: now
    timepicker: {}
    timezone: ""
    title: ACE / Pod Utilization
    version: 1
  overwrite: true
  templatize:
    title: false
    datasource: false
---
# Source: opencost-grafana-dashboards/templates/dashboard.yaml
apiVersion: openviz.dev/v1alpha1
kind: GrafanaDashboard
metadata:
  name: ace-resourceefficiency
  namespace: opencost-grafana-dashboards-v2023.10.1.tgz
  labels:
    k8s.io/group: cost.k8s.appscode.com
    k8s.io/kind: CostReport
    helm.sh/chart: opencost-grafana-dashboards-v2023.10.1
    app.kubernetes.io/name: opencost-grafana-dashboards
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v2023.10.1"
    app.kubernetes.io/managed-by: Helm
spec:
  model:
    annotations:
      list:
      - builtIn: 1
        datasource: -- Grafana --
        enable: true
        hide: true
        iconColor: rgba(0, 211, 255, 1)
        name: Annotations & Alerts
        type: dashboard
    editable: true
    gnetId: null
    graphTooltip: 0
    iteration: 1694520406416
    links: []
    panels:
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 9
        w: 12
        x: 0
        "y": 0
      hiddenSeries: false
      id: 2
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: |-
          sum by (namespace) (
              (
                sum by (namespace, pod, container) (
                  container_memory_usage_bytes{container!="",container!="POD",container=~"$container",namespace=~"$namespace"}
                )
              )
            -
              (
                sum by (namespace, pod, container) (
                  kube_pod_container_resource_requests{container!="",container!="POD",container=~"$container",namespace=~"$namespace",resource="memory",unit="byte"}
                )
              )
          )
        interval: ""
        legendFormat: ""
        refId: A
      - exemplar: true
        expr: |-
          sum by (namespace) (
              -(sum by (cluster_id,namespace,pod,container) (kube_pod_container_resource_requests{resource="memory",unit="byte",namespace=~"$namespace",container=~"$container",container!="POD",container!=""}))
          )
        hide: false
        interval: ""
        legendFormat: ""
        refId: B
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: Memory Request-Usage
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    - aliasColors: {}
      bars: false
      dashLength: 10
      dashes: false
      datasource: ${datasource}
      fieldConfig:
        defaults: {}
        overrides: []
      fill: 1
      fillGradient: 0
      gridPos:
        h: 9
        w: 12
        x: 12
        "y": 0
      hiddenSeries: false
      id: 4
      legend:
        avg: false
        current: false
        max: false
        min: false
        show: true
        total: false
        values: false
      lines: true
      linewidth: 1
      nullPointMode: "null"
      options:
        alertThreshold: true
      percentage: false
      pluginVersion: 7.5.5
      pointradius: 2
      points: false
      renderer: flot
      seriesOverrides: []
      spaceLength: 10
      stack: false
      steppedLine: false
      targets:
      - exemplar: true
        expr: "sum by (namespace)(\n    (sum by (cluster_id,namespace,pod,container) (rate(container_cpu_usage_seconds_total{namespace=~\"$namespace\",
          container=~\"$container\", container!=\"POD\",container!=\"\"}[1h])))\n    -
          \ \n    (sum by (cluster_id,namespace,pod,container) (kube_pod_container_resource_requests{resource=\"cpu\",namespace=~\"$namespace\",
          container=~\"$container\", container!=\"POD\",container!=\"\"}))\n)\n \n"
        interval: ""
        legendFormat: ""
        refId: A
      - exemplar: true
        expr: |-
          -sum by (namespace)(
              (sum by (cluster_id,namespace,pod,container) (kube_pod_container_resource_requests{resource="cpu",namespace=~"$namespace", container=~"$container", container!="POD",container!=""}))
          )
        hide: false
        interval: ""
        legendFormat: ""
        refId: B
      thresholds: []
      timeFrom: null
      timeRegions: []
      timeShift: null
      title: CPU Request-Usage
      tooltip:
        shared: true
        sort: 0
        value_type: individual
      type: graph
      xaxis:
        buckets: null
        mode: time
        name: null
        show: true
        values: []
      yaxes:
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      - format: short
        label: null
        logBase: 1
        max: null
        min: null
        show: true
      yaxis:
        align: false
        alignLevel: null
    schemaVersion: 27
    style: dark
    tags: []
    templating:
      list:
      - allValue: null
        current:
          selected: true
          text: kube-system
          value: kube-system
        datasource: ${datasource}
        definition: label_values(kube_namespace_created, namespace)
        description: null
        error: null
        hide: 0
        includeAll: false
        label: namespace
        multi: false
        name: namespace
        options:
        - selected: false
          text: default
          value: default
        - selected: false
          text: falco
          value: falco
        - selected: false
          text: kube-node-lease
          value: kube-node-lease
        - selected: false
          text: kube-public
          value: kube-public
        - selected: true
          text: kube-system
          value: kube-system
        - selected: false
          text: kubeops
          value: kubeops
        - selected: false
          text: local-path-storage
          value: local-path-storage
        - selected: false
          text: monitoring
          value: monitoring
        - selected: false
          text: opencost
          value: opencost
        - selected: false
          text: redis-hz05bz
          value: redis-hz05bz
        query:
          query: label_values(kube_namespace_created, namespace)
          refId: StandardVariableQuery
        refresh: 0
        regex: ""
        skipUrlSync: false
        sort: 0
        tagValuesQuery: ""
        tags: []
        tagsQuery: ""
        type: query
        useTags: false
      - allValue: null
        current:
          selected: false
          text: coredns
          value: coredns
        datasource: ${datasource}
        definition: "label_values(container_memory_working_set_bytes{namespace=~\"$namespace\",
          container!=\"POD\"}, container)\t\t"
        description: null
        error: null
        hide: 0
        includeAll: false
        label: container
        multi: false
        name: container
        options:
        - selected: true
          text: coredns
          value: coredns
        - selected: false
          text: etcd
          value: etcd
        - selected: false
          text: kindnet-cni
          value: kindnet-cni
        - selected: false
          text: kube-apiserver
          value: kube-apiserver
        - selected: false
          text: kube-controller-manager
          value: kube-controller-manager
        - selected: false
          text: kube-proxy
          value: kube-proxy
        - selected: false
          text: kube-scheduler
          value: kube-scheduler
        query:
          query: "label_values(container_memory_working_set_bytes{namespace=~\"$namespace\",
            container!=\"POD\"}, container)\t\t"
          refId: StandardVariableQuery
        refresh: 0
        regex: ""
        skipUrlSync: false
        sort: 0
        tagValuesQuery: ""
        tags: []
        tagsQuery: ""
        type: query
        useTags: false
      - current:
          selected: false
          text: Prometheus
          value: Prometheus
        description: null
        error: null
        hide: 0
        includeAll: false
        label: null
        multi: false
        name: datasource
        options: []
        query: prometheus
        refresh: 1
        regex: ""
        skipUrlSync: false
        type: datasource
    time:
      from: now-24h
      to: now
    timepicker: {}
    timezone: ""
    title: ACE / Resource Efficiency
    version: 1
  overwrite: true
  templatize:
    title: false
    datasource: false
