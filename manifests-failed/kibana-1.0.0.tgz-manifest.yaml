---
# Source: kibana/templates/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kibana-ingress
  annotations:
    nginx.ingress.kubernetes.io/affinity: "cookie"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
spec:
  ingressClassName: kibana-1.0.0.tgz
  rules:
  - http:
      paths:
      - path: /kibana
        pathType: Prefix
        backend:
          service:
            name: mbf-kb-http
            port:
              number: 5601
---
# Source: kibana/templates/kb.yaml
apiVersion: kibana.k8s.elastic.co/v1
kind: Kibana
metadata:
  name: mbf
spec:
  version: 8.9.1
  count: 1
  elasticsearchRef:
    name: mbf
  # https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-kibana-es.html
  config:
    server:
      basePath: "/kibana"
      rewriteBasePath: true
  http:
    tls:
      selfSignedCertificate:
        disabled: true
  podTemplate:
    spec:
      affinity:
        podAffinity:
          
        podAntiAffinity:
          
        nodeAffinity:
          
      containers:
      - name: kibana
        readinessProbe:
          httpGet:
            scheme: HTTP
            path: "/kibana/login"
            port: 5601
        env:
        - name: TZ
          value: Asia/Ho_Chi_Minh
        # env:
        #   - name: NODE_OPTIONS
        #     value: "--max-old-space-size=2048"
            # default is 1024, only need to increase this when installing some custom plugin or seeing the below error
            # this config is for "FATAL ERROR: CALL_AND_RETRY_LAST Allocation failed - JavaScript heap out of memory"
            # https://discuss.elastic.co/t/check-kibana-max-old-space-size/245310
        # resources:
        #   requests:
        #     memory: 2Gi #1Gi
        #   limits:
        #     memory: 4Gi #2Gi
