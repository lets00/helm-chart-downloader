---
# Source: passbolt/charts/mariadb/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-release-mariadb
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
  annotations:
automountServiceAccountToken: false
---
# Source: passbolt/charts/redis/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
automountServiceAccountToken: true
metadata:
  name: my-release-redis
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
---
# Source: passbolt/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-release-passbolt-sa-common
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: common
    app.kubernetes.io/type: sa
---
# Source: passbolt/charts/mariadb/templates/secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-release-mariadb
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  mariadb-root-password: "cm9vdA=="
  mariadb-password: "Q0hBTkdFTUU="
  mariadb-replication-password: "Q0hBTkdFTUU="
---
# Source: passbolt/charts/redis/templates/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-release-redis
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  redis-password: "Q0hBTkdFTUU="
---
# Source: passbolt/templates/secret-tls-ingress.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-release-passbolt-sec-tls-ingress-0
  labels:
    app.kubernetes.io/action: tls-ingress
    app.kubernetes.io/type: sec
type: Opaque
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURNVENDQWhtZ0F3SUJBZ0lRWlNxa3J5azVSSTZKVjEyS29WOGNxVEFOQmdrcWhraUc5dzBCQVFzRkFEQVQKTVJFd0R3WURWUVFERXdoMllYVnNkQzFqWVRBZUZ3MHlOREEyTVRZd01EQXpOVE5hRncweU5UQTJNVFl3TURBegpOVE5hTUJreEZ6QVZCZ05WQkFNVERuQmhjM05pYjJ4MExteHZZMkZzTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGCkFBT0NBUThBTUlJQkNnS0NBUUVBekFTTHRiYkZIeVUvYjloL0J6YkFwd0hwWlg2ajhkbkpuRHZRYzE2UU45NEcKeTNvSVNJeXhCU2xUWE1Qdis4c3k4eVl1VHVHRTRidDBFTGtrMlYyeXg4M3ZNVHl1TkZnYTdYcVAyYlIwNkxaRgpWb2JIMUhrNFFKUEpxMTJTUGZTQjdmdEkrS0Q5NzlvWjJIWW1QNWI2djJBUlZnczNmMk1FZUdnb2RiVlBUZEdDCjJyVTl6R3Iyd1VSd1RsRks1azhNbTBlSmk5TjJnM3I2MVZtMUVPblU4dUNvUnZXMndTUStqTEFsdEgzN1oxQk4KMC9OT1Q0dlN3SXZadlZtZnNtZTlLSDJNb2RWc2U0aGFBSkJOY2dtbE1BVGMrbXBQYWVOQWFZUTFkTEdiQ1JKcgpQYzUwWkJRSGIzOW5mQXdML2p1S2gzaEcwMmZxS05JVjdRK3lrb2pVT3dJREFRQUJvM3N3ZVRBT0JnTlZIUThCCkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQXdHQTFVZEV3RUIKL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVTlI4NlFKcVkrZzd4WTBLeGw2SG9KSU4vNUhzd0dRWURWUjBSQkJJdwpFSUlPY0dGemMySnZiSFF1Ykc5allXd3dEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBS2p2YUM2TUJzbkRHc21aCjZuSUtDTTRnajJhdGc3Q0gyQ0NMSTdpZG5jbU5pTHIrRUI2QitpTEYxdWh6TkJ0dlBnZmErOGp4Rk5sdEJsajcKV1U5V0wzNU0wbXJPNDRuY3NrU2xIVy84a3JxRzZkeG1JQitiL0dZdFRjVEgvNWFmK0NxQXpoWlU3TGpsV0tsbApYL1dmZG13VDZ4cS9RbFRpT0VHUnI0aWV2cWQySVhERWxpUlFNTFBMV3J5bGNJdW1CY25hTnVlOTdvOGR5OHBkCmExY2oyM3hOVVlrWDBoNHljRlZwS2hpWFo4dlE2QnlVTTMzVFA3T01MdGI1N0EyeEJDMGh6UHNyRytQbnp2N1gKaHN1YWpreUdpcWdRc2NQU2lDVlpuOVNHV3UxdE51RzUxL1A0V05MZkNDb2djZ0xsYVVOa2tqMGdUbHdLZUpregpHTzJKZ1FFPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBekFTTHRiYkZIeVUvYjloL0J6YkFwd0hwWlg2ajhkbkpuRHZRYzE2UU45NEd5M29JClNJeXhCU2xUWE1Qdis4c3k4eVl1VHVHRTRidDBFTGtrMlYyeXg4M3ZNVHl1TkZnYTdYcVAyYlIwNkxaRlZvYkgKMUhrNFFKUEpxMTJTUGZTQjdmdEkrS0Q5NzlvWjJIWW1QNWI2djJBUlZnczNmMk1FZUdnb2RiVlBUZEdDMnJVOQp6R3Iyd1VSd1RsRks1azhNbTBlSmk5TjJnM3I2MVZtMUVPblU4dUNvUnZXMndTUStqTEFsdEgzN1oxQk4wL05PClQ0dlN3SXZadlZtZnNtZTlLSDJNb2RWc2U0aGFBSkJOY2dtbE1BVGMrbXBQYWVOQWFZUTFkTEdiQ1JKclBjNTAKWkJRSGIzOW5mQXdML2p1S2gzaEcwMmZxS05JVjdRK3lrb2pVT3dJREFRQUJBb0lCQUMrUkg4SE9TMGRudDlLcgo5M0lISWdQT1BreWJxajNKT1doanljWWNWaU93Y0lVZ2ZxM3JuNXBFZUZzNGs4dHhKUC9yOXdBTk5KNHN4bkxmCnQrZTJJT2pVNnQvZjlmM2VUT2p4bW5oM3lvbzNkUk1uZVkvZ2MyMGJCL29jWnV4ckJhQW01bXlSbktNL2hxY2gKWk9tT21nZmtyaVlSbDI3cjl5N2JtaE5Yb3BYUnlKNVRJeDNPQ3ZnYUNmelVWR3NoNlYxVDR0eVdTTGxneU5OVAoxcDFSbk9hV3JReFZCZUhGbVY1WmE4Vm82NjRNb0dBQWNJQlp6b3dKUWRQeXRPdVdaZEQ1OTM1WEltajh1eE1hCjNPYXY4NDN2dGdjZ3NGUGxHU1ZDSHJ4N1IyQVdWMVdUR1JlTW1jaU1XNmpMem1zY2I3YjlvZW9wZ2FldkgwZ0kKS1A1RzFZRUNnWUVBMTBSY3Bna3M4V242aDNwRkVSbDBIbzd4Um5vY2pCTzJucTdtNkRxY0poOSswRE5BOGc2WApjZmFGUjJycGVxRG1wL2FpNFRFRFc3STlsdWs4T29EdmR2cFBEaVJBem4xVndNMWRXaVBiandWS3lKUVNzTGU3CldWNHJpWjRSTDJHWmEybmhKWUV4RDlrMFAzSlBiZWJxNkx3eVE5Y1ZOd1dyVngveVFhV3RITWNDZ1lFQThwOUQKWkVkZ3VOY1NIZzdJSGU1QnltaVl2UWVrbVRnZVpHUW9wZkxaTENSRytoSVFKQU9VcDRjYjlJNWt4UU9vNytnRgo1WGRiY3UvaVJIdlluMlEyVHFLR1J0ekVEVHlyc2QxUnh3eU9yNGpESUoyMy8yUEtaZTYrTXp2SlhwakVkLzBJCnJFTUdtTi9vY0ZRaUY2ejY4RWR1VndiYXJYendldHlKdUtpQlVPMENnWUVBdHR4TWM0S0IyZ1V6bXhnRFNaWTgKcktTeVVqTHl3dzhQNTFZZHNoSHZpUGJpSzR3T1ZGQ08xM0VaSUdTeU5zZ3RoMnFjUy96dHBGd1JzM3NtL1c5LwplNnIvc3J5YkRJMHRaaDFOZW4vUlIzbXdZQmhnbEJ0UEc0aENKYUhQYVZkWUV3V2JDdGZtekZhdTZtSjVGSnUrCjJycmJYQU45OHdKdTNSQzNJb3JSTmdzQ2dZQVVhcmlXR0xlWDltbE01RHVNNFQ3aUZKazkxd1hQNnZ3THdLMzMKQVErcmVrWUt4emhhZjM2ajltZXcxY2EvR1lhKzRZeVZlY3pWU0VDSE9OREs0UGo4OXdwTHJrcEZQdVRINi9MMAp5Q2E5dU1tSzFocmt2L1lKUytUdmxNbG1UMzdCQmljVHIvUS9LeUI1UzJzdkNOeDVHZG04TXhSMTR2eXRxaDlnCnpiVk1KUUtCZ0YrWlF5MUFZRXQyV3QveGt4RmtORDNOYzd1VnB4WHE3YUpFem8wZG5UMjFJMVJ6alM2L0hSZEcKeVp4cEIyL1VYTEtEcEFWcDFBeW5qVTBVcmoyY3U5MlpnLzB6ZGVZalErdk44aGNDeXhoTnFBVlc5R21sVVdYNQpmTm5Ea0wybVUzOElOU3huSkF1d3ZrK1Ywd0VtVWZ6U01COEtjd243VHpYeThLdjR6YzRWCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFakNDQWZxZ0F3SUJBZ0lSQVBvQXpwUGRBNTVSRncxbmxSVFdGSkl3RFFZSktvWklodmNOQVFFTEJRQXcKRXpFUk1BOEdBMVVFQXhNSWRtRjFiSFF0WTJFd0hoY05NalF3TmpFMk1EQXdNelV6V2hjTk1qVXdOakUyTURBdwpNelV6V2pBVE1SRXdEd1lEVlFRREV3aDJZWFZzZEMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQCkFEQ0NBUW9DZ2dFQkFMcnVIMGxXN3hGaU52Z3ppV0pqL3VmQjBaZWpmY25kL1J4QW5pUDBBeWxwcXIybGI3TEkKL0l3V0oxSGcrTTFqY2lZbXBDeWxBeEhLdTJmTVRxb3ZXaHp6aUFOYUduUXUvUEUrdGlYY2NoeHBQTlBHTUVRbgpIVGw4ZXZVODMrTnBCNFBUVTYxVHBIelh0NjFNczF5akZ2c1k2NmpTTTZuRzZENzJSNVNqNTdaeHZXQVhoYXdsCnJpdmxiZHIrSzNnd29BenAvWS9JaWZ2Tk9ERERLdHZvTU8yQ0dJekVWZ2VSNksvK2VFZHRuVk9VdGN5U3k1TmUKWmhNT3gvd1FmYzMvWUJhVXE2VFV1SVJuWS9aWkQraFhNaDJyZU1zeVFLSVBINW9Qa2Qva3lCUWwwR0RZNmxnRApoUUI1LzVjd1pPQTNCWGdocDRwd1Z1bDhLa1F0V0U3ZnNNTUNBd0VBQWFOaE1GOHdEZ1lEVlIwUEFRSC9CQVFECkFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUZCUWNEQWpBUEJnTlZIUk1CQWY4RUJUQUQKQVFIL01CMEdBMVVkRGdRV0JCUTFIenBBbXBqNkR2RmpRckdYb2Vna2czL2tlekFOQmdrcWhraUc5dzBCQVFzRgpBQU9DQVFFQWxtcVlqTUNzNTJ6dmZDMk95MDNkbGF6QytUamZZOG13cG9UZlp4VXVUL0U4NzZ6RWJaWkJmYnBjCjAzNnBqRGx6T3BBQkRvZ1lXaUZHc2pnbGh2OGZSV1hjRDZNUm1QQzVFUWsvWnd6T0QvUVMrZW1Lbm5LUmhLWk8KbHZOcVNvUVJFU085K2x0MEZaZFMySE5lNE8vc3VleTUyZlEraFRLa2hMYnhqNkQ5akhMZEtobnFVZ3NxaWttaApTNWpFSHBNY3VmaUF3VU9TS093ZmpPYVhmbCt1MG82bVFocWUwNmQ4SXlWRktxc01OMVE4NTZnZ3c5elUrUE5hCmFWMmFVdXNSbForK3ZyQkJyQlRuMTJyMzZHUkk5bzQ1VC9NY245TEJUNEJCU0FKa015bXk1cjN4b2prZXluUTkKMm1CWkdINDFUNGhLc09wdHBtYzl6blRxbXpwSDhBPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  ca.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdXU0ZlNWYnZFV0kyK0RPSlltUCs1OEhSbDZOOXlkMzlIRUNlSS9RREtXbXF2YVZ2CnNzajhqQlluVWVENHpXTnlKaWFrTEtVREVjcTdaOHhPcWk5YUhQT0lBMW9hZEM3ODhUNjJKZHh5SEdrODA4WXcKUkNjZE9YeDY5VHpmNDJrSGc5TlRyVk9rZk5lM3JVeXpYS01XK3hqcnFOSXpxY2JvUHZaSGxLUG50bkc5WUJlRgpyQ1d1SytWdDJ2NHJlRENnRE9uOWo4aUorODA0TU1NcTIrZ3c3WUlZak1SV0I1SG9yLzU0UjIyZFU1UzF6SkxMCmsxNW1FdzdIL0JCOXpmOWdGcFNycE5TNGhHZGo5bGtQNkZjeUhhdDR5ekpBb2c4Zm1nK1IzK1RJRkNYUVlOanEKV0FPRkFIbi9sekJrNERjRmVDR25pbkJXNlh3cVJDMVlUdCt3d3dJREFRQUJBb0lCQUVSQlVwYzY4UXhONm5oeQppUVd1TVpONlNBZXdvT3VtN1JiMTJVaVRmdHdPUTFRQUptc0h6SDl5VDJVc1dtelVsUWV0TUdGRTEzd1ZwSnhnCkU1RTh2UkM1TTc3VmxiYzZ1UTExc3BqY2g2WXNIeFBNMkM3cWdWZE9ScTlwVE84Q21NWGYwandGd0pmOVJJbzQKNlgwMzU5cEQzVGpGbUN1ei8zV09BOUVZa0RFamNvQWM1cDZnUEJYVUVHbG5weWNMczFZQWh4VGlmQnVmcWx0OQptZHVydnFsUEJxa1RSMlFTa3BiNnl3M1JidmdBd2ZUeTdMa0hZT0NkaDNvc2thL0JNb3FseVhnVW5yUG1xTXhNCk1yMjlDOS9nME1xWHo5bWhtQzUyb0F5ck9FeFhIQ1dCaGQ1WUd0R1AxTkNXa25PSjNiRUVaenQzYVZQQVNqRHoKQ1dZK3FlRUNnWUVBeUg0bkhtQVRZZWlwTkY1QlB5OCtJUXJaVzVmQlJDenNIWXBZVGp0enl0VVhQajB0V2xJTwp5VFpWek4vUWRMZTU2QXhlUUVVY2Zra3JHTmtXVzlzVmE5ZEJIMlBUK3QwL0FzbE81ZUs5WGNCcFNHdk9LaU5PCjVlVnU4VGJQTUltOVZYUlVVRW5EbEh2N1gzQ1lhbkxWMzRYQ0d3cVF5S3lHbkxSRVF6WFZnRGtDZ1lFQTdxNjUKWGFjWjZEeWt6ZXBJa1NjczkzS21tdSthWm9yZFhDdy9pdHdzcDhUZTBXakFkdThjSTEvQlZxWlIwTmw2TTgvRgpuRnZNdzhlWWY1NnZ6aWppeUltYjNUejZ3MWF4OTlXZ29SYi9kcVFkSlZFOTd6MXFDNTVZaWpQWDhNUDlpZ0JWCmZyd1hKWlVpTVNVcXJYeXNqaGQrYTVLbTNxeDAyN1VnUEtVVEFOc0NnWUVBcEN4eEdmVndTYTg3eHU4Ym5JS3gKN0ZxMjY4S1RkcUVXWTRZaWswVXBwMERndkkxWjh1all4TGtpZnhZUzIxQ0xBZElHNTdmd0FoVW1IajI5aWxBVwo5V3laSGZ3ZjIvK0psbDJEcHNrSmFaaWlYYlF4YU4zcXdHUWtlWTc1RC9UcVBleDVFaG1rOXBTam5WNVU0RzNTClppdGdhOFkyRXF6N3Vadi9mYzI2V3prQ2dZRUEydDNkbk1OZVBsZGR5SFRObGswV0x0SXpkRi9DZGNWZ3R1VGMKWDdrR09kR05nUGxOZzhJL1N6RERXWEdxRkpsWU5hcVF5cEJqZENQUzh6UFFnbnQ3ZWVpMXhHbm1pTGsyK013cwpQNHVYTm5QSFJqRDVXaWcyMWZDZHdCMUtKcjJTQUxuTnJDbE9FR2h3c2lBaXduTlF4L3RETWVHSW95Z0JBSGRXCjJFV0c1NEVDZ1lBb0w4alhCQjdIZjNSTENkM1NCTkE0ditXY1NlKzJaUVU3TzV0OEdvQnZtdjErd0w0NFdSZlYKMFhDcStJVUdkWXhGY0Myc09XQTRranpENmhJT3QvbDJUOHJkN3VHK2N6U1NqZzhOYmc2OHVnN1ZNWmkzVTVjVgpJRy82YVJWcTJ1Lzd0TDYzYUlCaFAzc1VJSk1UWmZlcktaNlIvNy84UEYwYnFDOEhST25jZ2c9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
# Source: passbolt/templates/secret-tls-internal.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-release-passbolt-sec-tls-internal
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: tls-internal
    app.kubernetes.io/type: sec
type: Opaque
data:
  server.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUROakNDQWg2Z0F3SUJBZ0lSQUo5ZDVOckEwd0doVENFTDg2a1FMVTR3RFFZSktvWklodmNOQVFFTEJRQXcKRXpFUk1BOEdBMVVFQXhNSWRtRjFiSFF0WTJFd0hoY05NalF3TmpFMk1EQXdNelV6V2hjTk1qVXdOakUyTURBdwpNelV6V2pBNE1UWXdOQVlEVlFRREV5MXRlUzF5Wld4bFlYTmxMWEJoYzNOaWIyeDBMV1JsWm1GMWJIUXRjM1pqCkxtTnNkWE4wWlhJdWJHOWpZV3d3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQ3gKTXkxUlZ0SU83ZFRiRCtLUzFia1RmQkx2NnFESWVyYkdmVzc1Q2g5enA0VW1uaG5sQzhUMFRVSzU5ZVBxS1lMaAppVFl5cHNpTXFRcmsybEZtaU00UWUwcDlZTDBKR001VVAvTTczc3ErbU5VM1BuZGJRVGhxVUZXWVhSRXcwMHpJCjIxZ01VRUVnRXBFZTcxS0pPb3VCV1dpWjBIU2V2eVdSOUtSSXFrWE1id3RycTZydGdXWEYwWWhEM1hKMVE2QVMKZnVvanhvY0FLNDFRb21NZHVDemJlUWZzc0haZ1ZjUUdFZUVHZ3NJblB2VUVhZW5BNWU5dTVwcFh5MHZNemlVcwpkR2lhTVptL09BcG1kZHdTclJFWjZMTW1ZZ2EySnN2WitMRmFKdTV5Qmg3Y0k1ZGhXV3hxWHVtZU5XNEI4RFpCCmZxUXBFeU9CUDN4UktCeVhORGNYQWdNQkFBR2pZREJlTUE0R0ExVWREd0VCL3dRRUF3SUZvREFkQmdOVkhTVUUKRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdEQVlEVlIwVEFRSC9CQUl3QURBZkJnTlZIU01FR0RBVwpnQlQzS0I2NU9FbFdXVlJUZ0h1R3R0VWtsOVNTY0RBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQUNMNmtUeEVFClFoVEFBaTh4N3FkWDI0VXBOaWhYYzBwMVZoaExab3FhTzJIdHdPNWUvamVleGFONE1pRVNWYUp4LzlyRXRNU1gKbm1KN1c3VUljUEx6NTBFZEFvV0tUd3FmWnV4NE9nalVGeFppREtQQmxka21aRE9CUUdncExNMk1Mc0xWZVBVRQplc29mL1JFKy81RGh5bEwvYjQ2Tk4wNzBFNVA1cW11ckNtdmdKdUN4WGJVVmpRajNhWjEyNFF3RHA2Z2NyN1RLCjRmVTducXZ2bkh4L1h5bkxFVUpuL0ZuZm5JS2d4Y3VuSnl4UzNYamNBc1hjeUNPODdBeVFkRXhtdzkyZm9meUMKeTdvNE5hTnZwSmNwOGluK092TzQ0Q1o1YUt2QWxiS2N1STlEcFh4SU41TXhTQ3FCM1pvMVZJWTBuVTFhRUdINgovSDZIYVVVeXZXeU5Xdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  server-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBc1RNdFVWYlNEdTNVMncvaWt0VzVFM3dTNytxZ3lIcTJ4bjF1K1FvZmM2ZUZKcDRaCjVRdkU5RTFDdWZYajZpbUM0WWsyTXFiSWpLa0s1TnBSWm9qT0VIdEtmV0M5Q1JqT1ZEL3pPOTdLdnBqVk56NTMKVzBFNGFsQlZtRjBSTU5OTXlOdFlERkJCSUJLUkh1OVNpVHFMZ1Zsb21kQjBucjhsa2ZTa1NLcEZ6RzhMYTZ1cQo3WUZseGRHSVE5MXlkVU9nRW43cUk4YUhBQ3VOVUtKakhiZ3MyM2tIN0xCMllGWEVCaEhoQm9MQ0p6NzFCR25wCndPWHZidWFhVjh0THpNNGxMSFJvbWpHWnZ6Z0tablhjRXEwUkdlaXpKbUlHdGliTDJmaXhXaWJ1Y2dZZTNDT1gKWVZsc2FsN3BualZ1QWZBMlFYNmtLUk1qZ1Q5OFVTZ2NselEzRndJREFRQUJBb0lCQUdCWVZBNkNweW1vMUcvYgpIalQ1OFd3UHJQZzNXUDVJQW5LL3BvUFBwalFxNURHUUNzSkhlT25mekNUeDlkN09mVFFGZDZ0b2xXZ3RUUmdMClAvRUE5eEZ0QjU1TjU5bzNXNC9oU1czRy8vTkxnN3BLdzNpaGFId2RlN3lnOVlUWGprc3pQNWRLVjI2SnljL0oKRGRaQk43SzNtekR1YjBvVTRlZU8zWGdJNUhSM0R6ZFUyb1dBQ2dkTU5EZk5wRC80aFVWRi9IMHNkQ0p5WW1ubQpvblg1ZlBIcCtwV1liMEcwTU5wVHk1d2p6bEJxV1N1YWQreERweGhwM1ZEUzZHQjNkWFZjMXdBVE1WZ2YzaUpjCkFxL29jeXNFbWRqdDVOZzNpODM5dDRwdGJUaHFidUxUaTZ5VmJSbGVnNWxtOGNnbUxBQ2E1dWk0OUZsTTZCS1QKaFFVMm1nRUNnWUVBNjNWT1FKbUpWcFhoVlBxRXNBc0JKYVRrc0hlMklkUUJxY1hsUUx2ZHhyVTV2bkZSMm8rOQplLzI3eHVJM2x6c240SStRQlR1cUFzN1gwaWoxSlFqUDl6R2FVaTRzaC9DMlZZbzRqVk11Y2dTaFB0UTFTc1pPCnY4di9iUnd2czhUQnBaYjFkV0tVak96NGdNTzlobGd2YzQ1RXpOb2U1M2hJem8wRTBBNWNOd0VDZ1lFQXdLaTgKeTd6eks1QWlsSnNPSzg0Y0JNZFhJQW1HazFqWXVKV3NUSHcvc1JmNnliQ1J6aTd0NmpPQ2QwZTVUc1ZDMjIxcQovY0Q1bWwwcUh0QnBOcktpL1RwbzQybm1KdnZkL05UZUIwV0EydTYrY1V5ODhLZWxSSmR4U05iSXlPOXdGblpFCmpUTDc4MVdoVjlIa3Z4MHJmMU9zdkpldXBYaUJpUVdjbjc3aFJoY0NnWUVBMjVlMm1GYlpHRENHUzF1czNnWVYKVnNkWEpTRXdjcEluenU4cVpOb1E5dDVUY1VKOFJXc2pHLzFDNERSZ0JpSDhpZGs2UnpjaTBxV1g4SCtVU2FyVApVY1lvRjViS255bW0wMVlxY2R0dkNKVTYwTDdXeU5yejNMcGppSjN0K3lsNE5IZjZpalNiT0dkVlI3bkdDd0k1Cmx2ckxQWVg3cG9LdTNEdjJqaGVtZHdFQ2dZRUFyY3JKWElTYlc0M1BFL3ozZ0o2UitlR1VmNHI0UWcwZ213b3gKZm1HSzF3Y0pyVTFCaWh3ZGRHcDQ0MzdvODl6UVhiN0xpQksvVnZkNTJvZ29rVFg5LzY3a0ZWbGZTNFZqRUFNNgpNcGNKRVBYVEI4T3dvT3FxRkVFRTZTOFB1dXI3VXRmbktQUjRBVjhhaDIwSkN6bVdGbXIxNUw1enhrTDVueEJYCjVHYTlNb3NDZ1lBZFFJZFhwT3k4cDMwa0ZKTzdXSC9KRWJnTmFFclVneUg4RnBjZ3hxdVIvdk5PVk56d3VERHIKUzV1Y040cjM0cUVmek0xQ2d2VlAwcFJpNEFTSzZJTm43bnNtSnZ5bVlYcGNYbFd4OUhucDdpb1hGa2VSVmlzMgo2eWI3WEQ4MEpWSUVYV0NuS09MNm84V0RSN0h5MUJpWFYrd1R5ZndKY1c0UlJkTzdELzNYVmc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFakNDQWZxZ0F3SUJBZ0lSQUwwYTR2Y29PZnBQRlJJUkppRTVYNjR3RFFZSktvWklodmNOQVFFTEJRQXcKRXpFUk1BOEdBMVVFQXhNSWRtRjFiSFF0WTJFd0hoY05NalF3TmpFMk1EQXdNelV5V2hjTk1qVXdOakUyTURBdwpNelV5V2pBVE1SRXdEd1lEVlFRREV3aDJZWFZzZEMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQCkFEQ0NBUW9DZ2dFQkFNVDNnekxwZkFSTGErb1lxZ2VpUkxSUkFSakJHWFJMb0JCeVFxV0ZYbTRHcXBBZWltNWgKQmMwdnc0a0ljSGNxMEpoSjdoVGFLUlFIZENUeEtjc0NibVF1YlJlTGpSOEFTRURRMGFNa2lINzNILzVWVjg3MwpuRGd2by9ITVdBUFh3bTRSWEtGbDNZK2lPNmtaRFZDb1BnQXBvLzhWNm9zZk16RkNLZVE5MUJlRGRLb1pleXpCCktzakJmVSszZlpUWEVKVVBaMGY2V2J2L2J4MWQxL0lzbWtGdXF4bnNlTkZPOCt5VjgrVmdNaTc0STZndWVrb2wKNXYzRDFTckkrcllxWjZNN2lmYU4rU2Z6blY1QzQ5dEYrbmUrZ2ordFIwSlJKOTQ3S0hNQ2RMTHhrR09kTmNiVQpIR1ZRRjlDZ2lZbDFVa0pNUWtHdFpCZWdKUXBlNVEvZFNzc0NBd0VBQWFOaE1GOHdEZ1lEVlIwUEFRSC9CQVFECkFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUZCUWNEQWpBUEJnTlZIUk1CQWY4RUJUQUQKQVFIL01CMEdBMVVkRGdRV0JCVDNLQjY1T0VsV1dWUlRnSHVHdHRVa2w5U1NjREFOQmdrcWhraUc5dzBCQVFzRgpBQU9DQVFFQWlxU2dUVVp5Ti9zMVVUUHB4SWlTWWxIdytKTlhIaHBmUThWWkd5YndCZFJmOFkzMW5URTNTSzJxCk9tRWhobG11Q2F3SDlpYkNNRnpLRGQ1QUlEK0tJM3g1YnlWeTh1VFg2K2pCOHJiL05sd0NadzlhbmZGK0p6U3IKalBGMjFXRWMvUm85MVU5cjlKUFM2U1V3RWhWcUZkQWlhVmhUY0RwSUxnZ29ndEtMbmRTNUhOajBRbExzQ1cyZApZRUw3YU9UdG5OaXdtMVMvZDJIRVVDOCtCRjR5eVZLZEZKdUxXYnZBVitLNlZKM0dqK2VVY3RQQjExaEVpNjkyCitYNWxTUkpIVW1iU1ZPOS9rU1JHclU4NEpiSFNNVkp4WXhNcndvUVJ3VHEvS0ExZFZubmdNeTRLMXkxT2o0b1MKcW81dWZ6ZDdGTm9hc0xma3FlNWZYQk9yZVJER0NBPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  ca.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBeFBlRE11bDhCRXRyNmhpcUI2SkV0RkVCR01FWmRFdWdFSEpDcFlWZWJnYXFrQjZLCmJtRUZ6Uy9EaVFod2R5clFtRW51Rk5vcEZBZDBKUEVweXdKdVpDNXRGNHVOSHdCSVFORFJveVNJZnZjZi9sVlgKenZlY09DK2o4Y3hZQTlmQ2JoRmNvV1hkajZJN3FSa05VS2crQUNtai94WHFpeDh6TVVJcDVEM1VGNE4wcWhsNwpMTUVxeU1GOVQ3ZDlsTmNRbFE5blIvcFp1Lzl2SFYzWDhpeWFRVzZyR2V4NDBVN3o3Slh6NVdBeUx2Z2pxQzU2ClNpWG0vY1BWS3NqNnRpcG5venVKOW8zNUovT2RYa0xqMjBYNmQ3NkNQNjFIUWxFbjNqc29jd0owc3ZHUVk1MDEKeHRRY1pWQVgwS0NKaVhWU1FreENRYTFrRjZBbENsN2xEOTFLeXdJREFRQUJBb0lCQUJ0dS9lOFJaaHlUQkt6TwpVcUJOa1pRcjFDTkdnZTBZdTJxTy80bGVVaEN4RFFDVndHSXZVVWVLNTRrbWk4T05TeEJxKzZZYjNLelZmTy9JClJ6SG5YTWpIVHBxQTdWN3NBeVJEOFc3dm43TlBhRDFjVmFhV0JrUXRIb0NISFpzcmFnRTZtZFJCQStNRmpabTMKeTRyNFkrcFI0bTJjOTlYNHVvQ1ozb3ZUc0w2MWFZeUtzam1zT3hpUTR1aHA0R0FzdGVzcm8yTCswZktGeHVkegpFczJSQUpyVEV5NUNSMzVZdHF0VGIwQnQ5RGtWTkJIamN4MWpweWhLVkU0RERzVUxvRTg1OFViYnhsaWpjb1hJCnVzZVd5azA0alRzenFGREhzZ3FNc3YxeXdyMzNjMlNNdjhhamhhbWdLdDNCR1I5L09ybEpuZC9DMCtTOG5ORG0KWFFkSUdzRUNnWUVBeUZJR1hiUmRaSTBBdkxUeVIzZ0dINTkrYWhqQWlvV0VIaDZmZjIrMlU1eWVhVk5ITSswQwpZakpKVWRkbnU2QTdMUlhTWXFPWW1LMnlIUzU3QzlOdXVkZmxmYW10V3hhSHJjalNJQ1dnbElydW9qTWVTREtHCitQVVVWVW93aERySWlKZ0ltbGo0QkxoRWZiUnlTRkdyU2FOdXJDb1hyN1dIS2NIY0l5ZkVwVzhDZ1lFQSs3YmMKb1F5ODhBNFlZYWx4dWNIT1RXYWFPbmx0dVMvN25PaDUyZk0xNzBJMjJQWFZXSjVLb2plby83c0l0aFJyWDlMOQpmcHhFQ1JrTzViOFNIamxGU2Q4OXpYU3NNY3p3cThxR0VEVjlhSUZDNTh2cXFhMjkvUW54dUN6cjlkVnZOK3ZpCmtKQ0xNMXBRemY4Z1lDbmVZM2xHWTFqYTdrZ09uZ1J3YXV0UldtVUNnWUJFSkFyQVV6czFtZlUzTzhIeVo3U0YKaTBhQUpwMVFRV3lZcGtnUkhGb0VCUkdwdUVkUE5YOExFaG40dWZJeVU2WHRoeS9DbCsydmVkNU5xT0w0T2RxLwpZdDVRcWFncmhQVndPeENuR01XUDRkYWMzQkNmOUhnUE5hYk9BR2VTZzBCMW5tbkd2eDdXMUN1UUt4SjQ0VGNICjNJMG9DVVYzWXFOd285NFRJMUwwQndLQmdDWXZhV3p0RjhSNi91dmgzcVRGWjl5S0VoK0l5RUp0cXdmMHBIZVIKMDc3R0ZyZjNJelJjWHdvWTA0Um9CVHhLQUxmNnRBWC9BcnMybC9IMmVITXBVUCtSNURoRTJOSjlPbzExSGIxYgp2L2lZazJQQ3BZaTBHTHhJUStraXQzRUZ2ZWVIMjBqL0JINzMxb1pKaThuSzBEZmE3L2ltUkNBZHdrbnFkbnRoCjAyZVpBb0dCQUlBZmgwdEZna25GNGpLZGJGcDVydllneG5jTXRSa2srK3BYc0twSVR0ZTlvcE45T21MeUZpNGMKYXJXSXIzNVpXUWNsNlRZaFMzZWo1dXFnZWpmRUswc2V3czZLV3dkalFzbXZoeWxVMzNiZmgzR0tNOVRCYzF0SApIa0hiZ2s2VmhkTVpGaG9haUpjMTJ2d1EyL2xQV1VheFRJYXV2Si8ybVBsM25TSldXRXh0Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
---
# Source: passbolt/charts/mariadb/templates/primary/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-mariadb-primary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: primary
data:
  my.cnf: |-
    [mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    basedir=/opt/bitnami/mariadb
    plugin_dir=/opt/bitnami/mariadb/plugin
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    tmpdir=/opt/bitnami/mariadb/tmp
    max_allowed_packet=16M
    bind-address=*
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error=/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server=UTF8
    collation-server=utf8_general_ci
    slow_query_log=0
    slow_query_log_file=/opt/bitnami/mariadb/logs/mysqld.log
    long_query_time=10.0
    
    [client]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set=UTF8
    plugin_dir=/opt/bitnami/mariadb/plugin
    
    [manager]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
---
# Source: passbolt/charts/mariadb/templates/secondary/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-mariadb-secondary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: secondary
data:
  my.cnf: |-
    [mysqld]
    skip-name-resolve
    explicit_defaults_for_timestamp
    basedir=/opt/bitnami/mariadb
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    tmpdir=/opt/bitnami/mariadb/tmp
    max_allowed_packet=16M
    bind-address=0.0.0.0
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
    log-error=/opt/bitnami/mariadb/logs/mysqld.log
    character-set-server=UTF8
    collation-server=utf8_general_ci
    slow_query_log=0
    slow_query_log_file=/opt/bitnami/mariadb/logs/mysqld.log
    long_query_time=10.0
    
    [client]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    default-character-set=UTF8
    
    [manager]
    port=3306
    socket=/opt/bitnami/mariadb/tmp/mysql.sock
    pid-file=/opt/bitnami/mariadb/tmp/mysqld.pid
---
# Source: passbolt/charts/redis/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-redis-configuration
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
data:
  redis.conf: |-
    # User-supplied common configuration:
    # Enable AOF https://redis.io/topics/persistence#append-only-file
    appendonly yes
    # Disable RDB persistence, AOF persistence already enabled.
    save ""
    # End of common configuration
  master.conf: |-
    dir /data
    # User-supplied master configuration:
    rename-command FLUSHDB ""
    rename-command FLUSHALL ""
    # End of master configuration
  replica.conf: |-
    dir /data
    # User-supplied replica configuration:
    rename-command FLUSHDB ""
    rename-command FLUSHALL ""
    # End of replica configuration
  sentinel.conf: |-
    dir "/tmp"
    port 26379
    sentinel monitor mymaster my-release-redis-node-0.my-release-redis-headless.default.svc.cluster.local 6379 2
    sentinel down-after-milliseconds mymaster 60000
    sentinel failover-timeout mymaster 180000
    sentinel parallel-syncs mymaster 1
    # User-supplied sentinel configuration:
    # End of sentinel configuration
---
# Source: passbolt/charts/redis/templates/health-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-redis-health
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
data:
  ping_readiness_local.sh: |-
    #!/bin/bash

    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h localhost \
        -p $REDIS_PORT \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    if [ "$response" != "PONG" ]; then
      echo "$response"
      exit 1
    fi
  ping_liveness_local.sh: |-
    #!/bin/bash

    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h localhost \
        -p $REDIS_PORT \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    responseFirstWord=$(echo $response | head -n1 | awk '{print $1;}')
    if [ "$response" != "PONG" ] && [ "$responseFirstWord" != "LOADING" ] && [ "$responseFirstWord" != "MASTERDOWN" ]; then
      echo "$response"
      exit 1
    fi
  ping_sentinel.sh: |-
    #!/bin/bash
    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h localhost \
        -p $REDIS_SENTINEL_PORT \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    if [ "$response" != "PONG" ]; then
      echo "$response"
      exit 1
    fi
  parse_sentinels.awk: |-
    /ip/ {FOUND_IP=1}
    /port/ {FOUND_PORT=1}
    /runid/ {FOUND_RUNID=1}
    !/ip|port|runid/ {
      if (FOUND_IP==1) {
        IP=$1; FOUND_IP=0;
      }
      else if (FOUND_PORT==1) {
        PORT=$1;
        FOUND_PORT=0;
      } else if (FOUND_RUNID==1) {
        printf "\nsentinel known-sentinel mymaster %s %s %s", IP, PORT, $0; FOUND_RUNID=0;
      }
    }
  ping_readiness_master.sh: |-
    #!/bin/bash

    [[ -f $REDIS_MASTER_PASSWORD_FILE ]] && export REDIS_MASTER_PASSWORD="$(< "${REDIS_MASTER_PASSWORD_FILE}")"
    [[ -n "$REDIS_MASTER_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_MASTER_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h $REDIS_MASTER_HOST \
        -p $REDIS_MASTER_PORT_NUMBER \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    if [ "$response" != "PONG" ]; then
      echo "$response"
      exit 1
    fi
  ping_liveness_master.sh: |-
    #!/bin/bash

    [[ -f $REDIS_MASTER_PASSWORD_FILE ]] && export REDIS_MASTER_PASSWORD="$(< "${REDIS_MASTER_PASSWORD_FILE}")"
    [[ -n "$REDIS_MASTER_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_MASTER_PASSWORD"
    response=$(
      timeout -s 15 $1 \
      redis-cli \
        -h $REDIS_MASTER_HOST \
        -p $REDIS_MASTER_PORT_NUMBER \
        ping
    )
    if [ "$?" -eq "124" ]; then
      echo "Timed out"
      exit 1
    fi
    responseFirstWord=$(echo $response | head -n1 | awk '{print $1;}')
    if [ "$response" != "PONG" ] && [ "$responseFirstWord" != "LOADING" ]; then
      echo "$response"
      exit 1
    fi
  ping_readiness_local_and_master.sh: |-
    script_dir="$(dirname "$0")"
    exit_status=0
    "$script_dir/ping_readiness_local.sh" $1 || exit_status=$?
    "$script_dir/ping_readiness_master.sh" $1 || exit_status=$?
    exit $exit_status
  ping_liveness_local_and_master.sh: |-
    script_dir="$(dirname "$0")"
    exit_status=0
    "$script_dir/ping_liveness_local.sh" $1 || exit_status=$?
    "$script_dir/ping_liveness_master.sh" $1 || exit_status=$?
    exit $exit_status
---
# Source: passbolt/charts/redis/templates/scripts-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-redis-scripts
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
data:
  start-node.sh: |
    #!/bin/bash

    . /opt/bitnami/scripts/libos.sh
    . /opt/bitnami/scripts/liblog.sh
    . /opt/bitnami/scripts/libvalidations.sh

    get_port() {
        hostname="$1"
        type="$2"

        port_var=$(echo "${hostname^^}_SERVICE_PORT_$type" | sed "s/-/_/g")
        port=${!port_var}

        if [ -z "$port" ]; then
            case $type in
                "SENTINEL")
                    echo 26379
                    ;;
                "REDIS")
                    echo 6379
                    ;;
            esac
        else
            echo $port
        fi
    }

    get_full_hostname() {
        hostname="$1"
        full_hostname="${hostname}.${HEADLESS_SERVICE}"
        echo "${full_hostname}"
    }

    REDISPORT=$(get_port "$HOSTNAME" "REDIS")

    HEADLESS_SERVICE="my-release-redis-headless.default.svc.cluster.local"

    if [ -n "$REDIS_EXTERNAL_MASTER_HOST" ]; then
        REDIS_SERVICE="$REDIS_EXTERNAL_MASTER_HOST"
    else
        REDIS_SERVICE="my-release-redis.default.svc.cluster.local"
    fi

    SENTINEL_SERVICE_PORT=$(get_port "my-release-redis" "SENTINEL")
    validate_quorum() {
        if is_boolean_yes "$REDIS_TLS_ENABLED"; then
            quorum_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT --tls --cert ${REDIS_TLS_CERT_FILE} --key ${REDIS_TLS_KEY_FILE} --cacert ${REDIS_TLS_CA_FILE} sentinel master mymaster"
        else
            quorum_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT sentinel master mymaster"
        fi
        info "about to run the command: $quorum_info_command"
        eval $quorum_info_command | grep -Fq "s_down"
    }

    trigger_manual_failover() {
        if is_boolean_yes "$REDIS_TLS_ENABLED"; then
            failover_command="REDISCLI_AUTH="\$REDIS_PASSWORD" redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT --tls --cert ${REDIS_TLS_CERT_FILE} --key ${REDIS_TLS_KEY_FILE} --cacert ${REDIS_TLS_CA_FILE} sentinel failover mymaster"
        else
            failover_command="REDISCLI_AUTH="\$REDIS_PASSWORD" redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT sentinel failover mymaster"
        fi

        info "about to run the command: $failover_command"
        eval $failover_command
    }

    get_sentinel_master_info() {
        if is_boolean_yes "$REDIS_TLS_ENABLED"; then
            sentinel_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" timeout 99 redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT --tls --cert ${REDIS_TLS_CERT_FILE} --key ${REDIS_TLS_KEY_FILE} --cacert ${REDIS_TLS_CA_FILE} sentinel get-master-addr-by-name mymaster"
        else
            sentinel_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" timeout 99 redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT sentinel get-master-addr-by-name mymaster"
        fi

        info "about to run the command: $sentinel_info_command"
        retry_while "eval $sentinel_info_command" 2 1
    }

    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
    [[ -f $REDIS_MASTER_PASSWORD_FILE ]] && export REDIS_MASTER_PASSWORD="$(< "${REDIS_MASTER_PASSWORD_FILE}")"

    # check if there is a master
    master_in_persisted_conf="$(get_full_hostname "$HOSTNAME")"
    master_port_in_persisted_conf="$REDIS_MASTER_PORT_NUMBER"
    master_in_sentinel="$(get_sentinel_master_info)"
    redisRetVal=$?

    if [[ $redisRetVal -ne 0 ]]; then
        if [[ "$master_in_persisted_conf" == "$(get_full_hostname "$HOSTNAME")" ]]; then
            # Case 1: No active sentinel and in previous sentinel.conf we were the master --> MASTER
            info "Configuring the node as master"
            export REDIS_REPLICATION_MODE="master"
        else
            # Case 2: No active sentinel and in previous sentinel.conf we were not master --> REPLICA
            info "Configuring the node as replica"
            export REDIS_REPLICATION_MODE="replica"
            REDIS_MASTER_HOST=${master_in_persisted_conf}
            REDIS_MASTER_PORT_NUMBER=${master_port_in_persisted_conf}
        fi
    else
        # Fetches current master's host and port
        REDIS_SENTINEL_INFO=($(get_sentinel_master_info))
        info "Current master: REDIS_SENTINEL_INFO=(${REDIS_SENTINEL_INFO[0]},${REDIS_SENTINEL_INFO[1]})"
        REDIS_MASTER_HOST=${REDIS_SENTINEL_INFO[0]}
        REDIS_MASTER_PORT_NUMBER=${REDIS_SENTINEL_INFO[1]}

        if [[ "$REDIS_MASTER_HOST" == "$(get_full_hostname "$HOSTNAME")" ]]; then
            # Case 3: Active sentinel and master it is this node --> MASTER
            info "Configuring the node as master"
            export REDIS_REPLICATION_MODE="master"
        else
            # Case 4: Active sentinel and master is not this node --> REPLICA
            info "Configuring the node as replica"
            export REDIS_REPLICATION_MODE="replica"
        fi
    fi

    if [[ -n "$REDIS_EXTERNAL_MASTER_HOST" ]]; then
      REDIS_MASTER_HOST="$REDIS_EXTERNAL_MASTER_HOST"
      REDIS_MASTER_PORT_NUMBER="${REDIS_EXTERNAL_MASTER_PORT}"
    fi

    if [[ -f /opt/bitnami/redis/mounted-etc/replica.conf ]];then
        cp /opt/bitnami/redis/mounted-etc/replica.conf /opt/bitnami/redis/etc/replica.conf
    fi

    if [[ -f /opt/bitnami/redis/mounted-etc/redis.conf ]];then
        cp /opt/bitnami/redis/mounted-etc/redis.conf /opt/bitnami/redis/etc/redis.conf
    fi

    echo "" >> /opt/bitnami/redis/etc/replica.conf
    echo "replica-announce-port $REDISPORT" >> /opt/bitnami/redis/etc/replica.conf
    echo "replica-announce-ip $(get_full_hostname "$HOSTNAME")" >> /opt/bitnami/redis/etc/replica.conf
    ARGS=("--port" "${REDIS_PORT}")

    if [[ "$REDIS_REPLICATION_MODE" = "slave" ]] || [[ "$REDIS_REPLICATION_MODE" = "replica" ]]; then
        ARGS+=("--replicaof" "${REDIS_MASTER_HOST}" "${REDIS_MASTER_PORT_NUMBER}")
    fi
    ARGS+=("--requirepass" "${REDIS_PASSWORD}")
    ARGS+=("--masterauth" "${REDIS_MASTER_PASSWORD}")
    ARGS+=("--include" "/opt/bitnami/redis/etc/replica.conf")
    ARGS+=("--include" "/opt/bitnami/redis/etc/redis.conf")
    exec redis-server "${ARGS[@]}"

  start-sentinel.sh: |
    #!/bin/bash

    . /opt/bitnami/scripts/libos.sh
    . /opt/bitnami/scripts/libvalidations.sh
    . /opt/bitnami/scripts/libfile.sh

    HEADLESS_SERVICE="my-release-redis-headless.default.svc.cluster.local"
    REDIS_SERVICE="my-release-redis.default.svc.cluster.local"

    get_port() {
        hostname="$1"
        type="$2"

        port_var=$(echo "${hostname^^}_SERVICE_PORT_$type" | sed "s/-/_/g")
        port=${!port_var}

        if [ -z "$port" ]; then
            case $type in
                "SENTINEL")
                    echo 26379
                    ;;
                "REDIS")
                    echo 6379
                    ;;
            esac
        else
            echo $port
        fi
    }

    get_full_hostname() {
        hostname="$1"
        full_hostname="${hostname}.${HEADLESS_SERVICE}"
        echo "${full_hostname}"
    }

    SERVPORT=$(get_port "$HOSTNAME" "SENTINEL")
    REDISPORT=$(get_port "$HOSTNAME" "REDIS")
    SENTINEL_SERVICE_PORT=$(get_port "my-release-redis" "SENTINEL")

    sentinel_conf_set() {
        local -r key="${1:?missing key}"
        local value="${2:-}"

        # Sanitize inputs
        value="${value//\\/\\\\}"
        value="${value//&/\\&}"
        value="${value//\?/\\?}"
        [[ "$value" = "" ]] && value="\"$value\""

        replace_in_file "/opt/bitnami/redis-sentinel/etc/sentinel.conf" "^#*\s*${key} .*" "${key} ${value}" false
    }
    sentinel_conf_add() {
        echo $'\n'"$@" >> "/opt/bitnami/redis-sentinel/etc/sentinel.conf"
    }
    host_id() {
        echo "$1" | openssl sha1 | awk '{print $2}'
    }
    get_sentinel_master_info() {
        if is_boolean_yes "$REDIS_SENTINEL_TLS_ENABLED"; then
            sentinel_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" timeout 99 redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT --tls --cert ${REDIS_SENTINEL_TLS_CERT_FILE} --key ${REDIS_SENTINEL_TLS_KEY_FILE} --cacert ${REDIS_SENTINEL_TLS_CA_FILE} sentinel get-master-addr-by-name mymaster"
        else
            sentinel_info_command="REDISCLI_AUTH="\$REDIS_PASSWORD" timeout 99 redis-cli -h $REDIS_SERVICE -p $SENTINEL_SERVICE_PORT sentinel get-master-addr-by-name mymaster"
        fi
        info "about to run the command: $sentinel_info_command"
        retry_while "eval $sentinel_info_command" 2 1
    }

    [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"

    master_in_persisted_conf="$(get_full_hostname "$HOSTNAME")"
    if ! get_sentinel_master_info && [[ "$master_in_persisted_conf" == "$(get_full_hostname "$HOSTNAME")" ]]; then
        # No master found, lets create a master node
        export REDIS_REPLICATION_MODE="master"

        REDIS_MASTER_HOST=$(get_full_hostname "$HOSTNAME")
        REDIS_MASTER_PORT_NUMBER="$REDISPORT"
    else
        export REDIS_REPLICATION_MODE="replica"

        # Fetches current master's host and port
        REDIS_SENTINEL_INFO=($(get_sentinel_master_info))
        info "printing REDIS_SENTINEL_INFO=(${REDIS_SENTINEL_INFO[0]},${REDIS_SENTINEL_INFO[1]})"
        REDIS_MASTER_HOST=${REDIS_SENTINEL_INFO[0]}
        REDIS_MASTER_PORT_NUMBER=${REDIS_SENTINEL_INFO[1]}
    fi

    if [[ -n "$REDIS_EXTERNAL_MASTER_HOST" ]]; then
      REDIS_MASTER_HOST="$REDIS_EXTERNAL_MASTER_HOST"
      REDIS_MASTER_PORT_NUMBER="${REDIS_EXTERNAL_MASTER_PORT}"
    fi

    cp /opt/bitnami/redis-sentinel/mounted-etc/sentinel.conf /opt/bitnami/redis-sentinel/etc/sentinel.conf
    printf "\nsentinel auth-pass %s %s" "mymaster" "$REDIS_PASSWORD" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    printf "\nrequirepass %s" "$REDIS_PASSWORD" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    printf "\nsentinel myid %s" "$(host_id "$HOSTNAME")" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf

    if [[ -z "$REDIS_MASTER_HOST" ]] || [[ -z "$REDIS_MASTER_PORT_NUMBER" ]]
    then
        # Prevent incorrect configuration to be written to sentinel.conf
        error "Redis master host is configured incorrectly (host: $REDIS_MASTER_HOST, port: $REDIS_MASTER_PORT_NUMBER)"
        exit 1
    fi

    sentinel_conf_set "sentinel monitor" "mymaster "$REDIS_MASTER_HOST" "$REDIS_MASTER_PORT_NUMBER" 2"

    add_known_sentinel() {
        hostname="$1"
        ip="$2"

        if [[ -n "$hostname" && -n "$ip" && "$hostname" != "$HOSTNAME" ]]; then
            sentinel_conf_add "sentinel known-sentinel mymaster $(get_full_hostname "$hostname") $(get_port "$hostname" "SENTINEL") $(host_id "$hostname")"
        fi
    }
    add_known_replica() {
        hostname="$1"
        ip="$2"

        if [[ -n "$ip" && "$(get_full_hostname "$hostname")" != "$REDIS_MASTER_HOST" ]]; then
            sentinel_conf_add "sentinel known-replica mymaster $(get_full_hostname "$hostname") $(get_port "$hostname" "REDIS")"
        fi
    }

    # Add available hosts on the network as known replicas & sentinels
    for node in $(seq 0 $((3-1))); do
        hostname="my-release-redis-node-$node"
        ip="$(getent hosts "$hostname.$HEADLESS_SERVICE" | awk '{ print $1 }')"
        add_known_sentinel "$hostname" "$ip"
        add_known_replica "$hostname" "$ip"
    done

    echo "" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    echo "sentinel announce-hostnames yes" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    echo "sentinel resolve-hostnames yes" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    echo "sentinel announce-port $SERVPORT" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    echo "sentinel announce-ip $(get_full_hostname "$HOSTNAME")" >> /opt/bitnami/redis-sentinel/etc/sentinel.conf
    exec redis-server /opt/bitnami/redis-sentinel/etc/sentinel.conf --sentinel
  prestop-sentinel.sh: |
    #!/bin/bash

    . /opt/bitnami/scripts/libvalidations.sh
    . /opt/bitnami/scripts/libos.sh

    HEADLESS_SERVICE="my-release-redis-headless.default.svc.cluster.local"

    get_full_hostname() {
        hostname="$1"
        full_hostname="${hostname}.${HEADLESS_SERVICE}"
        echo "${full_hostname}"
    }

    run_sentinel_command() {
        if is_boolean_yes "$REDIS_SENTINEL_TLS_ENABLED"; then
            redis-cli -h "$REDIS_SERVICE" -p "$REDIS_SENTINEL_PORT" --tls --cert "$REDIS_SENTINEL_TLS_CERT_FILE" --key "$REDIS_SENTINEL_TLS_KEY_FILE" --cacert "$REDIS_SENTINEL_TLS_CA_FILE" sentinel "$@"
        else
            redis-cli -h "$REDIS_SERVICE" -p "$REDIS_SENTINEL_PORT" sentinel "$@"
        fi
    }
    sentinel_failover_finished() {
      REDIS_SENTINEL_INFO=($(run_sentinel_command get-master-addr-by-name "mymaster"))
      REDIS_MASTER_HOST="${REDIS_SENTINEL_INFO[0]}"
      [[ "$REDIS_MASTER_HOST" != "$(get_full_hostname $HOSTNAME)" ]]
    }

    REDIS_SERVICE="my-release-redis.default.svc.cluster.local"

    # redis-cli automatically consumes credentials from the REDISCLI_AUTH variable
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    [[ -f "$REDIS_PASSWORD_FILE" ]] && export REDISCLI_AUTH="$(< "${REDIS_PASSWORD_FILE}")"

    if ! sentinel_failover_finished; then
        echo "I am the master pod and you are stopping me. Starting sentinel failover"
        if retry_while "sentinel_failover_finished" "20" 1; then
            echo "Master has been successfuly failed over to a different pod."
            exit 0
        else
            echo "Master failover failed"
            exit 1
        fi
    else
        exit 0
    fi
  prestop-redis.sh: |
    #!/bin/bash

    . /opt/bitnami/scripts/libvalidations.sh
    . /opt/bitnami/scripts/libos.sh

    run_redis_command() {
        if is_boolean_yes "$REDIS_TLS_ENABLED"; then
            redis-cli -h 127.0.0.1 -p "$REDIS_TLS_PORT" --tls --cert "$REDIS_TLS_CERT_FILE" --key "$REDIS_TLS_KEY_FILE" --cacert "$REDIS_TLS_CA_FILE" "$@"
        else
            redis-cli -h 127.0.0.1 -p "$REDIS_PORT" "$@"
        fi
    }
    is_master() {
        REDIS_ROLE=$(run_redis_command role | head -1)
        [[ "$REDIS_ROLE" == "master" ]]
    }

    HEADLESS_SERVICE="my-release-redis-headless.default.svc.cluster.local"

    get_full_hostname() {
        hostname="$1"
        full_hostname="${hostname}.${HEADLESS_SERVICE}"
        echo "${full_hostname}"
    }

    run_sentinel_command() {
        if is_boolean_yes "$REDIS_SENTINEL_TLS_ENABLED"; then
            redis-cli -h "$REDIS_SERVICE" -p "$REDIS_SENTINEL_PORT" --tls --cert "$REDIS_SENTINEL_TLS_CERT_FILE" --key "$REDIS_SENTINEL_TLS_KEY_FILE" --cacert "$REDIS_SENTINEL_TLS_CA_FILE" sentinel "$@"
        else
            redis-cli -h "$REDIS_SERVICE" -p "$REDIS_SENTINEL_PORT" sentinel "$@"
        fi
    }
    sentinel_failover_finished() {
        REDIS_SENTINEL_INFO=($(run_sentinel_command get-master-addr-by-name "mymaster"))
        REDIS_MASTER_HOST="${REDIS_SENTINEL_INFO[0]}"
        [[ "$REDIS_MASTER_HOST" != "$(get_full_hostname $HOSTNAME)" ]]
    }

    REDIS_SERVICE="my-release-redis.default.svc.cluster.local"

    # redis-cli automatically consumes credentials from the REDISCLI_AUTH variable
    [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
    [[ -f "$REDIS_PASSWORD_FILE" ]] && export REDISCLI_AUTH="$(< "${REDIS_PASSWORD_FILE}")"


    if is_master && ! sentinel_failover_finished; then
        echo "I am the master pod and you are stopping me. Pausing client connections."
        # Pausing client write connections to avoid data loss
        run_redis_command CLIENT PAUSE "22000" WRITE

        echo "Issuing failover"
        # if I am the master, issue a command to failover once
        run_sentinel_command failover "mymaster"
        echo "Waiting for sentinel to complete failover for up to 20s"
        retry_while "sentinel_failover_finished" "20" 1
    else
        exit 0
    fi
---
# Source: passbolt/templates/configmap-app-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-passbolt-cm-app-php
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: app-php
    app.kubernetes.io/type: cm
data:
  app.php: |
    <?php
    use Cake\Cache\Engine\FileEngine;
    use Cake\Database\Connection;
    use Cake\Database\Driver\Mysql;
    use Cake\Error\ExceptionRenderer;
    use Cake\Log\Engine\FileLog;

    return [
        /**
         * Debug Level:
         *
         * Production Mode:
         * false: No error messages, errors, or warnings shown.
         *
         * Development Mode:
         * true: Errors and warnings shown.
         */
        'debug' => filter_var(env('DEBUG', false), FILTER_VALIDATE_BOOLEAN),
        'debugKit' => false,

        /**
         * Configure basic information about the application.
         *
         * - namespace - The namespace to find app classes under.
         * - defaultLocale - The default locale for translation, formatting currencies and numbers, date and time.
         * - encoding - The encoding used for HTML + database connections.
         * - base - The base directory the app resides in. If false this
         *   will be auto detected.
         * - dir - Name of app directory.
         * - webroot - The webroot directory.
         * - wwwRoot - The file path to webroot.
         * - baseUrl - To configure CakePHP to *not* use mod_rewrite and to
         *   use CakePHP pretty URLs, remove these .htaccess
         *   files:
         *      /.htaccess
         *      /webroot/.htaccess
         *   And uncomment the baseUrl key below.
         * - fullBaseUrl - A base URL to use for absolute links.
         * - imageBaseUrl - Web path to the public images directory under webroot.
         * - cssBaseUrl - Web path to the public css directory under webroot.
         * - jsBaseUrl - Web path to the public js directory under webroot.
         * - paths - Configure paths for non class based resources. Supports the
         *   `plugins`, `templates`, `locales` subkeys, which allow the definition of
         *   paths for plugins, view templates and locale files respectively.
         */
        'App' => [
            'namespace' => 'App',
            'encoding' => env('APP_ENCODING', 'UTF-8'),
            'defaultLocale' => 'en_UK',
            'base' => env('APP_BASE', false),
            'dir' => 'src',
            'webroot' => 'webroot',
            'wwwRoot' => WWW_ROOT,
            // 'baseUrl' => env('APP_BASE_URL'),
            'fullBaseUrl' => env('APP_FULL_BASE_URL', false),
            'imageBaseUrl' => 'img/',
            'cssBaseUrl' => 'css/',
            'jsBaseUrl' => 'js/',
            //
            // Customization of paths is not supported in passbolt v3
            // Default is overridden directly in bootstrap.php
            //
            //'paths' => [
            //    'plugins' => [ROOT . DS . 'plugins' . DS],
            //    'templates' => [ROOT . DS . 'templates' . DS],
            //    'locales' => [RESOURCES . 'locales' . DS],
            //],
        ],

        /**
         * Security and encryption configuration
         *
         * - salt - A random string used in security hashing methods.
         *   The salt value is also used as the encryption key.
         *   You should treat it as extremely sensitive data.
         */
        'Security' => [
            'salt' => env('SECURITY_SALT', '__SALT__'),
        ],

        /**
         * Apply timestamps with the last modified time to static assets (js, css, images).
         * Will append a querystring parameter containing the time the file was modified.
         * This is useful for busting browser caches.
         *
         * Set to true to apply timestamps when debug is true. Set to 'force' to always
         * enable timestamping regardless of debug value.
         */
        'Asset' => [
            // 'timestamp' => true,
            // 'cacheTime' => '+1 year'
        ],

        /**
         * Configure the cache adapters.
         */
        'Cache' => [
            'default' => [
                'className' => 'Redis',
                'prefix' => env('CACHE_PREFIX_ORG', 'passbolt'),
                'server' => env('CACHE_CAKE_DEFAULT_SERVER', '127.0.0.1'),
                'database' => (int)env('CACHE_DEFAULT_DATABASE', 1),
                'password' => env('CACHE_CAKE_DEFAULT_PASSWORD', ''),
                'port' => env('CACHE_CAKE_DEFAULT_PORT', 6379),
            ],

            /**
             * Configure the cache used for general framework caching.
             * Translation cache files are stored with this configuration.
             * Duration will be set to '+2 minutes' in bootstrap.php when debug = true
             * If you set 'className' => 'Null' core cache will be disabled.
             */
            '_cake_core_' => [
                'className' => 'Redis',
                'duration' => '+1 week',
                'server' => env('CACHE_CAKE_DEFAULT_SERVER', '127.0.0.1'),
                'database' => (int)env('CACHE_CAKE_CORE_DATABASE', 2),
                'password' => env('CACHE_CAKE_DEFAULT_PASSWORD', ''),
                'port' => env('CACHE_CAKE_DEFAULT_PORT', 6379),
            ],

            /**
             * Configure the cache for model and datasource caches. This cache
             * configuration is used to store schema descriptions, and table listings
             * in connections.
             * Duration will be set to '+2 minutes' in bootstrap.php when debug = true
             */
            '_cake_model_' => [
                'className' => 'Redis',
                'duration' => '+1 week',
                'server' => env('CACHE_CAKE_DEFAULT_SERVER', '127.0.0.1'),
                'database' => (int)env('CACHE_CAKE_MODEL_DATABASE', 3),
                'password' => env('CACHE_CAKE_DEFAULT_PASSWORD', ''),
                'port' => env('CACHE_CAKE_DEFAULT_PORT', 6379),
            ],
        ],

        /**
         * Configure the Error and Exception handlers used by your application.
         *
         * By default errors are displayed using Debugger, when debug is true and logged
         * by Cake\Log\Log when debug is false.
         *
         * In CLI environments exceptions will be printed to stderr with a backtrace.
         * In web environments an HTML page will be displayed for the exception.
         * With debug true, framework errors like Missing Controller will be displayed.
         * When debug is false, framework errors will be coerced into generic HTTP errors.
         *
         * Options:
         *
         * - `errorLevel` - int - The level of errors you are interested in capturing.
         * - `trace` - boolean - Whether or not backtraces should be included in
         *   logged errors/exceptions.
         * - `log` - boolean - Whether or not you want exceptions logged.
         * - `exceptionRenderer` - string - The class responsible for rendering
         *   uncaught exceptions. If you choose a custom class you should place
         *   the file for that class in src/Error. This class needs to implement a
         *   render method.
         * - `skipLog` - array - List of exceptions to skip for logging. Exceptions that
         *   extend one of the listed exceptions will also be skipped for logging.
         *   E.g.:
         *   `'skipLog' => ['Cake\Network\Exception\NotFoundException', 'Cake\Network\Exception\UnauthorizedException']`
         * - `extraFatalErrorMemory` - int - The number of megabytes to increase
         *   the memory limit by when a fatal error is encountered. This allows
         *   breathing room to complete logging or error handling.
         */
        'Error' => [
            'errorLevel' => E_ALL,
            'exceptionRenderer' => ExceptionRenderer::class,
            'skipLog' => [],
            'log' => true,
            'trace' => true,
            'ignoredDeprecationPaths' => [],
        ],

        /**
         * Debugger configuration
         *
         * Define development error values for Cake\Error\Debugger
         *
         * - `editor` Set the editor URL format you want to use.
         *   By default atom, emacs, macvim, phpstorm, sublime, textmate, and vscode are
         *   available. You can add additional editor link formats using
         *   `Debugger::addEditor()` during your application bootstrap.
         * - `outputMask` A mapping of `key` to `replacement` values that
         *   `Debugger` should replace in dumped data and logs generated by `Debugger`.
         */
        'Debugger' => [
            'editor' => 'phpstorm',
        ],

        /**
         * Email configuration.
         *
         * By defining transports separately from delivery profiles you can easily
         * re-use transport configuration across multiple profiles.
         *
         * You can specify multiple configurations for production, development and
         * testing.
         *
         * Each transport needs a `className`. Valid options are as follows:
         *
         *  Mail   - Send using PHP mail function
         *  Smtp   - Send using SMTP
         *  Debug  - Do not send the email, just return the result
         *
         * You can add custom transports (or override existing transports) by adding the
         * appropriate file to src/Mailer/Transport. Transports should be named
         * 'YourTransport.php', where 'Your' is the name of the transport.
         */
        'EmailTransport' => [
            'default' => [
                'className' => env('EMAIL_TRANSPORT_DEFAULT_CLASS_NAME', 'Smtp'),
                /*
                 * The keys host, port, timeout, username, password, client and tls
                 * are used in SMTP transports
                 */
                'host' => env('EMAIL_TRANSPORT_DEFAULT_HOST', 'localhost'),
                'port' => env('EMAIL_TRANSPORT_DEFAULT_PORT', 25),
                'timeout' => env('EMAIL_TRANSPORT_DEFAULT_TIMEOUT', 30),
                /*
                 * It is recommended to set these options through your environment or passbolt.php
                 */
                'username' => env('EMAIL_TRANSPORT_DEFAULT_USERNAME', null),
                'password' => env('EMAIL_TRANSPORT_DEFAULT_PASSWORD', null),
                'client' => env('EMAIL_TRANSPORT_DEFAULT_CLIENT', null),
                'tls' => env('EMAIL_TRANSPORT_DEFAULT_TLS', null),
                'url' => env('EMAIL_TRANSPORT_DEFAULT_URL', null),

            ],
            'Debug' => [
                'className' => 'Debug'
            ],
        ],

        /**
         * Email delivery profiles
         *
         * Delivery profiles allow you to predefine various properties about email
         * messages from your application and give the settings a name. This saves
         * duplication across your application and makes maintenance and development
         * easier. Each profile accepts a number of keys. See `Cake\Mailer\Email`
         * for more information.
         */
        'Email' => [
            'default' => [
                'transport' => env('EMAIL_DEFAULT_TRANSPORT', 'default'),
                'from' => [
                    env('EMAIL_DEFAULT_FROM', 'you@localhost.test') => env('EMAIL_DEFAULT_FROM_NAME', 'Passbolt')
                ],
                //'charset' => 'utf-8',
                //'headerCharset' => 'utf-8',
            ],
        ],

        /**
         * Connection information used by the ORM to connect
         * to your application's datastores.
         * Do not use periods in database name - it may lead to error.
         * See https://github.com/cakephp/cakephp/issues/6471 for details.
         * Drivers include Mysql Postgres Sqlite Sqlserver
         * See vendor\cakephp\cakephp\src\Database\Driver for complete list
         */
        'Datasources' => [
            'default' => [
                'className' => Connection::class,
                'driver' => env('DATASOURCES_DEFAULT_DRIVER', Mysql::class),
                'persistent' => false,
                'timezone' => 'UTC',

                /*
                 * For MariaDB/MySQL the internal default changed from utf8 to utf8mb4, aka full utf-8 support
                 */
                'flags' => [],
                'cacheMetadata' => true,
                'log' => env('DATASOURCES_DEFAULT_LOG', false),

                /*
                 * Set identifier quoting to true if you are using reserved words or
                 * special characters in your table or column names. Enabling this
                 * setting will result in queries built using the Query Builder having
                 * identifiers quoted when creating SQL. It should be noted that this
                 * decreases performance because each query needs to be traversed and
                 * manipulated before being executed.
                 */
                'quoteIdentifiers' => env('DATASOURCES_QUOTE_IDENTIFIER', true),

                /*
                 * During development, if using MySQL < 5.6, uncommenting the
                 * following line could boost the speed at which schema metadata is
                 * fetched from the database. It can also be set directly with the
                 * mysql configuration directive 'innodb_stats_on_metadata = 0'
                 * which is the recommended value in production environments
                 */
                //'init' => ['SET GLOBAL innodb_stats_on_metadata = 0'],

                /*
                 * Non default config
                 * Passbolt support setting these from environment variables
                 * They can also be overridden in passbolt.php
                 */
                'host' => env('DATASOURCES_DEFAULT_HOST', 'localhost'),
                'port' => env('DATASOURCES_DEFAULT_PORT', 3306),
                'url' => env('DATASOURCES_DEFAULT_URL', null),
                'username' => env('DATASOURCES_DEFAULT_USERNAME', ''),
                'password' => env('DATASOURCES_DEFAULT_PASSWORD', ''),
                'database' => env('DATASOURCES_DEFAULT_DATABASE', ''),
                'ssl_key' => env('DATASOURCES_DEFAULT_SSL_KEY', ''),
                'ssl_cert' => env('DATASOURCES_DEFAULT_SSL_CERT', ''),
                'ssl_ca' => env('DATASOURCES_DEFAULT_SSL_CA', ''),
                'encoding' => env('DATASOURCES_DEFAULT_ENCODING','utf8mb4'),

            ],

            /**
             * The test connection is used during the test suite.
             */
            'test' => [
                'className' => Connection::class,
                'driver' => env('DATASOURCES_TEST_DRIVER', Mysql::class),
                'persistent' => false,
                'timezone' => 'UTC',
                'encoding' => env('DATASOURCES_TEST_ENCODING','utf8mb4'),
                'flags' => [],
                'cacheMetadata' => true,
                'quoteIdentifiers' => env('DATASOURCES_QUOTE_IDENTIFIER', true),
                'log' => env('DATASOURCES_TEST_LOG', false),
                //'init' => ['SET GLOBAL innodb_stats_on_metadata = 0'],

                /*
                 * Non default config
                 * Passbolt support setting these from environment variables
                 * They can also be overridden in passbolt.php
                 */
                'host' => env('DATASOURCES_TEST_HOST', 'localhost'),
                'port' => env('DATASOURCES_TEST_PORT', 3306),
                'username' => env('DATASOURCES_TEST_USERNAME', 'my_app'),
                'password' => env('DATASOURCES_TEST_PASSWORD', 'secret'),
                'database' => env('DATASOURCES_TEST_DATABASE', 'my_app'),
                'ssl_key' => env('DATASOURCES_TEST_SSL_KEY', ''),
                'ssl_cert' => env('DATASOURCES_TEST_SSL_CERT', ''),
                'ssl_ca' => env('DATASOURCES_TEST_SSL_CA', ''),
                'url' => env('DATASOURCES_TEST_URL', null),
            ],
        ],

        /**
         * Configures logging options
         */
        'Log' => [
            'debug' => [
                'className' => FileLog::class,
                'path' => LOGS,
                'file' => 'debug',
                'levels' => ['notice', 'info', 'debug'],
                'url' => env('LOG_DEBUG_URL', null),
            ],
            'error' => [
                'className' => FileLog::class,
                'path' => LOGS,
                'file' => 'error',
                'levels' => ['warning', 'error', 'critical', 'alert', 'emergency'],
                'url' => env('LOG_ERROR_URL', null),
            ],
            // To enable this dedicated query log, you need set your datasource's log flag to true
            // See DATASOURCES_DEFAULT_LOG
            'queries' => [
                'className' => FileLog::class,
                'path' => LOGS,
                'file' => 'queries',
                'url' => env('LOG_QUERIES_URL', null),
                'scopes' => ['queriesLog'],
            ],
        ],

        /**
         * Session configuration.
         *
         * Contains an array of settings to use for session configuration. The
         * `defaults` key is used to define a default preset to use for sessions, any
         * settings declared here will override the settings of the default config.
         *
         * ## Options
         *
         * - `cookie` - The name of the cookie to use. Defaults to 'CAKEPHP'.
         * - `cookiePath` - The url path for which session cookie is set. Maps to the
         *   `session.cookie_path` php.ini config. Defaults to base path of app.
         * - `timeout` - The time in minutes the session should be valid for.
         *    Pass 0 to disable checking timeout.
         *    Please note that php.ini's session.gc_maxlifetime must be equal to or greater
         *    than the largest Session['timeout'] in all served websites for it to have the
         *    desired effect.
         * - `defaults` - The default configuration set to use as a basis for your session.
         *    There are four built-in options: php, cake, cache, database.
         * - `handler` - Can be used to enable a custom session handler. Expects an
         *    array with at least the `engine` key, being the name of the Session engine
         *    class to use for managing the session. CakePHP bundles the `CacheSession`
         *    and `DatabaseSession` engines.
         * - `ini` - An associative array of additional ini values to set.
         *
         * The built-in `defaults` options are:
         *
         * - 'php' - Uses settings defined in your php.ini.
         * - 'cake' - Saves session files in CakePHP's /tmp directory.
         * - 'database' - Uses CakePHP's database sessions.
         * - 'cache' - Use the Cache class to save sessions.
         *
         * To define a custom session handler, save it at src/Network/Session/<name>.php.
         * Make sure the class implements PHP's `SessionHandlerInterface` and set
         * Session.handler to <name>
         *
         * To use database sessions, load the SQL file located at config/Schema/sessions.sql
         */
        'Session' => [
            'defaults' => env('SESSION_DEFAULTS', 'cache'),
            'duration' => '+1 day',
        ],
      ];
---
# Source: passbolt/templates/rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: my-release-passbolt-role-common
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: common
    app.kubernetes.io/type: role
rules:
- apiGroups: [""]
  resources: [ "configmaps", "secrets" ]
  resourceNames:
  - my-release-passbolt-sec-redis-proxy
  - my-release-passbolt-cm-env
  - my-release-passbolt-sec-env
  - my-release-passbolt-sec-gpg
  - my-release-passbolt-sec-jwt
  - my-release-passbolt-sec-tls
  - my-release-passbolt-sec-tls-ing
  - my-release-passbolt-sec-subscription
  verbs: ["get"]
---
# Source: passbolt/templates/rbac.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: my-release-passbolt-rolebind-common
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: common
    app.kubernetes.io/type: rolebind
subjects:
- kind: ServiceAccount
  name: my-release-passbolt-sa-common
roleRef:
  kind: Role
  name: my-release-passbolt-role-common
  apiGroup: rbac.authorization.k8s.io
---
# Source: passbolt/charts/mariadb/templates/primary/svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-release-mariadb-primary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: primary
  annotations:
spec:
  type: ClusterIP
  sessionAffinity: None
  ports:
    - name: mysql
      port: 3306
      protocol: TCP
      targetPort: mysql
      nodePort: null
  selector: 
    app.kubernetes.io/name: mariadb
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/component: primary
---
# Source: passbolt/charts/mariadb/templates/secondary/svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-release-mariadb-secondary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: secondary
  annotations:
spec:
  type: ClusterIP
  sessionAffinity: None
  ports:
    - name: mysql
      port: 3306
      protocol: TCP
      targetPort: mysql
      nodePort: null
  selector: 
    app.kubernetes.io/name: mariadb
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/component: secondary
---
# Source: passbolt/charts/redis/templates/headless-svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-release-redis-headless
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
  annotations:
    
spec:
  type: ClusterIP
  clusterIP: None
  publishNotReadyAddresses: true
  ports:
    - name: tcp-redis
      port: 6379
      targetPort: redis
    - name: tcp-sentinel
      port: 26379
      targetPort: redis-sentinel
  selector:
    app.kubernetes.io/name: redis
    app.kubernetes.io/instance: my-release
---
# Source: passbolt/charts/redis/templates/sentinel/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-release-redis
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: node
spec:
  type: ClusterIP
  sessionAffinity: None
  ports:
    - name: tcp-redis
      port: 6379
      targetPort: 6379
      nodePort: null
    - name: tcp-sentinel
      port: 26379
      targetPort: 26379
      nodePort: null
  selector:
    app.kubernetes.io/name: redis
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/component: node
---
# Source: passbolt/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  # We make exception here to reduce the interservice naming
  name: my-release-passbolt
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: common
    app.kubernetes.io/type: svc
spec:
  type: ClusterIP
  ports:
    - port: 443
      targetPort: 443
      protocol: TCP
      name: https
    - port: 80
      targetPort: 80
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
---
# Source: passbolt/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-release-passbolt-depl-srv
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: srv
    app.kubernetes.io/type: depl
spec:
  replicas: 2
  
  selector:
    matchLabels:
      app.kubernetes.io/name: passbolt
      app.kubernetes.io/instance: my-release
    matchExpressions:
      - {key: app.kubernetes.io/type, operator: NotIn, values: [job, cron]}
  template:
    metadata:
      labels:
        app.kubernetes.io/name: passbolt
        app.kubernetes.io/instance: my-release
      annotations:
        checksum/sec-env: 9ca26e8ec5bfdb41ba832e1473c834924d500d0f1b740ecdfc92869eb022da0e
        
        checksum/sec-gpg: 945d99cb169c8fe61dba5e8a3ee24044bce77efaab6f38c747aa3f0b5ad46dfc
        checksum/cm-env: ab1acd2db9c382d5ee20e02570b2a487abed98f1b7a9fde15e5886ccf6cd9469
        checksum/sec-jwt: d9c8ad8af32e2f707ecaca3fdce33208f49efc375bf5c6b269291d03e4b681b2
        checksum/sec-redis-proxy: 368bc1e46b79a2c85f6acfcec31bc83161daa9f8ecdaf931dcc8d11c5d1e7ead
    spec:
      
      serviceAccountName: my-release-passbolt-sa-common
      securityContext:
        {}
      initContainers:
        - name: my-release-passbolt-depl-srv-init
          
          image: mariadb
          imagePullPolicy: IfNotPresent
          command:
            - "/bin/bash"
          args:
            - "-c"
            - |
              set -e
              client="mariadb"
              cat <<-EOF > /tmp/defaultsfile.cnf
              [client]
              user=${DATASOURCES_DEFAULT_USERNAME}
              password=${DATASOURCES_DEFAULT_PASSWORD}
              host=${DATASOURCES_DEFAULT_HOST}
              connect-timeout=2
              EOF
              userhost="%"
              client="mariadb"
              while ! ${client} --defaults-file=/tmp/defaultsfile.cnf -e "SELECT 1" > /dev/null 2>&1; do
                echo "Waiting for database connection..."
                sleep 2
              done
          env:
            - name: DATASOURCES_DEFAULT_HOST
              value: "my-release-mariadb-primary"
            - name: DATASOURCES_DEFAULT_PORT
              value: "3306"
          envFrom:
            - configMapRef:
                name: my-release-passbolt-cm-env
            - secretRef:
                name: my-release-passbolt-sec-env
      containers:
        - name: passbolt
          command:
            - "/bin/bash"
          args:
            - "-c"
            - |
              set -e
              > /etc/supervisor/conf.d/cron.conf
              /docker-entrypoint.sh
          image: passbolt/passbolt:4.6.2-1-ce
          imagePullPolicy: IfNotPresent
          ports:
          - name: https
            containerPort: 443
            protocol: TCP
          - name: http
            containerPort: 80
            protocol: TCP
          livenessProbe:
            httpGet:
              httpHeaders:
              - name: Host
                value: passbolt.local
              path: /healthcheck/status.json
              port: https
              scheme: HTTPS
            initialDelaySeconds: 20
            periodSeconds: 10
          readinessProbe:
            httpGet:
              httpHeaders:
              - name: Host
                value: passbolt.local
              path: /healthcheck/status.json
              port: https
              scheme: HTTPS
            initialDelaySeconds: 5
            periodSeconds: 10
          env:
            - name: DATASOURCES_DEFAULT_HOST
              value: "my-release-mariadb-primary"
          envFrom:
            - configMapRef:
                name: my-release-passbolt-cm-env
            - secretRef:
                name: my-release-passbolt-sec-env
          volumeMounts:
            - mountPath: "/etc/passbolt/app.php"
              subPath: app.php
              name: cm-app-php
              readOnly: true
            - mountPath: /etc/ssl/certs/passbolt
              name: sec-tls
              readOnly: true
            - name: sec-gpg
              mountPath: /etc/passbolt/gpg
              readOnly: true
            - name: sec-jwt
              mountPath: "/etc/passbolt/jwt"
              readOnly: true
          resources:
            {}
        - name: redisproxy
          image: haproxy:latest
          imagePullPolicy: 
          volumeMounts:
            - mountPath: "/usr/local/etc/haproxy/haproxy.cfg"
              subPath: haproxy.cfg
              name: sec-redis-proxy
              readOnly: true
          resources:
            {}
      volumes:
        - name: sec-tls
          secret:
            secretName: my-release-passbolt-sec-tls-internal
        - name: sec-gpg
          secret:
            secretName: my-release-passbolt-sec-gpg
        - configMap:
            name: my-release-passbolt-cm-app-php
          name: cm-app-php
        - name: sec-jwt
          secret:
            secretName: my-release-passbolt-sec-jwt
        - name: sec-redis-proxy
          secret:
            secretName: my-release-passbolt-sec-redis-proxy
---
# Source: passbolt/charts/mariadb/templates/primary/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-release-mariadb-primary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: primary
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels: 
      app.kubernetes.io/name: mariadb
      app.kubernetes.io/instance: my-release
      app.kubernetes.io/component: primary
  serviceName: my-release-mariadb-primary
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configuration: 63607e93fcdecee07c6e040f0652c4d9e0ca4270ca501f27a3feca70b751fe95
      labels:
        app.kubernetes.io/name: mariadb
        helm.sh/chart: mariadb-11.5.7
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: primary
    spec:
      
      serviceAccountName: my-release-mariadb
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/name: mariadb
                    app.kubernetes.io/instance: my-release
                    app.kubernetes.io/component: primary
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      securityContext:
        fsGroup: 1001
      containers:
        - name: mariadb
          image: docker.io/bitnami/mariadb:10.6.12-debian-11-r16
          imagePullPolicy: "IfNotPresent"
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            runAsNonRoot: true
            runAsUser: 1001
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: MARIADB_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: my-release-mariadb
                  key: mariadb-root-password
            - name: MARIADB_USER
              value: "CHANGEME"
            - name: MARIADB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: my-release-mariadb
                  key: mariadb-password
            - name: MARIADB_DATABASE
              value: "passbolt"
            - name: MARIADB_REPLICATION_MODE
              value: "master"
            - name: MARIADB_REPLICATION_USER
              value: "replicator"
            - name: MARIADB_REPLICATION_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: my-release-mariadb
                  key: mariadb-replication-password
          ports:
            - name: mysql
              containerPort: 3306
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 120
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            exec:
              command:
                - /bin/bash
                - -ec
                - |
                  password_aux="${MARIADB_ROOT_PASSWORD:-}"
                  if [[ -f "${MARIADB_ROOT_PASSWORD_FILE:-}" ]]; then
                      password_aux=$(cat "$MARIADB_ROOT_PASSWORD_FILE")
                  fi
                  mysqladmin status -uroot -p"${password_aux}"
          readinessProbe:
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            exec:
              command:
                - /bin/bash
                - -ec
                - |
                  password_aux="${MARIADB_ROOT_PASSWORD:-}"
                  if [[ -f "${MARIADB_ROOT_PASSWORD_FILE:-}" ]]; then
                      password_aux=$(cat "$MARIADB_ROOT_PASSWORD_FILE")
                  fi
                  mysqladmin status -uroot -p"${password_aux}"
          resources: 
            limits: {}
            requests: {}
          volumeMounts:
            - name: data
              mountPath: /bitnami/mariadb
            - name: config
              mountPath: /opt/bitnami/mariadb/conf/my.cnf
              subPath: my.cnf
      volumes:
        - name: config
          configMap:
            name: my-release-mariadb-primary
  volumeClaimTemplates:
    - metadata:
        name: data
        labels: 
          app.kubernetes.io/name: mariadb
          app.kubernetes.io/instance: my-release
          app.kubernetes.io/component: primary
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: passbolt/charts/mariadb/templates/secondary/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-release-mariadb-secondary
  namespace: "default"
  labels:
    app.kubernetes.io/name: mariadb
    helm.sh/chart: mariadb-11.5.7
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: secondary
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels: 
      app.kubernetes.io/name: mariadb
      app.kubernetes.io/instance: my-release
      app.kubernetes.io/component: secondary
  serviceName: my-release-mariadb-secondary
  podManagementPolicy: 
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configuration: f1eecd018fa39abf841069aaadec004be15c664f247e0ae8835ddd546f1d6d5f
      labels:
        app.kubernetes.io/name: mariadb
        helm.sh/chart: mariadb-11.5.7
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: secondary
    spec:
      
      serviceAccountName: my-release-mariadb
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/name: mariadb
                    app.kubernetes.io/instance: my-release
                    app.kubernetes.io/component: secondary
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      securityContext:
        fsGroup: 1001
      containers:
        - name: mariadb
          image: docker.io/bitnami/mariadb:10.6.12-debian-11-r16
          imagePullPolicy: "IfNotPresent"
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            runAsNonRoot: true
            runAsUser: 1001
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: MARIADB_REPLICATION_MODE
              value: "slave"
            - name: MARIADB_MASTER_HOST
              value: my-release-mariadb-primary
            - name: MARIADB_MASTER_PORT_NUMBER
              value: "3306"
            - name: MARIADB_MASTER_ROOT_USER
              value: "root"
            - name: MARIADB_MASTER_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: my-release-mariadb
                  key: mariadb-root-password
            - name: MARIADB_REPLICATION_USER
              value: "replicator"
            - name: MARIADB_REPLICATION_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: my-release-mariadb
                  key: mariadb-replication-password
          ports:
            - name: mysql
              containerPort: 3306
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 120
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            exec:
              command:
                - /bin/bash
                - -ec
                - |
                  password_aux="${MARIADB_MASTER_ROOT_PASSWORD:-}"
                  if [[ -f "${MARIADB_MASTER_ROOT_PASSWORD_FILE:-}" ]]; then
                      password_aux=$(cat "$MARIADB_MASTER_ROOT_PASSWORD_FILE")
                  fi
                  mysqladmin status -uroot -p"${password_aux}"
          readinessProbe:
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
            exec:
              command:
                - /bin/bash
                - -ec
                - |
                  password_aux="${MARIADB_MASTER_ROOT_PASSWORD:-}"
                  if [[ -f "${MARIADB_MASTER_ROOT_PASSWORD_FILE:-}" ]]; then
                      password_aux=$(cat "$MARIADB_MASTER_ROOT_PASSWORD_FILE")
                  fi
                  mysqladmin status -uroot -p"${password_aux}"
          resources: 
            limits: {}
            requests: {}
          volumeMounts:
            - name: data
              mountPath: /bitnami/mariadb
            - name: config
              mountPath: /opt/bitnami/mariadb/conf/my.cnf
              subPath: my.cnf
      volumes:
        - name: config
          configMap:
            name: my-release-mariadb-secondary
  volumeClaimTemplates:
    - metadata:
        name: data
        labels: 
          app.kubernetes.io/name: mariadb
          app.kubernetes.io/instance: my-release
          app.kubernetes.io/component: secondary
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: passbolt/charts/redis/templates/sentinel/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-release-redis-node
  namespace: "default"
  labels:
    app.kubernetes.io/name: redis
    helm.sh/chart: redis-17.15.2
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: node
spec:
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: redis
      app.kubernetes.io/instance: my-release
      app.kubernetes.io/component: node
  serviceName: my-release-redis-headless
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        app.kubernetes.io/name: redis
        helm.sh/chart: redis-17.15.2
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: node
      annotations:
        checksum/configmap: db4433f92b88ac1d21d468d68567e2f1d650c621e29f807942a80452899bb240
        checksum/health: 1eace71641fb5bd753e90012419e82c10b1180d694f91d83743b727a5aacca73
        checksum/scripts: 1c7ecc66fc54b82cfc1079eb47101a9d3d7cd2c628ccaf941441c75e523d0863
        checksum/secret: e2dbc9e83e89a3079b8d2b25e0314273781fe72e30a39b119a99af9c5b27588a
    spec:
      
      securityContext:
        fsGroup: 1001
      automountServiceAccountToken: true
      serviceAccountName: my-release-redis
      affinity:
        podAffinity:
          
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/name: redis
                    app.kubernetes.io/instance: my-release
                    app.kubernetes.io/component: node
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity:
          
      terminationGracePeriodSeconds: 30
      containers:
        - name: redis
          image: docker.io/bitnami/redis:7.0.12-debian-11-r19
          imagePullPolicy: "IfNotPresent"
          lifecycle:
            preStop:
              exec:
                command:
                  - /bin/bash
                  - -c
                  - /opt/bitnami/scripts/start-scripts/prestop-redis.sh
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            runAsGroup: 0
            runAsNonRoot: true
            runAsUser: 1001
            seccompProfile:
              type: RuntimeDefault
          command:
            - /bin/bash
          args:
            - -c
            - /opt/bitnami/scripts/start-scripts/start-node.sh
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: REDIS_MASTER_PORT_NUMBER
              value: "6379"
            - name: ALLOW_EMPTY_PASSWORD
              value: "no"
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: my-release-redis
                  key: redis-password
            - name: REDIS_MASTER_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: my-release-redis
                  key: redis-password
            - name: REDIS_TLS_ENABLED
              value: "no"
            - name: REDIS_PORT
              value: "6379"
            - name: REDIS_SENTINEL_TLS_ENABLED
              value: "no"
            - name: REDIS_SENTINEL_PORT
              value: "26379"
            - name: REDIS_DATA_DIR
              value: /data
          ports:
            - name: redis
              containerPort: 6379
          startupProbe:
            failureThreshold: 22
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_liveness_local.sh 5
          livenessProbe:
            initialDelaySeconds: 20
            periodSeconds: 5
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_liveness_local.sh 5
          readinessProbe:
            initialDelaySeconds: 20
            periodSeconds: 5
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_readiness_local.sh 1
          resources:
            limits: {}
            requests: {}
          volumeMounts:
            - name: start-scripts
              mountPath: /opt/bitnami/scripts/start-scripts
            - name: health
              mountPath: /health
            - name: redis-data
              mountPath: /data
            - name: config
              mountPath: /opt/bitnami/redis/mounted-etc
            - name: redis-tmp-conf
              mountPath: /opt/bitnami/redis/etc
            - name: tmp
              mountPath: /tmp
        - name: sentinel
          image: docker.io/bitnami/redis-sentinel:7.0.12-debian-11-r18
          imagePullPolicy: "IfNotPresent"
          lifecycle:
            preStop:
              exec:
                command:
                  - /bin/bash
                  - -c
                  - /opt/bitnami/scripts/start-scripts/prestop-sentinel.sh
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            runAsGroup: 0
            runAsNonRoot: true
            runAsUser: 1001
            seccompProfile:
              type: RuntimeDefault
          command:
            - /bin/bash
          args:
            - -c
            - /opt/bitnami/scripts/start-scripts/start-sentinel.sh
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: my-release-redis
                  key: redis-password
            - name: REDIS_SENTINEL_TLS_ENABLED
              value: "no"
            - name: REDIS_SENTINEL_PORT
              value: "26379"
          ports:
            - name: redis-sentinel
              containerPort: 26379
          startupProbe:
            failureThreshold: 22
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
            exec:
              command:
                - sh
                - -c
                - /health/ping_sentinel.sh 5
          livenessProbe:
            initialDelaySeconds: 20
            periodSeconds: 10
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 6
            exec:
              command:
                - sh
                - -c
                - /health/ping_sentinel.sh 5
          readinessProbe:
            initialDelaySeconds: 20
            periodSeconds: 5
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 6
            exec:
              command:
                - sh
                - -c
                - /health/ping_sentinel.sh 1
          resources:
            limits: {}
            requests: {}
          volumeMounts:
            - name: start-scripts
              mountPath: /opt/bitnami/scripts/start-scripts
            - name: health
              mountPath: /health
            - name: sentinel-data
              mountPath: /opt/bitnami/redis-sentinel/etc
            - name: redis-data
              mountPath: /data
            - name: config
              mountPath: /opt/bitnami/redis-sentinel/mounted-etc
      volumes:
        - name: start-scripts
          configMap:
            name: my-release-redis-scripts
            defaultMode: 0755
        - name: health
          configMap:
            name: my-release-redis-health
            defaultMode: 0755
        - name: config
          configMap:
            name: my-release-redis-configuration
        - name: sentinel-data
          emptyDir: {}
        - name: redis-tmp-conf
          emptyDir: {}
        - name: tmp
          emptyDir: {}
  volumeClaimTemplates:
    - metadata:
        name: redis-data
        labels:
          app.kubernetes.io/name: redis
          app.kubernetes.io/instance: my-release
          app.kubernetes.io/component: node
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "8Gi"
---
# Source: passbolt/templates/cronjob-proc-email.yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: my-release-passbolt-cron-proc-email
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/action: proc-email
    app.kubernetes.io/type: cron
spec:
  schedule: "* * * * *"
  concurrencyPolicy: Replace
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app.kubernetes.io/action: proc-email
            app.kubernetes.io/type: cron
        spec:
          
          serviceAccountName: my-release-passbolt-sa-common
          restartPolicy: OnFailure
          securityContext:
            runAsUser: 33
            fsGroup: 33
          containers:
            - name: proc-email
              image: passbolt/passbolt:4.6.2-1-ce
              imagePullPolicy: IfNotPresent
              command:
                - "/bin/bash"
              args:
                - "-c"
                - |
                  sleep 10
                  echo "Sending emails" \
                  && bin/cron \
                  && touch /tmp/pod/success
              env:
                - name: DATASOURCES_DEFAULT_HOST
                  value: "my-release-mariadb-primary"
              envFrom:
                - configMapRef:
                    name: my-release-passbolt-cm-env
                - secretRef:
                    name: my-release-passbolt-sec-env
              volumeMounts:
                - name: vol-success
                  mountPath: /tmp/pod
                - name: sec-gpg
                  mountPath: /etc/passbolt/gpg
                  readOnly: true
            - name: redisproxy
              image: haproxy:latest
              imagePullPolicy: 
              command:
                - "/bin/bash"
              args:
                - "-c"
                - |
                  haproxy -f /usr/local/etc/haproxy/haproxy.cfg &
                  REDIS_PROXY_PID=$?
                  while true; do if [ -f "/tmp/pod/success" ]; then kill $REDIS_PROXY_PID; sleep 5;  exit 0; fi; done
              volumeMounts:
                - name: vol-success
                  mountPath: /tmp/pod
                - mountPath: "/usr/local/etc/haproxy/haproxy.cfg"
                  subPath: haproxy.cfg
                  name: sec-redis-proxy
                  readOnly: true
              resources:
                null
          volumes:
            - name: vol-success
              emptyDir: {}
            - name: sec-gpg
              secret:
                secretName: my-release-passbolt-sec-gpg
            - name: sec-redis-proxy
              secret:
                secretName: my-release-passbolt-sec-redis-proxy
---
# Source: passbolt/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-release-passbolt-sa-create-gpg-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: create-gpg-keys
    app.kubernetes.io/type: sa
---
# Source: passbolt/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-release-passbolt-sa-create-jwt-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: create-jwt-keys
    app.kubernetes.io/type: sa
---
# Source: passbolt/templates/secret-env.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-release-passbolt-sec-env
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: env
    app.kubernetes.io/type: sec
type: Opaque
data:

  
    CACHE_CAKE_DEFAULT_PASSWORD: "Q0hBTkdFTUU="
    DATASOURCES_DEFAULT_DATABASE: "cGFzc2JvbHQ="
    DATASOURCES_DEFAULT_PASSWORD: "Q0hBTkdFTUU="
    DATASOURCES_DEFAULT_USERNAME: "Q0hBTkdFTUU="
    EMAIL_TRANSPORT_DEFAULT_PASSWORD: "Q0hBTkdFTUU="
    EMAIL_TRANSPORT_DEFAULT_USERNAME: "Q0hBTkdFTUU="
---
# Source: passbolt/templates/secret-gpg.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-release-passbolt-sec-gpg
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: gpg
    app.kubernetes.io/type: sec
type: Opaque
data:
    serverkey_private.asc: ""
    serverkey.asc: ""
---
# Source: passbolt/templates/secret-jwt.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-release-passbolt-sec-jwt
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: jwt
    app.kubernetes.io/type: sec
type: Opaque
data:
  jwt.key: ""
  jwt.pem: ""
---
# Source: passbolt/templates/secret-redis-proxy.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-release-passbolt-sec-redis-proxy
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: redis-proxy
    app.kubernetes.io/type: sec
  annotations:
    helm.sh/hook: pre-upgrade,pre-install
    helm.sh/hook-weight: "-6"
    helm.sh/hook-delete-policy: before-hook-creation
type: Opaque
stringData:
  haproxy.cfg: |
    global
      log stdout format raw local0
      maxconn 1024

      resolvers mydns
        parse-resolv-conf
        hold valid 10s

    defaults REDIS
      default-server init-addr libc,none
      log global
      mode tcp
      timeout connect 4s
      timeout server 330s
      timeout client 330s
      timeout check 2s
      option redispatch
      retries 300

    frontend ft_redis_master
      bind 127.0.0.1:6379
      use_backend bk_redis_master

    backend bk_redis_master
      mode tcp
      option tcp-check
      tcp-check connect
      tcp-check send AUTH\ CHANGEME\r\n
      tcp-check send PING\r\n
      tcp-check expect string +PONG
      tcp-check send info\ replication\r\n
      tcp-check expect string role:master
      tcp-check send QUIT\r\n
      tcp-check expect string +OK
      server R0 my-release-redis-node-0.my-release-redis-headless.default.svc.cluster.local:6379 resolvers mydns check inter 1s fall 1 rise 1
      server R1 my-release-redis-node-1.my-release-redis-headless.default.svc.cluster.local:6379 resolvers mydns check inter 1s fall 1 rise 1
      server R2 my-release-redis-node-2.my-release-redis-headless.default.svc.cluster.local:6379 resolvers mydns check inter 1s fall 1 rise 1
---
# Source: passbolt/templates/configmap-env.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-release-passbolt-cm-env
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: env
    app.kubernetes.io/type: cm
data:

  
    APP_FULL_BASE_URL: "https://passbolt.local"
    CACHE_CAKE_DEFAULT_SERVER: "127.0.0.1"
    DEBUG: "false"
    EMAIL_DEFAULT_FROM: "no-reply@passbolt.local"
    EMAIL_DEFAULT_FROM_NAME: "Passbolt"
    EMAIL_TRANSPORT_DEFAULT_HOST: "127.0.0.1"
    EMAIL_TRANSPORT_DEFAULT_PORT: "587"
    EMAIL_TRANSPORT_DEFAULT_TIMEOUT: "30"
    EMAIL_TRANSPORT_DEFAULT_TLS: "true"
    KUBECTL_DOWNLOAD_CMD: "curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\""
    PASSBOLT_JWT_SERVER_KEY: "/var/www/passbolt/config/jwt/jwt.key"
    PASSBOLT_JWT_SERVER_PEM: "/var/www/passbolt/config/jwt/jwt.pem"
    PASSBOLT_KEY_EMAIL: "passbolt@yourdomain.com"
    PASSBOLT_LEGAL_PRIVACYPOLICYURL: "https://www.passbolt.com/privacy"
    PASSBOLT_PLUGINS_JWT_AUTHENTICATION_ENABLED: "true"
    PASSBOLT_PLUGINS_LICENSE_LICENSE: "/etc/passbolt/subscription_key.txt"
    PASSBOLT_REGISTRATION_PUBLIC: "true"
    PASSBOLT_SELENIUM_ACTIVE: "false"
    PASSBOLT_SSL_FORCE: "true"
---
# Source: passbolt/templates/rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: my-release-passbolt-role-create-gpg-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: create-gpg-keys
    app.kubernetes.io/type: role
rules:
- apiGroups: [""]
  resources: [ "configmaps", "secrets" ]
  resourceNames:
  - my-release-passbolt-cm-env
  - my-release-passbolt-sec-gpg
  - my-release-passbolt-sec-env
  - my-release-passbolt-sec-redis-proxy
  verbs: ["get", "patch"]
---
# Source: passbolt/templates/rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: my-release-passbolt-role-create-jwt-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: create-jwt-keys
    app.kubernetes.io/type: role
rules:
- apiGroups: [""]
  resources: [ "configmaps", "secrets" ]
  resourceNames:
  - my-release-passbolt-cm-env
  - my-release-passbolt-sec-jwt
  - my-release-passbolt-sec-env
  - my-release-passbolt-sec-redis-proxy
  verbs: ["get", "patch"]
---
# Source: passbolt/templates/rbac.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: my-release-passbolt-rolebind-create-gpg-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: create-gpg-keys
    app.kubernetes.io/type: rolebind
subjects:
- kind: ServiceAccount
  name: my-release-passbolt-sa-create-gpg-keys
roleRef:
  kind: Role
  name: my-release-passbolt-role-create-gpg-keys
  apiGroup: rbac.authorization.k8s.io
---
# Source: passbolt/templates/rbac.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: my-release-passbolt-rolebind-create-jwt-keys
  annotations:
    helm.sh/hook: pre-install, pre-upgrade
    helm.sh/hook-weight: "-1"
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/action: create-jwt-keys
    app.kubernetes.io/type: rolebind
subjects:
- kind: ServiceAccount
  name: my-release-passbolt-sa-create-jwt-keys
roleRef:
  kind: Role
  name: my-release-passbolt-role-create-jwt-keys
  apiGroup: rbac.authorization.k8s.io
---
# Source: passbolt/templates/job-create-gpg.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: my-release-passbolt-job-create-gpg-keys
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/action: create-gpg-keys
    app.kubernetes.io/type: job
  annotations:
    helm.sh/hook: pre-install
    helm.sh/hook-weight: "0"
spec:
  template:
    metadata:
      labels:
        app.kubernetes.io/action: create-gpg-keys
        app.kubernetes.io/type: job
    spec:
      
      serviceAccountName: my-release-passbolt-sa-create-gpg-keys
      restartPolicy: OnFailure
      containers:
        - name: create-gpg-keys
          image: passbolt/passbolt:4.6.2-1-ce
          imagePullPolicy: IfNotPresent
          command:
            - "/bin/bash"
          args:
            - "-c"
            - |
              set -e
              key_email="${PASSBOLT_KEY_EMAIL:-passbolt@yourdomain.com}"
              key_name="${PASSBOLT_KEY_NAME:-Passbolt default user}"
              key_length="${PASSBOLT_KEY_LENGTH:-3072}"
              subkey_length="${PASSBOLT_SUBKEY_LENGTH:-4096}"
              expiration="${PASSBOLT_KEY_EXPIRATION:-0}"
              su -c "gpg --homedir $GNUPGHOME --batch --no-tty --gen-key <<EOF
                Key-Type: default
                Key-Length: $key_length
                Subkey-Type: default
                Subkey-Length: $subkey_length
                Name-Real: $key_name
                Name-Email: $key_email
                Expire-Date: $expiration
                %no-protection
                %commit
              EOF" -ls /bin/bash www-data || \
              gpg --homedir $GNUPGHOME --batch --no-tty --gen-key <<EOF
                Key-Type: default
                Key-Length: $key_length
                Subkey-Type: default
                Subkey-Length: $subkey_length
                Name-Real: $key_name
                Name-Email: $key_email
                Expire-Date: $expiration
                %no-protection
                %commit
              EOF

              PRIVATE_SERVERKEY="$(gpg --homedir $GNUPGHOME --armor --export-secret-keys $key_email | base64 -w0)"
              PUBLIC_SERVERKEY="$(gpg --homedir $GNUPGHOME --armor --export $key_email | base64 -w0)"

              cd /tmp
              cpuArch=${CPU_ARCH:-$(eval "case `uname -m` in 'x86_64') echo 'amd64';;'aarch64') echo 'arm64';;esac")}
              kubectlDownload=${KUBECTL_DOWNLOAD_CMD:-'curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/${cpuArch}/kubectl"'}
              eval $kubectlDownload
              chmod +x kubectl
              ./kubectl patch secret my-release-passbolt-sec-gpg --type='json' -p='[{"op": "replace", "path" : "/data/serverkey_private.asc", "value" : '"${PRIVATE_SERVERKEY}"'}]'
              ./kubectl patch secret my-release-passbolt-sec-gpg --type='json' -p='[{"op": "replace", "path" : "/data/serverkey.asc", "value" : '"${PUBLIC_SERVERKEY}"'}]'
              touch /tmp/pod/success
              echo "Success"
          env:
            - name: DATASOURCES_DEFAULT_HOST
              value: "my-release-mariadb-primary"
          envFrom:
            - configMapRef:
                name: my-release-passbolt-cm-env
            - secretRef:
                name: my-release-passbolt-sec-env
          volumeMounts:
            - name: vol-success
              mountPath: /tmp/pod
      volumes:
        - name: vol-success
          emptyDir: {}
---
# Source: passbolt/templates/job-create-jwt.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: my-release-passbolt-job-create-jwt-keys
  labels:
    helm.sh/chart: passbolt-1.1.1
    app.kubernetes.io/version: "4.7.0-1-ce"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/action: create-jwt-keys
    app.kubernetes.io/type: job
  annotations:
    helm.sh/hook: pre-install
    helm.sh/hook-weight: "0"
spec:
  template:
    metadata:
      labels:
        app.kubernetes.io/action: create-jwt-keys
        app.kubernetes.io/type: job
    spec:
      
      serviceAccountName: my-release-passbolt-sa-create-jwt-keys
      restartPolicy: OnFailure
      containers:
        - name: create-jwt-keys
          image: passbolt/passbolt:4.6.2-1-ce
          imagePullPolicy: IfNotPresent
          command:
            - "/bin/bash"
          args:
            - "-c"
            - |
              set -e

              /usr/share/php/passbolt/bin/cake passbolt create_jwt_keys
              PRIVATE_JWT_KEY="$(cat /etc/passbolt/jwt/jwt.key | base64 -w0 )"
              PUBLIC_JWT_KEY="$(cat /etc/passbolt/jwt/jwt.pem | base64 -w0 )"

              cd /tmp
              cpuArch=${CPU_ARCH:-$(eval "case `uname -m` in 'x86_64') echo 'amd64';;'aarch64') echo 'arm64';;esac")}
              kubectlDownload=${KUBECTL_DOWNLOAD_CMD:-'curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/${cpuArch}/kubectl"'}
              eval $kubectlDownload
              chmod +x kubectl
              ./kubectl patch secret my-release-passbolt-sec-jwt --type='json' -p='[{"op": "replace", "path" : "/data/jwt.key", "value" : '"${PRIVATE_JWT_KEY}"'}]'
              ./kubectl patch secret my-release-passbolt-sec-jwt --type='json' -p='[{"op": "replace", "path" : "/data/jwt.pem", "value" : '"${PUBLIC_JWT_KEY}"'}]'
              touch /tmp/pod/success
              echo "Success"
          env:
            - name: DATASOURCES_DEFAULT_HOST
              value: "my-release-mariadb-primary"
          envFrom:
            - configMapRef:
                name: my-release-passbolt-cm-env
            - secretRef:
                name: my-release-passbolt-sec-env
          volumeMounts:
            - name: vol-success
              mountPath: /tmp/pod
      volumes:
        - name: vol-success
          emptyDir: {}
