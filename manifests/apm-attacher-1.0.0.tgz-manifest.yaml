---
# Source: apm-attacher/templates/webhook.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-release
  namespace: default
  labels:    
    app.kubernetes.io/name: my-release
    app.kubernetes.io/component: webhook
    app.kubernetes.io/instance: my-release
data:
  cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURQRENDQWlTZ0F3SUJBZ0lRVUN0MjI2cXBwYXFtQmNHMDJCOWN1akFOQmdrcWhraUc5dzBCQVFzRkFEQVkKTVJZd0ZBWURWUVFERXcxdGVTMXlaV3hsWVhObExXTmhNQjRYRFRJME1EWXhOakF3TXpnME5Gb1hEVE0wTURZeApOREF3TXpnME5Gb3dGVEVUTUJFR0ExVUVBeE1LYlhrdGNtVnNaV0Z6WlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCCkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU5ZMDJTU3I0eEM3Yy9LanVKL1hUTGVnUTd2Rng3emlqcU9kOG5UTCtnWm8KbzNlc0VIdHJSaFdOWk5oa0FhbUNyNDc0MEpwL2dobjVBQmtocmVtaitXZlVlSkZ1cm8vODE1bTRabjNqaVJ0UQpJREJmNTRwcE5oMGxqUU9TZmN5NDcwUjZpSGs5U1laZy9XRHo0eDIvQUs1QjZvb2NUOC92NVp0RXRvRWJFQTNiCkdMMHZYb1ZXU2h5K0lYbzcyREFZaE4rdVVkZzB2OGJTQUJUSmNMMEZEUEc4VVNPUzBUWlptajFEQjFoNEdrRUEKNWhrZW43bGMvRmJHOGVEVW1QNVEzY2RhdGg1UmRQdHh1d3k2dEplRHd1aEJvaldRcGMzWXcyNU5tcnE2c3JhZwo5YXhaa0JVczE1Y0ZHUkVQM3gydGJqcThLanY2QkcrZkl2KytuNW1tMXk4Q0F3RUFBYU9CaERDQmdUQU9CZ05WCkhROEJBZjhFQkFNQ0JhQXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0VHQ0NzR0FRVUZCd01DTUF3R0ExVWQKRXdFQi93UUNNQUF3SHdZRFZSMGpCQmd3Rm9BVWZvemlua1NSK0ZOcjJTc0lIU1lKWWtud0xMd3dJUVlEVlIwUgpCQm93R0lJV2JYa3RjbVZzWldGelpTNWtaV1poZFd4MExuTjJZekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBClhTZDBEQ2RmUGsyQmhjQjdsd1FqWU8zQVJBODBOWGtWTHZOWWRsYStjdVFqRmp5RDNTZHpIVk1lRWg1K2puZVoKakM0a0pUVDRQanJxUEF0QWlSTFU4OWtUVVVsUWJUazFPYWRReFVSRU5RRVJxUXRpV1JKRG5majJ6UzdzbVVpSgpta3REaW9OU29JVGtpd2oyYkNVWGw1ZVNoQzZ3d0ExbUtzT0NacWhYNWJzT3VrZFhyWWFwZGora0d4YVpFbnF3Cmt4dlczemMzbWgvZjF2bHFqU1pKb0xOSnJhRXFrZGI3bmhWMW1LZ1ZmbzRQdjUxOWM3YUs1Sno4cUp6Q2Juc1QKTzY1M0Y3TnFneGRRNFd5ZzJSOHhtY2pqSEh3Y3h6elF1V0ZyZW5Rcmw4bWRjSGdVaHB2WGhrUjdiZkovZ0ZjcQptNFJUZmV1c2tLcFdJRFY2aVprK25nPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMWpUWkpLdmpFTHR6OHFPNG45ZE10NkJEdThYSHZPS09vNTN5ZE12NkJtaWpkNndRCmUydEdGWTFrMkdRQnFZS3ZqdmpRbW4rQ0dma0FHU0d0NmFQNVo5UjRrVzZ1ai96WG1iaG1mZU9KRzFBZ01GL24KaW1rMkhTV05BNUo5ekxqdlJIcUllVDFKaG1EOVlQUGpIYjhBcmtIcWloeFB6Ky9sbTBTMmdSc1FEZHNZdlM5ZQpoVlpLSEw0aGVqdllNQmlFMzY1UjJEUy94dElBRk1sd3ZRVU04YnhSSTVMUk5sbWFQVU1IV0hnYVFRRG1HUjZmCnVWejhWc2J4NE5TWS9sRGR4MXEySGxGMCszRzdETHEwbDRQQzZFR2lOWkNsemRqRGJrMmF1cnF5dHFEMXJGbVEKRlN6WGx3VVpFUS9mSGExdU9yd3FPL29FYjU4aS83NmZtYWJYTHdJREFRQUJBb0lCQURFMnFTRHN3TmxxUitSYQpTeU9tSW9FWnVCWWZCWm5XNzNDVjdFdDdSYkZOUHlsU2hlTGxMWS9zRVZ4Sjlidk5RNnAwYmZEaEZMSUU3RW5aCjNBd08yVkZLbG56TFVoM1F1SFFmMHFSZnIzTndBRVU4ODRSd1ViZDJsaVJZOXNBZlNSR1JtV05KZW1mK1JwaU0KMEFSWWlyNStkSFZRdGVHUE8xQm1CQXc3ZkgvQ0NBTDJuaE9aYVVsTzRPZTFKSkZFZGtUSVhDSXNPYnBvd3plRApkYWZpQ2ZuSHVCamhaUXdKRmZkOEZJN3hsUWZvUWpzeFowQzBNTUtpbm53TW0vTVNyUzI2aUR4N1lMUGdHdDNuCmJlSis4RTFtL00zcnlJbyt3MGVHZ1BYOGhtVXVGeHhteE83SFplM0M1a045bU9jRkhWZURNTUk0dzJqd2tDc2kKKzNlY2cva0NnWUVBNEJlREE4NFZWRTRCY1pDVkxmVjVVRU5KcmMwYW5WbzIvRWVwNDlNWVo2ei9PdzFrZ0djdQprYk9QcHVQT1RoMm1tRGlOdTJyNkE0ZWVDWlVaL3o0VXhOYk9DY3A1Q0tsU3k1WUkza1Jnd3pJdTNHMVN6U3hnCkJxL0lhaEhSTWR2djlWbzkyTStteWcvK2xseGhNUnkramMyZUxVMUU1Y05iNjVBaTlIa3JQZXNDZ1lFQTlMVC8KbUlPL0NFc253ek0zMTBLdUxOcVRjdXBWUUplVUVUN0ZQK2ZXblFJeW42UGVJcHQ2eGVGUHZuV3VWbCtld0l4bApIdllqYldVeVRyakxwMWRKazJZSjVOZVZlNTVMR0JreUFKZllWRXBwVHo3U0toSHp2UDZOd0RlRVlyYng0RXdvCjJsSU1iTkkrMW9UeFk1dnd5cS9ic1QvUXdTSHpocXV3MTc5SVJzMENnWUJqcC9FYXl4WlBOSldOeEllak5heHEKbGxINDJlTEJJWEtjaE40M3RCUUJYenp1TFFtSjFOa3Y4Sk9zMjFoUEF2Nm9hVllXaC8rQmZGazYxN1VFL3IzTAp2OTlIR1dUMEJpRU02cjhzNFduS3hORjBNNllFR256bDNGeWJWeXNhS2o0dmRaOVZnUnNpZHpSMzk4TTlUUlF0CkNja1RTbTZlWTEvSWhZUVdCcURGV3dLQmdRQy9tNG9YYmZHREdQWUZqbkZIQ0Z0Qm05U2d3b1FHazZuSTV4R2sKUEhCN2VHRVRSMGlFYUtIMWw3ck5NM0JUQ1lSUTJKM0ZaSTNROXRBeGU5bGJLcW5kMUtRaW4vdllVOVlSQklsMgpsVzg2Y1JtTWgzQWdxUFhsSXB6enlZVExsdHhGK054ME5wS3NFdVJKTE1lbWExQmNKTjh0SnY3YWV5OG9YLytVCnI1NTBjUUtCZ1FDNGxWYTF0ZnAxckI2VXBKTVFVdU8zaG5qY0NIRFYwUUNMMTl3ajZHM0dLY1RLYzFJbUxlaTgKOXh3OTNjUGU0VkJSNzc1U0w2TFdQcVhzOTFUNVpBTTRLWUYrOC9hRlVlUEhLUzArQ0ZtMmJkSlowQUxTNGtMbQo4Q3JDakNFOG5FazZWdEw0ZkZqZVBKWU5ueUs0OHNWNW8rdk9EcTlNYUMrRDVzbnJ1N3RoeFE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
# Source: apm-attacher/templates/webhook.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: webhook-config
  namespace: default
data:
  webhook.yaml: |
    agents:
      dotnet:
        artifact: /usr/agent/apm-dotnet-agent
        environment:
          CORECLR_ENABLE_PROFILING: "1"
          CORECLR_PROFILER: '{FA65FE15-F085-4681-9B20-95E04F6C03CC}'
          CORECLR_PROFILER_PATH: /usr/agent/apm-dotnet-agent/libelastic_apm_profiler.so
          ELASTIC_APM_PROFILER_HOME: /usr/agent/apm-dotnet-agent
          ELASTIC_APM_PROFILER_INTEGRATIONS: /usr/agent/apm-dotnet-agent/integrations.yml
        image: docker.elastic.co/observability/apm-agent-dotnet:latest
      java:
        artifact: /usr/agent/elastic-apm-agent.jar
        environment:
          JAVA_TOOL_OPTIONS: -javaagent:/elastic/apm/agent/elastic-apm-agent.jar
        image: docker.elastic.co/observability/apm-agent-java:latest
      nodejs:
        artifact: /opt/nodejs/node_modules/elastic-apm-node
        environment:
          NODE_OPTIONS: -r /elastic/apm/agent/elastic-apm-node/start
        image: docker.elastic.co/observability/apm-agent-nodejs:latest
---
# Source: apm-attacher/templates/webhook.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-release
  namespace: default
spec:
  publishNotReadyAddresses: true
  ports:
    - port: 443
      targetPort: https
  selector:    
    app.kubernetes.io/name: my-release
    app.kubernetes.io/component: webhook
    app.kubernetes.io/instance: my-release
---
# Source: apm-attacher/templates/webhook.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-release
  namespace: default
  labels:    
    app.kubernetes.io/name: my-release
    app.kubernetes.io/component: webhook
    app.kubernetes.io/instance: my-release
spec:
  replicas: 1
  selector:
    matchLabels:      
      app.kubernetes.io/name: my-release
      app.kubernetes.io/component: webhook
      app.kubernetes.io/instance: my-release
  template:
    metadata:
      annotations:
        generated-cert: 6e317cef5b5641c9bc5a8345bc2afb879b9c8708cb42f57082b123a237f7f2f2
      labels:        
        app.kubernetes.io/name: my-release
        app.kubernetes.io/component: webhook
        app.kubernetes.io/instance: my-release
    spec:
      containers:
        - name: my-release
          image: "docker.elastic.co/observability/apm-attacher:v1.0.0"
          imagePullPolicy: Always
          args:
            - -certFile=/opt/webhook/certs/cert.pem
            - -keyFile=/opt/webhook/certs/key.pem
            - -config=/opt/webhook/config/webhook.yaml
          volumeMounts:
            - name: my-release-certs
              mountPath: /opt/webhook/certs
              readOnly: true
            - name: config
              mountPath: /opt/webhook/config
              readOnly: true
          ports:
            - name: https
              containerPort: 8443
              protocol: TCP
      volumes:
        - name: my-release-certs
          secret:
            secretName: my-release
        - name: config
          configMap:
            name: webhook-config
---
# Source: apm-attacher/templates/webhook.yaml
# This file is based on modifications to Kubernetes Mutating Webhook by Expedia, Inc., which is licensed under Apache 2.0.
# https://github.com/ExpediaGroup/kubernetes-sidecar-injector
---
# Source: apm-attacher/templates/webhook.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: my-release
  labels:    
    app.kubernetes.io/name: my-release
    app.kubernetes.io/component: webhook
    app.kubernetes.io/instance: my-release
webhooks:
  - name: my-release.default.svc.cluster.local
    clientConfig:
      service:
        name: my-release
        namespace: default
        path: "/"
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURHekNDQWdPZ0F3SUJBZ0lRWEpZVHBNSUV0YmV6NFlVRnljN0dKakFOQmdrcWhraUc5dzBCQVFzRkFEQVkKTVJZd0ZBWURWUVFERXcxdGVTMXlaV3hsWVhObExXTmhNQjRYRFRJME1EWXhOakF3TXpnME5Gb1hEVE0wTURZeApOREF3TXpnME5Gb3dHREVXTUJRR0ExVUVBeE1OYlhrdGNtVnNaV0Z6WlMxallUQ0NBU0l3RFFZSktvWklodmNOCkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFNVTJJbXpjVUdtZVF4NFJxRFlrdWszQkFnWE5uMG1HK2MwcmxBd3YKZnk2L1hrdGMzcTk4WXBydjU3RmdndnljemFjUUVraXc0MWxWOGd2dlJFVWFyL1o2UlZrY0dibkNndGdVRUVhRAp1TG9kNzh6QVh4UWluWTN3SCtnVGFtRTFPanNBQTh0L1RyY284d2hUeVR5RnV3enh3TEU4L1Y0VDY5SjB0dUl4CkxpTUwrVDZRWW9jckozbXg1NTZUTW9RSVlrTHF5Q3RhMk4xQVlZV1RkNjQ3aG16ZGxnVlhhTDdweFFIbURMYk4KaklZUkhYRDAxSVAwcXNpYnF0VzNpUVBUdThGcmdpZGxRb3ZoWnAzQkg4UUNJekV6dDlQTCtQN2hZczdqWjZpdwp1ZHh4V1lsZzRCRExHL1czZUJNU1lwVnhGb0tQOW05elk5WDZ3TTJkR3NKMW1RMENBd0VBQWFOaE1GOHdEZ1lEClZSMFBBUUgvQkFRREFnS2tNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUZCUWNEQWpBUEJnTlYKSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRV0JCUitqT0tlUkpINFUydlpLd2dkSmdsaVNmQXN2REFOQmdrcQpoa2lHOXcwQkFRc0ZBQU9DQVFFQXNsN3k3cXRyTG84c0ZReE5aN1NqT0Rwd2tOUnNyTExvaG5pQnpTYnNLZE02Ck9VOXVjL1dNeXczdzQwZ3Y5ZXZSRGVBMjE5NDRxck5SaHBCZ1ptZDRVU240ZDNLc3VGSWJ0ZklkaXBXdU9lVmYKNEJPTXRkektWT283NnZMU0NkbWJyNG5BM0sxOUZpdU9Sd2NHS2NOU05TY3dncTArTmFsTm1vVU8yWEMza3RjQQpoaFZkQnMrbkZsekxjMHJkTElXRzVUSXhDVXJPekxicWluYWtCWk1wa1VQZU9ONEY0QkNMZ1NmNG50YUs1SHgxCmZlT0Q4dnZsbUFIOFU2VUp4c0JUdFkvMlRiSG5WZ2ZpazlkV1RBRVZpMGFDWDJMenI3cU03b1hoNzlzUHRZM3UKUDEwL0prWWRLZ1pLVEx6dzhkV1lRbkZsZGtLcjcreFZCanA5dC9jL0F3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    failurePolicy: Fail
    admissionReviewVersions: [ "v1", "v1beta1" ]
    sideEffects: None
    rules:
      - operations: ["CREATE"]
        apiGroups: [""]
        apiVersions: ["*"]
        resources: ["pods"]
    namespaceSelector:
      matchExpressions:
        - key: kubernetes.io/metadata.name
          operator: NotIn
          values:
            - kube-system
            - kube-public
            # The webhook has to be deployed to its own namespace, or else
            # attempts at scaling up pods will fail when trying to call
            # themself.
            - default
