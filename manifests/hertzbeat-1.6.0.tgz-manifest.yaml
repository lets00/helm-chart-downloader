---
# Source: hertzbeat/templates/collector/configmap.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: v1
kind: ConfigMap
metadata:
  name: "my-release-hertzbeat-collector"
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
data:
  IDENTITY: ""
  MANAGER_HOST: "my-release-hertzbeat-cluster"
  MANAGER_PORT: "1158"
  application.yml: |+
    server:
      port: 1159
    spring:
      application:
        name: ${HOSTNAME:@hertzbeat-collector@}${PID}
      profiles:
        active: cluster
      jackson:
        default-property-inclusion: ALWAYS
      # need to disable spring boot mongodb auto config, or default mongodb connection tried and failed...
      autoconfigure:
        exclude: org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration, org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration
    
    ---
    spring:
      config:
        activate:
          on-profile: cluster
    
    collector:
      dispatch:
        entrance:
          netty:
            enabled: true
            identity: ${IDENTITY:}
            mode: ${MODE:public}
            manager-host: ${MANAGER_HOST:127.0.0.1}
            manager-port: ${MANAGER_PORT:1158}
    
    common:
      queue:
        type: netty
---
# Source: hertzbeat/templates/database/configmap.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: v1
kind: ConfigMap
metadata:
  name: "my-release-hertzbeat-database"
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
data:
  TZ: "Asia/Shanghai"
  POSTGRES_PASSWORD: "123456"
  POSTGRES_USER: "root"
  schema.sql: |+
    CREATE EXTENSION IF NOT EXISTS dblink;

    DO $$
    BEGIN
    PERFORM dblink_exec('', 'CREATE DATABASE hertzbeat');
    EXCEPTION WHEN duplicate_database THEN RAISE NOTICE '%, skipping', SQLERRM USING ERRCODE = SQLSTATE;
    END
    $$;
---
# Source: hertzbeat/templates/manager/configmap.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: v1
kind: ConfigMap
metadata:
  name: "my-release-hertzbeat"
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
data:
  application.yml: |+
    server:
      port: 1157
    spring:
      application:
        name: ${HOSTNAME:@hertzbeat@}${PID}
      profiles:
        active: prod
      mvc:
        static-path-pattern: /**
      jackson:
        default-property-inclusion: ALWAYS
      web:
        resources:
          static-locations:
            - classpath:/dist/
            - classpath:../dist/
      # need to disable spring boot mongodb auto config, or default mongodb connection tried and failed..
      autoconfigure:
        exclude: org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration, org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration
      freemarker:
        enabled: false
    management:
      health:
        mail:
          enabled: off
      endpoints:
        web:
          exposure:
            include:
              - 'metrics'
              - 'health'
              - 'env'
        enabled-by-default: on
    
    sureness:
      container: jakarta_servlet
      auths:
        - digest
        - basic
        - jwt
      jwt:
        secret: CyaFv0bwq2Eik0jdrKUtsA6dx3sDJeFV143R LnfKefTjsIfJLBa2YkhEqEGtcHDTNe4CU6+9 8tVt4bisXQ13rbN0oxhUZR73M6EByXIO+SV5 dKhaX0csgOCTlCxq20yhmUea6H6JIpSE2Rwp
    
    ---
    spring:
      config:
        activate:
          on-profile: prod
    
      datasource:
        driver-class-name: org.postgresql.Driver
        username: root
        password: 123456
        url: jdbc:postgresql://my-release-hertzbeat-database:5432/hertzbeat
        hikari:
          max-lifetime: 120000
      jpa:
        show-sql: false
        database-platform: org.eclipse.persistence.platform.database.PostgreSQLPlatform
        database: postgresql
        properties:
          eclipselink:
            logging:
              level: SEVERE
      flyway:
        enabled: true
        clean-disabled: true
        baseline-on-migrate: true
        baseline-version: 1
        locations:
          - classpath:db/migration/{vendor}    
      mail:
        # Attention: this is mail server address.
        # 请注意此为邮件服务器地址：qq邮箱为 smtp.qq.com qq 企业邮箱为 smtp.exmail.qq.com
        host: smtp.qq.com
        username: tancloud@qq.com
        # Attention: this is not email account password, this requires an email authorization code
        # 请注意此非邮箱账户密码 此需填写邮箱授权码
        password: your-password
        #Attention: Tencent mail smtps 465,smtp 587
        #请注意腾讯邮箱465为smtps,587为smtp
        port: 587
        properties:
          mail:
            smtp:
              socketFactoryClass: javax.net.ssl.SSLSocketFactory
              ssl:
                enable: true
    
    common:
      queue:
        # memory or kafka
        type: memory
        # properties when queue type is kafka
        kafka:
          servers: 127.0.0.1:9092
          metrics-data-topic: async-metrics-data
          alerts-data-topic: async-alerts-data
    
    warehouse:
      store:
        # store history metrics data, enable only one below
        # 存储历史数据方式, 下方只能enabled启用一种方式
        jpa:
          enabled: false
        victoria-metrics:
          enabled: true
          url: http://my-release-hertzbeat-tsdb:8428
          username: root
          password: root
        td-engine:
          enabled: false
          driver-class-name: com.taosdata.jdbc.rs.RestfulDriver
          url: jdbc:TAOS-RS://my-release-hertzbeat-tsdb:6041/hertzbeat
          username: root
          password: taosdata
        greptime:
          enabled: false
          endpoint: localhost:4001
        iot-db:
          enabled: false
          host: my-release-hertzbeat-tsdb
          rpc-port: 6667
          username: root
          password: root
          # org.apache.hertzbeat.warehouse.config.IotDbVersion: V_0_13 || V_1_0
          version: V_1_0
          query-timeout-in-ms: -1
          # 数据存储时间：默认'7776000000'（90天,单位为毫秒,-1代表永不过期）
          # data expire time, unit:ms, default '7776000000'(90 days, -1:never expire)
          expire-time: '7776000000'
        influxdb:
          enabled: false
          server-url: http://127.0.0.1:8086
          username: root
          password: root
          expire-time: '30d'
          replication: 1
    
        # store real-time metrics data, enable only one below
        # 存储实时数据方式, 下方只能enabled启用一种方式
        memory:
          enabled: true
          init-size: 16
        redis:
          enabled: false
          host: 127.0.0.1
          port: 6379
          password: 123456
          db: 0
    
    alerter:
      # custom console url
      console-url: https://console.tancloud.cn
      # we work
      we-work-webhook-url: https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=
      # ding ding talk
      ding-talk-webhook-url: https://oapi.dingtalk.com/robot/send?access_token=
      # fei shu fly book
      fly-book-webhook-url: https://open.feishu.cn/open-apis/bot/v2/hook/
      # telegram
      telegram-webhook-url: https://api.telegram.org/bot%s/sendMessage
      # discord
      discord-webhook-url: https://discord.com/api/v9/channels/%s/messages
      # server酱
      server-chan-webhook-url: https://sctapi.ftqq.com/%s.send
      # gotify
      gotify-webhook-url: http://127.0.0.1/message?token=%s
    
    scheduler:
      server:
        enabled: true
        port: 1158

        
  sureness.yml: |+
    resourceRole:
      - /api/account/auth/refresh===post===[admin,user,guest]
      - /api/apps/**===get===[admin,user,guest]
      - /api/monitor/**===get===[admin,user,guest]
      - /api/monitor/**===post===[admin,user]
      - /api/monitor/**===put===[admin,user]
      - /api/monitor/**===delete==[admin]
      - /api/monitors/**===get===[admin,user,guest]
      - /api/monitors/**===post===[admin,user]
      - /api/monitors/**===put===[admin,user]
      - /api/monitors/**===delete===[admin]
      - /api/alert/**===get===[admin,user,guest]
      - /api/alert/**===post===[admin,user]
      - /api/alert/**===put===[admin,user]
      - /api/alert/**===delete===[admin]
      - /api/alerts/**===get===[admin,user,guest]
      - /api/alerts/**===post===[admin,user]
      - /api/alerts/**===put===[admin,user]
      - /api/alerts/**===delete===[admin]
      - /api/notice/**===get===[admin,user,guest]
      - /api/notice/**===post===[admin,user]
      - /api/notice/**===put===[admin,user]
      - /api/notice/**===delete===[admin]
      - /api/tag/**===get===[admin,user,guest]
      - /api/tag/**===post===[admin,user]
      - /api/tag/**===put===[admin,user]
      - /api/tag/**===delete===[admin]
      - /api/summary/**===get===[admin,user,guest]
      - /api/summary/**===post===[admin,user]
      - /api/summary/**===put===[admin,user]
      - /api/summary/**===delete===[admin]
      - /api/collector/**===get===[admin,user,guest]
      - /api/collector/**===post===[admin,user]
      - /api/collector/**===put===[admin,user]
      - /api/collector/**===delete===[admin]
      - /api/status/page/**===get===[admin,user,guest]
      - /api/status/page/**===post===[admin,user]
      - /api/status/page/**===put===[admin,user]
      - /api/status/page/**===delete===[admin]
    
    # config the resource restful api that need bypass auth protection
    # rule: api===method 
    # eg: /api/v1/source3===get means /api/v1/source3===get can be access by anyone, no need auth.
    excludedResource:
      - /api/alerts/report/**===*
      - /api/account/auth/**===*
      - /api/i18n/**===get
      - /api/apps/hierarchy===get
      - /api/push/**===*
      - /api/status/page/public/**===*
      # web ui resource
      - /===get
      - /dashboard/**===get
      - /monitors/**===get
      - /alert/**===get
      - /account/**===get
      - /setting/**===get
      - /passport/**===get
      - /status/**===get
      - /**/*.html===get
      - /**/*.js===get
      - /**/*.css===get
      - /**/*.ico===get
      - /**/*.ttf===get
      - /**/*.png===get
      - /**/*.gif===get
      - /**/*.jpg===get
      - /**/*.svg===get
      - /**/*.json===get
      - /**/*.woff===get
      - /**/*.eot===get
      # swagger ui resource
      - /swagger-resources/**===get
      - /v2/api-docs===get
      - /v3/api-docs===get
      # h2 database
      - /h2-console/**===*

    # account info config
    # eg: admin has role [admin,user], password is hertzbeat
    # eg: tom has role [user], password is hertzbeat
    # eg: lili has role [guest], plain password is lili, salt is 123, salted password is 1A676730B0C7F54654B0E09184448289
    account:
      - appId: admin
        credential: hertzbeat
        role: [admin]
      - appId: tom
        credential: hertzbeat
        role: [user]
      - appId: guest
        credential: hertzbeat
        role: [guest]
      - appId: lili
        # credential = MD5(password + salt)
        # plain password: hertzbeat
        # attention: digest authentication does not support salted encrypted password accounts
        credential: 94C6B34E7A199A9F9D4E1F208093B489
        salt: 123
        role: [user]
---
# Source: hertzbeat/templates/tsdb/configmap.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: v1
kind: ConfigMap
metadata:
  name: "my-release-hertzbeat-tsdb"
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
data:
  TZ: "Asia/Shanghai"
---
# Source: hertzbeat/templates/database/pvc.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: my-release-hertzbeat-database
  annotations:
    helm.sh/resource-policy: keep
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
    component: database
spec:
  accessModes: 
    - ReadWriteOnce
  resources:
    requests:
      storage: 4Gi
---
# Source: hertzbeat/templates/tsdb/pvc.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: my-release-hertzbeat-tsdb
  annotations:
    helm.sh/resource-policy: keep
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
    component: tsdb
spec:
  accessModes: 
    - ReadWriteOnce
  resources:
    requests:
      storage: 4Gi
---
# Source: hertzbeat/templates/database/service.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: v1
kind: Service
metadata:
  name: my-release-hertzbeat-database
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 5432
      targetPort: 5432
      protocol: TCP
  selector:
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    component: database
---
# Source: hertzbeat/templates/manager/service-cluster.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: v1
kind: Service
metadata:
  name: "my-release-hertzbeat-cluster"
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 1158
      targetPort: 1158
      protocol: TCP
      name: cluster
  selector:
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    component: manager
---
# Source: hertzbeat/templates/manager/service-expose.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
apiVersion: v1
kind: Service
metadata:
  name: "my-release-hertzbeat-http"
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm 
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 1157
      targetPort: 1157
  selector:
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    component: manager
---
# Source: hertzbeat/templates/tsdb/service.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: v1
kind: Service
metadata:
  name: my-release-hertzbeat-tsdb
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 8428
      targetPort: 8428
      protocol: TCP
  selector:
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    component: tsdb
---
# Source: hertzbeat/templates/collector/deployment.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-release-hertzbeat-collector
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
    component: collector
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: hertzbeat
      app.kubernetes.io/instance: my-release
      component: collector
  template:
    metadata:
      labels:
        app.kubernetes.io/name: hertzbeat
        app.kubernetes.io/instance: my-release
        component: collector
    spec:
      securityContext:
        {}
      containers:
        - name: hertzbeat-collector
          securityContext:
            {}
          image: "apache/hertzbeat-collector:v1.6.0"
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 1159
              protocol: TCP
          livenessProbe:
            tcpSocket:
              port: 1159
          readinessProbe:
            tcpSocket:
              port: 1159
          envFrom:
            - configMapRef:
                name: "my-release-hertzbeat-collector"
          volumeMounts:
            - mountPath: /opt/hertzbeat-collector/config/application.yml
              subPath: application.yml
              name: application
          resources:
            {}
      volumes:
        - name: application
          configMap:
            name: my-release-hertzbeat-collector
---
# Source: hertzbeat/templates/manager/deployment.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-release-hertzbeat
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
    component: manager
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: hertzbeat
      app.kubernetes.io/instance: my-release
      component: manager
  template:
    metadata:
      labels:
        app.kubernetes.io/name: hertzbeat
        app.kubernetes.io/instance: my-release
        component: manager
    spec:
      securityContext:
        {}
      containers:
        - name: hertzbeat
          securityContext:
            {}
          image: "apache/hertzbeat:v1.6.0"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 1157
              protocol: TCP
            - name: cluster
              containerPort: 1158
              protocol: TCP
          livenessProbe:
            tcpSocket:
              port: 1157
          readinessProbe:
            tcpSocket:
              port: 1157
          volumeMounts:
            - mountPath: /opt/hertzbeat/config/application.yml
              subPath: application.yml
              name: application
            - mountPath: /opt/hertzbeat/config/sureness.yml
              subPath: sureness.yml
              name: sureness
          resources:
            {}
      volumes:
        - name: application
          configMap:
            name: my-release-hertzbeat
        - name: sureness
          configMap:
            name: my-release-hertzbeat
---
# Source: hertzbeat/templates/database/statefulset.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-release-hertzbeat-database
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
    component: database
spec:
  replicas: 1
  serviceName: my-release-hertzbeat-database
  selector:
    matchLabels:
      app.kubernetes.io/name: hertzbeat
      app.kubernetes.io/instance: my-release
      component: database
  template:
    metadata:
      labels:
        app.kubernetes.io/name: hertzbeat
        app.kubernetes.io/instance: my-release
        component: database
    spec:
      securityContext:
        {}
      containers:
      - name: database
        image: postgres:15
        imagePullPolicy: IfNotPresent
        livenessProbe:
          tcpSocket:
            port: 5432
          initialDelaySeconds: 300
          periodSeconds: 10
        readinessProbe:
          tcpSocket:
            port: 5432
          initialDelaySeconds: 1
          periodSeconds: 10
        resources:
            {}
        envFrom:
          - configMapRef:
              name: "my-release-hertzbeat-database"
        volumeMounts:
        - name: data
          mountPath: /var/lib/postgresql/data
          subPath: ""
        - mountPath: /docker-entrypoint-initdb.d/schema.sql
          subPath: schema.sql
          name: schema
      volumes:
        - name: schema
          configMap:
            name: my-release-hertzbeat-database
        - name: data
          persistentVolumeClaim: 
            claimName: my-release-hertzbeat-database
---
# Source: hertzbeat/templates/tsdb/statefulset.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-release-hertzbeat-tsdb
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
    component: tsdb
spec:
  replicas: 1
  serviceName: my-release-hertzbeat-tsdb
  selector:
    matchLabels:
      app.kubernetes.io/name: hertzbeat
      app.kubernetes.io/instance: my-release
      component: tsdb
  template:
    metadata:
      labels:
        app.kubernetes.io/name: hertzbeat
        app.kubernetes.io/instance: my-release
        component: tsdb
    spec:
      securityContext:
        {}
      containers:
      - name: tsdb
        image: victoriametrics/victoria-metrics:v1.95.1
        imagePullPolicy: IfNotPresent
        livenessProbe:
          tcpSocket:
            port: 8428
          initialDelaySeconds: 300
          periodSeconds: 10
        readinessProbe:
          tcpSocket:
            port: 8428
          initialDelaySeconds: 1
          periodSeconds: 10
        resources:
            {}
        envFrom:
          - configMapRef:
              name: "my-release-hertzbeat-tsdb"
        volumeMounts:
        - name: data
          mountPath: /victoria-metrics-data
          subPath: ""
      volumes:
        - name: data
          persistentVolumeClaim: 
            claimName: my-release-hertzbeat-tsdb
---
# Source: hertzbeat/templates/manager/ingress.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: "my-release-hertzbeat-ingress"
  annotations:
    {}
  labels:
    helm.sh/chart: hertzbeat-1.6.0
    app.kubernetes.io/name: hertzbeat
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/version: "v1.6.0"
    app.kubernetes.io/managed-by: Helm
spec:
  
  rules:
    - host: hertzbeat.domain
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: "my-release-hertzbeat-http"
                port:
                  number: 1157
  tls:
    - secretName: your-tls-secret
      hosts:
        - hertzbeat.domain
---
# Source: hertzbeat/templates/collector/hpa.yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
