---
# Source: antrea-ui/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: antrea-ui
  namespace: default
  labels:
    app: antrea-ui
---
# Source: antrea-ui/templates/secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: antrea-ui-jwt-key
  namespace: default
data:
  key.pem: "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlKS1FJQkFBS0NBZ0VBcEtxQUJ2bWxXK0tPVi8vTXZzNEdNcWZVMWc5UEhHZEJ6a1VmUHJYbnA1bmx5TTVxCi9QVlJNK21iSXhHMlJPSUxJQWNGNVYzRWplNXB4S3NScGliQU82aEhKbVlRUnVBMDBCOTZqa3ZEazlIRmVIYzEKLzZnL2hOMm5iK3lBSXVWdnM4TmVCT0RROUhjdEsveFhtYk1NYm5RV1JrcGdQT1RSWW9KQU8wblo0ZGYxNGRScwoxa3cwZ1NLWjdZZXAxMXl0MDFBTUhsRUI5NkV4TWs5dDNIaXBBRFpzQ3hoNnRGN1R1WFgrT2lRRWhmSldSZ3ZwCmJmUUJWV1o2alhkOEdtbWRlV1VrT0UvUUdjL1hwcktqeEkwell4ckFFTHVObWlHY3AvWVE1NjBET1NSU1hoLzYKT0dvZ3pscVo5YnJoRUo5bDFobFpVaXhIb1dSTk9FWmdWZG5jeFJ1eUorRnh3UDdoSVFYS2xIZkpmZWxNaHFIbAorYUpBdmZmL25ldEZsQnI2emxiZUpvRTN0THBsQURqZDJzOVBuSnFrOEhQS2o4Q0ViMi83VnI4RGpseXp6ZTJnClZXQkhXTjhtL3YvQVg2bTFZTHNEdmY0Tmk0RjUzZmw0MUt5VnQ1S2NEYVpuTkNmMTdFN0dTZy9ScHJldGZtOUsKZXBDc2hMTTA3N2ltVDQ3Ykl3RS81ZytyRlR6UzRUQWFlKzJBVzRwRkVVMkxnNjFuVXZzbndxbVUxbWJCYUtqagpncUg0bGNMd1pWd0NLVGhjaTg4MS9EbVJGb2ppdTY4aGJGM1FVTHgyb1MwNWtvNFdiNzRpK05YdjJCRUpoamE3CkdxM3dnaktZNDBWa2ZmS0Z1M2gzSGdtdzRocEF0QUpRaCthUVdUM04veTdkY1daU0ZBN1o2ZHA4aEZjQ0F3RUEKQVFLQ0FnQXZOL2s0aHRRRk1rVlJOTGdZcXVtYUV3aDBUYldJMW85SFFBa0NxWlVCT1o5cjRzMUpObXVQc0ZoZApTUkgwVk1HTjhKV2ZQVEZFNWU0TWlHV3FPSWg5VXZiOEt0NVdCS3NBVjFhRWdYTlc2eHR1UFBrT0U4Z0xLS2gvCjd0aWJxU0ZMOGlUK3p4ejhUVVIxelltdE9HdkRMS1RLaVQ5cGxzLzRLSk9Vck11KytIZTR4M3BpUlQzMUhkLzMKL2lRVTdxMmwzOWxweEI4RlRJTFlBM0RrZlBFeGIybXlFTlgyN1E1WHExODRldVdWSjNYWDVraU0wQ0NseFpvMQpBT05raTQ2dHBmUXA5YkVlQmJ5NFA1ZTRvQ2p4TFZXUU5zZ1hQN1kxYjlsUEpneTdrUS9SaitmbnozOFN6V1pDCjBkRUNQRU11anR4UE5RVmhZV3JIVFY4SW4wMnYva25mQU8yRENhVUhHeEZpRUlEVitKRFc5eTU3WllzYzNITTYKc0dHaElubU00WW1FZTloRGpCbVIxOGszRU1reDJRd1JSOVBOb09TVG5WQjlJM2NiSGlncG5Ec09JVnlyTUEwdQp6cXV0Z0dja21Eak9FSittK2JGL2pyT3ZLYldjWXpxUnFXd2RkWXlDbURYNXJWT2FZcDcrZ2xFMnlmUXJ6aU5RCkJlOHgrbHdaOXQycjN4dnJybGd4NlM0Yit1T2gwdm9RTVZSalUycno4amI1cWFpTk5PcTBZS25Edzc3cUdkQVQKdlozS0ZONjljQ0FZUXlOc1U0OWdRMTgrbGp6cy83Tk9iTGNGWUVrdVlvMFZRZzhQSlFzK0RoVzhLdCt2c0F4SAp0RVRkVXJ6amFTWmpwT3Q3eWEzMU03aDQ4VTdXS25IajR5QWlKRVc0b3Iwd2hIczl5UUtDQVFFQTBKbC9oazY3Cis2RUhIS0hhZFJRVnBaMHNKb3lFMUpCbUhJUDBVcnN6aTh3L2szNWZWcUdIY09WYjBjL0ZJMFlUbFovL3JIRy8KL1ZEc0YxcS9zQzFwbFcrTVZrK0lnRk5TWHJoTDcxTDduSUJ1QllncGxYeUQvZjF0ay9janUxZngxcDhyRkdQcwpuQUlvVkZQbEtXeWpQaGNSUlJIUG9PbVBqMzJKRzFZdzVjVnExc0JPOEo0K2U0ZXo2NTRCMk1WVTlpVGJBeE12Ck0vQ05hbFl2aWhlYURrNC9XRWhNVE1vZERpZkJtTHNsNERkazEzTE8zQ1pOTkRIZHR1UG5UdVpYYmc3dHpsY1kKNmlqUnNWNDluQml6Zy9YVHVKRjBPRlF3VXZWTWN5SFlHV3FabmQ5VncxYWlBd1k0V3J2OVB4N2dwMkJFS1FsdApHVlN3ei9qQWl5K2J1d0tDQVFFQXloVlVjbGVCaDdYekNESjZiSmd4N3h1a1VEUEJqTXpFV1lOd1ZYbUJpWGNDClBJbUhpRm5XM1JRcUp5NGpzK2hDN2o2TFBiVkpKeksrU2wwU28ySFJFU21rVGhaNnJHVjJjNjFWOVl0WDdVU1MKbVo2L2dML2xFbjk4cXROK1lxbDBKMThURjZZSnNYNi84ekV2ekFTMWxLMUJXaDdUUGZkdTQ3dFpXMW9RcWJ6VQpzTzBhRmt0Q0YvSUxRdnpPOWRQTGFObVh3K2N3OXQxNk5Mdi92S2h5WkQ5dkxYV1lod2QxdllOWnBpL2ZqTkwrClFOTDF2aU5tZlRoOXRLNXlqWW0zaDcvNzF3TUgzVXYrNkJkb0RDbEVnZEhmdWpLNEYzdmtQeUZkaFBKOHhPM0UKeGdvMThTditZNS9tc0JJOHZScjZXUXYxMUVIU0kzK3ZLejBsMnE5YUZRS0NBUUVBem5BNmpsWjVIMHQ3V0ZDdAplOVNHbjhIdUliQksvSHB6TTZFN09HemZWR2lzT25HRU5KM2pCazFXRTB3Rmt5VVUyS3poUUczS1RRMjZ1Rm9zCi9sUFMrL3JLN2RnRUJNdHc1eUNJdGE1d0o2L0tNbHRRbkFvQUxtcVIrUzlLQTJ2RGdGMUJLd3JBN0p3T0FYYU4KZ2ZOcmtsVU4yRWNLTGZzM0FoQ0FrYmM0NlF2NDhkS2J6UEV1Y040WnB3SldYWXJjekVRcEl0L25oUVY1VGxWQQo4dTdzblYrK3ZNWEFEUGF3em9OMXlvcmJyd3ZqRm4wZVR5endsc2tLM0thckVhQlB3akd3RXRhTFo2RkI5TUNKClJHUUZ0SUNpS1RSNXlnMDNUY0pKQ0Yva0Z6TXlGOVVnY1JMWmZ4aTJ5TVRtbVlNYlhVbWQ2dWJUTzVCZTgxTUEKYWo2UlpRS0NBUUJldW1yd2dvYU1tRVVKaGFnUHViUkdrcDJPbndST3ZUb1pmOXlycEo2TlVzVXduWU56N2pFagpSeTJQV2ppUVFBTUg3VGVXUUtHL0J6RmVhSXl4Rzh4R0VGQWQ3cm1va0pOYkhGamNGbXFzSldYWEx5d3o3VUF6ClVLR2U3aThqanEyTk95c1cvZFV6WitnUTF2REI0VDlCSjRvbjlhVXVPZ3U0SXYxN0xoZjdpVEhta2U2Vm5zZW4KcytXRmpENXp5OGxoS0FiVlpVMTFtMUtLMzhtOHBQV2llbjNpUUdxMGVWRysrWkNQcjRkS1d5bW1OMzNNbUltVgpqMktWek9TVDVvZXEwZHI2NmtmSWU3Uk5GWlBIaDV5K2dpUXZBMUY2YUxBUXk5SXIzUU9SeUtkaDhpMWhGUzlWCmdnSkFiUHdkNVVTUGMyVFVEOXF5bTBzQXFOUlMwN29WQW9JQkFRQ3ViMkRJVzJiRjB5dUt6SXdYVFF3UlJyQmMKOHRkMzRqdWI3clRiYkJuckl2TkwzSk8zRXBmQW5LZkc5bEFucjIrRjkwbytLMzdsNDBLZjBDUW9Tc1J4TXJKbwptR1g3czBDb1o2U1Z2QjJWQ1VKUVB1K2tmVnFoY2F6KzZzZE41MUlqeHdRamdjZzU4ZHVsOFFXcHRzM01obW12ClB3UFlpdjY4aWVKWVMvRVNOOEhEZnFlQVp4RFFjQXA2cXY0Uk5JSFhZcmZKWlZpbmx2VDBSYjEvOFYrTUZIYm8KRVVjMnVmeHhlMjB1RU0xeGlQbmpPSUd2MFFJdlZYbVUwbEppZ1E1VUg0TERSZXh2YVdCeTlpYXhNcERkcXFpYgpiT1o5cFAvNFlDcGpmajhXMmtkQ211RlM0YTI5YW02SHpBdTg2Tk44NFlUVDlSbzlBL0MyWjdXelJDOFQKLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K"
---
# Source: antrea-ui/templates/configmaps.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: antrea-ui-nginx
  namespace: default
data:
  nginx.conf: "server {\n    listen       3000;\n    listen       [::]:3000;\n    server_name _;\n    root /app;\n    index index.html;\n    client_max_body_size 10M;\n\n    location / {\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Real-IP $remote_addr;\n\n        location /api {\n            proxy_http_version 1.1;\n            proxy_pass_request_headers on;\n            proxy_hide_header Access-Control-Allow-Origin;\n            proxy_pass http://127.0.0.1:8080;\n            # ensure the correct flags are set, even though the api server should already be setting them\n            proxy_cookie_flags ~ httponly;\n        }\n\n        # at the moment, the config is the same as for /api\n        location /auth {\n            proxy_http_version 1.1;\n            proxy_pass_request_headers on;\n            proxy_hide_header Access-Control-Allow-Origin;\n            proxy_pass http://127.0.0.1:8080;\n            # ensure the correct flags are set, even though the api server should already be setting them\n            proxy_cookie_flags ~ httponly;\n        }\n\n        location / {\n            try_files $uri $uri/ /index.html;\n        }\n    }\n}"
---
# Source: antrea-ui/templates/configmaps.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: antrea-ui-backend
  namespace: default
data:
  server.conf: "addr: \":8080\"\nurl: \nauth:\n  basic:\n    enabled: true\n  oidc:\n    enabled: false\n    issuerURL: \n    discoveryURL: \n    providerName: \n    logoutURL: \"\"\n  jwtKeyPath: \"/app/jwt-key.pem\"\n  cookieSecure: false\nlogVerbosity: "
---
# Source: antrea-ui/templates/clusterrole.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: antrea-ui
  labels:
    app: antrea-ui
rules:
  - apiGroups:
      - crd.antrea.io
    resources:
      - antreacontrollerinfos
    verbs:
      - get
  - apiGroups:
      - crd.antrea.io
    resources:
      - antreaagentinfos
    verbs:
      - list
      - get
  - apiGroups:
      - crd.antrea.io
    resources:
      - traceflows
      - traceflows/status
    verbs:
      - get
      - list
      - watch
      - create
      - delete
  - apiGroups:
      - ""
    resources:
      - configmaps
    verbs:
      - get
      - watch
      - list
    resourceNames:
      - antrea-config
      - antrea-ca
  - nonResourceURLs:
      - /featuregates
    verbs:
      - get
---
# Source: antrea-ui/templates/clusterrolebinding.yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: antrea-ui
  labels:
    app: antrea-ui
roleRef:
  kind: ClusterRole
  name: antrea-ui
  apiGroup: rbac.authorization.k8s.io
subjects:
- kind: ServiceAccount
  name: antrea-ui
  namespace: default
---
# Source: antrea-ui/templates/role.yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: antrea-ui
  namespace: default
  labels:
    app: antrea-ui
rules:
  - apiGroups:
      - ""
    resources:
      - "secrets"
    resourceNames:
      - "antrea-ui-passwd"
    verbs:
      - "get"
      - "update"
  - apiGroups:
      - ""
    resources:
      - "secrets"
    verbs:
      - "create"
---
# Source: antrea-ui/templates/rolebinding.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: antrea-ui
  namespace: default
  labels:
    app: antrea-ui
roleRef:
  kind: Role
  name: antrea-ui
  apiGroup: rbac.authorization.k8s.io
subjects:
- kind: ServiceAccount
  name: antrea-ui
  namespace: default
---
# Source: antrea-ui/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: antrea-ui
  namespace: default
  labels:
    app: antrea-ui
  annotations:
spec:
  type: ClusterIP
  ports:
    - port: 3000
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: antrea-ui
---
# Source: antrea-ui/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: antrea-ui
  namespace: default
  labels:
    app: antrea-ui
spec:
  replicas: 1
  selector:
    matchLabels:
      app: antrea-ui
  template:
    metadata:
      labels:
        app: antrea-ui
      annotations:
        # every time the chart is templated, a new JWT key is generated, so we
        # need to re-create the Pod
        rollme: "gWZo4"
        kubectl.kubernetes.io/default-container: frontend
    spec:
      serviceAccountName: antrea-ui
      securityContext:
        runAsNonRoot: true
        runAsUser: 65532
        runAsGroup: 65532
        fsGroup: 65532
      containers:
        - name: frontend
          image: "antrea/antrea-ui-frontend:v0.5.1"
          imagePullPolicy: IfNotPresent
          env:
            - name: NGINX_RELOADER_DIRECTORIES
              value: ""
          ports:
            - name: http
              containerPort: 3000
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http
          resources:
            {}
          volumeMounts:
            - name: nginx-conf
              mountPath: /etc/nginx/conf.d/default.conf
              subPath: nginx.conf
              readOnly: true
        - name: backend
          image: "antrea/antrea-ui-backend:v0.5.1"
          imagePullPolicy: IfNotPresent
          args:
            - "-c"
            - "/app/server-conf.yaml"
          env:
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
          ports:
            - name: api
              containerPort: 8080
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /healthz
              port: api
          readinessProbe:
            httpGet:
              path: /healthz
              port: api
          resources:
            {}
          volumeMounts:
            - name: server-conf
              mountPath: /app/server-conf.yaml
              subPath: server.conf
              readOnly: true
            - name: jwt-key
              mountPath: /app/jwt-key.pem
              subPath: key.pem
              readOnly: true
      nodeSelector:
        kubernetes.io/os: linux
      volumes:
        - name: nginx-conf
          configMap:
            name: antrea-ui-nginx
        - name: server-conf
          configMap:
            name: antrea-ui-backend
        - name: jwt-key
          secret:
            secretName: antrea-ui-jwt-key
            defaultMode: 0400
      terminationGracePeriodSeconds: 10
