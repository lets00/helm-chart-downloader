---
# Source: chaosblade-operator/templates/rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: chaosblade
  labels:
    name: chaosblade
  namespace: default
---
# Source: chaosblade-operator/templates/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: chaosblade-webhook-server-cert
  namespace: default
  labels:
    app: chaosblade-operator
    chart: "chaosblade-operator-1.7.0"
    heritage: Helm
    release: my-release
type: kubernetes.io/tls
data:
  tls.crt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURqRENDQW5TZ0F3SUJBZ0lRSHFBeUtYRVpnSUdsYmdMYjBidkZBekFOQmdrcWhraUc5dzBCQVFzRkFEQW4KTVNVd0l3WURWUVFERXh4amFHRnZjMkpzWVdSbExYZGxZbWh2YjJzdGMyVnlkbVZ5TFdOaE1CNFhEVEkwTURZeApOakF3TURFeU9Wb1hEVE0wTURZeE5EQXdNREV5T1Zvd0pERWlNQ0FHQTFVRUF4TVpZMmhoYjNOaWJHRmtaUzEzClpXSm9iMjlyTFhObGNuWmxjakNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFOTlMKWW1PVTJGOVdSZS96NCthU1M4S1lqOEFSTi9tQ0NKclBROWhQUEE3TFpUeUFhbEo1R010eVllMGo3SEgvQTYydwora3o4QkFHZEpnT3hEaWM3MGMvdklobzNVVm80cWFqbHZobWo3TTdpM2EyOUJEMkdwbjl3ck9SYkVrZUZ0clp4CkR4UkNjN1VLSysyNjVmaDc0aE1XV0lVMlFNVVZpalgyOUlSR0FQTDZ4MFZZRVhOYXh5V3lTOGg2R00wbEtZUGwKVDZDMHNJMUo3UVFJRTRCWk9FWmVIQVhqZ25uRWc5Q3R4eXdyemQ5VlFHQ2VEYm4xam8xTmEvalBSaVYwSU9IWApIT0EvbW9qN2NxSU5pZGhUMGtBbEZYVFZhMjB2ZnBmQmNIUk45LzBjYWo2NkxxdEtVb2VYdzlNT0txbE1QVXBBCkFiQ0Y4MGtzZFVXdDZZeCtLVzhDQXdFQUFhT0J0akNCc3pBT0JnTlZIUThCQWY4RUJBTUNCYUF3SFFZRFZSMGwKQkJZd0ZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQXdHQTFVZEV3RUIvd1FDTUFBd0h3WURWUjBqQkJndwpGb0FVR0w5cXFIaUxQVXJOYXJGSlJBZ05PbmlHRmtvd1V3WURWUjBSQkV3d1NvSWhZMmhoYjNOaWJHRmtaUzEzClpXSm9iMjlyTFhObGNuWmxjaTVrWldaaGRXeDBnaVZqYUdGdmMySnNZV1JsTFhkbFltaHZiMnN0YzJWeWRtVnkKTG1SbFptRjFiSFF1YzNaak1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQWZYTWNhY0krRWtBWGpsWWpmajg1VApZc3pyYTNtWUR1UDRMNGUzaUg2bWkwQysyM0xmeTlDYVgzTzdoNklSZVNSQTk2QmJBR0I2cUZ3ckt5UGhHSXZLClZSbmFDZVFQUXNsOEF5T2doamNia2djT3crcml0YklOTWxDdHhCVSs4ZnlFMjBTMkRTWm4za0wwQVBmU25XeHAKb1llZ3FGRk54SERhM1lXZExZeHpkeFdMVnM4cWZnMm10UWplaGw3WC9DNnhyY3dXSkxoc3ZGY0pxRTIwODhyLwpRQTVlVDFvUjhEcERXNUdlVVFRZENqbUtNNHdwclFDUWx6a09Ea0FtSkIrNWFqQVZMbDNjRWZrOEo2L01KekZXCnBDclJzeHBaZU9LT2ZBQU9kS1JoV1JyWWx2RlBSdVRCY01DK2hJeVZuS1l1ZURodGxZb3lnMzJzd2ZmVFh0bW8KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
  tls.key: "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBMDFKaVk1VFlYMVpGNy9QajVwSkx3cGlQd0JFMytZSUltczlEMkU4OERzdGxQSUJxClVua1l5M0poN1NQc2NmOERyYkQ2VFB3RUFaMG1BN0VPSnp2UnorOGlHamRSV2ppcHFPVytHYVBzenVMZHJiMEUKUFlhbWYzQ3M1RnNTUjRXMnRuRVBGRUp6dFFvcjdicmwrSHZpRXhaWWhUWkF4UldLTmZiMGhFWUE4dnJIUlZnUgpjMXJISmJKTHlIb1l6U1VwZytWUG9MU3dqVW50QkFnVGdGazRSbDRjQmVPQ2VjU0QwSzNITEN2TjMxVkFZSjROCnVmV09qVTFyK005R0pYUWc0ZGNjNEQrYWlQdHlvZzJKMkZQU1FDVVZkTlZyYlM5K2w4RndkRTMzL1J4cVByb3UKcTBwU2g1ZkQwdzRxcVV3OVNrQUJzSVh6U1N4MVJhM3BqSDRwYndJREFRQUJBb0lCQVFDVGZ5bzdWVlhjM1V1OQpXdDdVUFlKeGxhaW9KNXlKSTNDOEZUVEdreTlaS0RCR0ZWK2dwdk5lZFR6U2wwTmVvZDlBYVltYkdELzNuR2MvCkptSzVrYkExVVRUZFZZVUwwd2JnWTFMWGRLcENFT2tuYmdtNm8vUXNlVW5EcmFsSmtKUGlMWEdYODNYdGcrYjcKYkhzOWY4SmhEalRFN2dReFM0S0hmaEpYRE1GMjFidWcrWHAwUmhtMTkzY2tmUGl2eG4walVGSXhwWUxEb2ViNApYWGF6MnhxSUxSU0hIZFVPajVvai83WllneG5zQVdOSjROY0Vob1Q5eHE0YitFdDZHdTlvRE52dnV6bVRhVi82Cnc4VEhBRTVIcm5pTmJYc3E0emJVVUlIOWN5WXk3NzZsUFFCYWE2WGJNbndsOTl3ZGorZTV6dWVoSHZKc0pOWkcKVWF6SUFzWXBBb0dCQVBuZVhyb0tqa2VmQVpyOG1KSDRFQitnMlFpMjVSQWxVWEJZTzhacllyS0svVncxSmczNwpKZlNSbkhnRGgvMXNEOEJHMlM5Tm9ET09yck5MMzZLVDVzWCtvVjBPRlc5ZVgrNkhYMGJJOS9JOVpvVFo5RXV6ClFNZFpjdWdvUlh2UmtwU1I3RFdrWTRJVUk2K1l4dUo1Vm43aWd3aHFiQURZdmNBam9lblFiU1I3QW9HQkFOaUIKM3I2YXRmU2gxK1lqQXhJdnJWWVVIQm5jbnl6dTNWWEhsUWtTVlc1V1NuRi9RTk55cmFxSURWeWNoNGIyVlhXOQpkYnJDcFI2SFRnYTh2UUZLYUVmeStVanl4TmtmdnJjNk1pZ29zd1dkRXc4cytFZGk4eVRxTEVUZTdGMWErQXh2CnpKMTNVdVJieWlKY29TNzJMUlgydmRzRGRJZFlKMGhxTVFJSld6NmRBb0dCQUxDYTVGY1lPT0lVVjcwa3hlMTkKNkYrQ2Y0UHlTVXExSmErREhaU3J0OUc3L1VGYjYyNjhVV0pnUExoeXZuNTNEMWIyZkhFN3EzeGxYOE1vWUlOMwppQWZ2Wmp2d1JXUTJ6eFUzcHpiUHVyZ0RmOTlzY1lmRHhZaGhCNTloUDJNNWlDSHNWWWpBalBpV3BYWnFSRUEwClJOZGYzLzlsd0xxRWR2RkQvaC9WaWg3YkFvR0FXY3Q3UTVoTThQb1MzaXNWUWZ5dUttNUt2VnNvVlcxNE5QU0MKMW5GWkoxcjRveHdCR2ZHTkg1WXYzSUk3SDNtWk5penU0QmVNZmgzbCtadGIxR1kwMitwbEE2RlVqU3pDWDZIdQpYWU9MeEQ5Q1FXQUlWU3N2NXRhTXA3L0JUbkxGUC9zNlpQQ3hXMjdLWmZmL0RjZ2lLT0xlR1REVXFyR2dFVU9oCnNkT0ptVzBDZ1lFQW1KSy9MQXBNUXpBQ2NKQ1Z1RHVZbEJOd1RwbHQyRWxmZ1JGYVlxNEVTZHROQWlHMzB6SGcKQ2dOanBsZDF3UWE5cUc5TlBUMHBrTzlCNkhSbkEzL2I2d00zZldmVzlNcVlqNjJpbXA5OVM5TEpnbE1XVldSVApjZmZ6SHhHNGZIcVlnUVVhbXJhWGdnUUFyRFNHT2pVMXpjWWtHeVNQWXQxWkJSYlQwek55MUNBPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo="
  ca.crt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPakNDQWlLZ0F3SUJBZ0lSQUtWY0pwQlYwbVBCSzJQM09XblZhY1V3RFFZSktvWklodmNOQVFFTEJRQXcKSnpFbE1DTUdBMVVFQXhNY1kyaGhiM05pYkdGa1pTMTNaV0pvYjI5ckxYTmxjblpsY2kxallUQWVGdzB5TkRBMgpNVFl3TURBeE1qbGFGdzB6TkRBMk1UUXdNREF4TWpsYU1DY3hKVEFqQmdOVkJBTVRIR05vWVc5ellteGhaR1V0CmQyVmlhRzl2YXkxelpYSjJaWEl0WTJFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUIKQVFDbnRDQlQ4RnVWWEV3Tm1EWFo3cnZiNWVSMGlxSFpjUGJuUmVTNXhhRkNNWkl0ejltSGErRFcvYkpUK0pRWQpud3M3czRSNmF5QnM1WW1vYitUdFlTYnFnUld1SCsvdGFKQkljcmdNV0cxUGZwcTRtRjRJRjhzYy8wWnVzV09jCkhGd1RhNE5sTmJvZ1l2bGhpVExCUGNobmFWUFZJYjhYaEgxOHU2cEUySkFkaFh2V1dZWkNCVUZWb0syL2U3d2cKSjF1em1BQ2Qxc2ZtSTNTNWVyMzcrVng1Q2QwZTQ4VVE3MXJhQUxvZi9USEJXSnF6ZkJnYVNBV3haVEZHT1VKZQpaNnlpaUc4NVhLMSs4MW51L1dnSDhYaDBMSmhQa2JGK1Q2dng4dkdGR1ZYUUd0aWJQNVFtRmhQYXB5WlR1Q0d5Ck83eFArYnlNMExnUis1NGRXa1F6NWJNUEFnTUJBQUdqWVRCZk1BNEdBMVVkRHdFQi93UUVBd0lDcERBZEJnTlYKSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJS3dZQkJRVUhBd0l3RHdZRFZSMFRBUUgvQkFVd0F3RUIvekFkQmdOVgpIUTRFRmdRVUdMOXFxSGlMUFVyTmFyRkpSQWdOT25pR0Zrb3dEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQzBrCkg3ZzhhZVgxYkt2TGc5NC9PdjZwSXlZd1lDOVlrOWlvMUpCa3U3MWpteGhLMnhtTGtDeVdTVkY4aHFLWExqSCsKWjQ3aUZ3OUZKeGtzWmluSTlxTlVGWk5lUnFFZWdIM3VUcTVZQWdFSVZEV0g5U0p0NVB4V1Nqa05lZ09kb1ZvMApoWnNhaW5NZ1VacU1MZkxQM09zdGFDL1VTTTRJbDN4MGRKV3JFUi9wNU1oaHA0dVVSL1p3dmNnTWoxb0RzVFoyClAxVm8wQWFPVEJaUThVTUZtOVJVQnk2Q3IzVTFzVHRhMTVJb3h5ejZpNTJyOGhLTk4yZlhmQ0FIZjFTTEV0U2wKZUpnS1lnM1Jtc01nTEs0dU16NDJaOUlnd2hGd2Vad2tBYXk5UFc2VXlZYmNkQW55SDRsWjl2cmh0VDlHUDJaYQpqd1lqOGxRZG91dnJIcU9la2FNPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
---
# Source: chaosblade-operator/templates/rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: chaosblade
  labels:
    name: chaosblade
rules:
  - apiGroups:
      - ''
    resources:
      - pods
      - pods/exec
      - configmaps
    verbs:
      - "*"
  - apiGroups:
      - ''
    resources:
      - nodes
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - apps
    resources:
      - daemonsets
      - deployments
    verbs:
      - "*"
  - apiGroups:
      - chaosblade.io
    resources:
      - chaosblades
      - chaosblades/status
    verbs:
      - "*"
---
# Source: chaosblade-operator/templates/rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: chaosblade
  labels:
    name: chaosblade
roleRef:
  kind: ClusterRole
  name: chaosblade
  apiGroup: rbac.authorization.k8s.io
subjects:
  - kind: ServiceAccount
    name: chaosblade
    namespace: default
---
# Source: chaosblade-operator/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: chaosblade-webhook-server
  namespace: default
spec:
  ports:
    - port: 443
      targetPort: 9443
  selector:
    name: chaosblade-operator
---
# Source: chaosblade-operator/templates/daemonset.yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: chaosblade-tool
  labels:
    name: chaosblade-tool
    app: chaosblade-tool
spec:
  selector:
    matchLabels:
      name: chaosblade-tool
      app: chaosblade-tool
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        name: chaosblade-tool
        app: chaosblade-tool
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: type
                    operator: NotIn
                    values:
                      - virtual-kubelet
      containers:
        - name: chaosblade-tool
          image: chaosbladeio/chaosblade-tool:1.7.0
          imagePullPolicy: IfNotPresent
          env:
            - name: KUBERNETES_NODENAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            - name: DOCKER_API_VERSION
              value: "1.14.0"
          securityContext:
            privileged: true
          volumeMounts:
            - mountPath: /var/run/docker.sock
              name: docker-socket
            - mountPath: /opt/chaosblade/chaosblade.dat
              name: chaosblade-db-volume
            - mountPath: /etc/hosts
              name: hosts
            - mountPath: /var/log/audit
              name: audit
            - mountPath: /var/lib/docker
              name: docker-lib
            - mountPath: /etc/docker
              name: docker-etc
            - mountPath: /run/containerd
              name: containerd
            - mountPath: /var/lib/containerd
              name: containerd-lib
            - mountPath: /etc/containerd
              name: containerd-etc
            - mountPath: /var/run/netns
              name: netns
            - mountPath: /host-sys
              name: sys
      dnsPolicy: ClusterFirstWithHostNet
      hostNetwork: true
      hostPID: true
      tolerations:
        - effect: NoSchedule
          operator: Exists
      volumes:
        - hostPath:
            path: /var/run/docker.sock
          name: docker-socket
        - hostPath:
            path: /var/run/chaosblade.dat
            type: FileOrCreate
          name: chaosblade-db-volume
        - hostPath:
            path: /etc/hosts
          name: hosts
        - hostPath:
            path: /var/lib/docker
          name: docker-lib
        - hostPath:
            path: /etc/docker
          name: docker-etc
        - hostPath:
            path: /var/log/audit
          name: audit
        - hostPath:
            path: /run/containerd
          name: containerd
        - hostPath:
            path: /var/lib/containerd
          name: containerd-lib
        - hostPath:
            path: /etc/containerd
          name: containerd-etc
        - hostPath:
            path: /var/run/netns
          name: netns
        - hostPath:
            path: /sys
          name: sys
      serviceAccountName: chaosblade
---
# Source: chaosblade-operator/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: chaosblade-operator
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      name: chaosblade-operator
  template:
    metadata:
      labels:
        name: chaosblade-operator
        part-of: chaosblade
    spec:
      dnsPolicy: ClusterFirst
      hostNetwork: false
      serviceAccountName: chaosblade
      initContainers:
        - name: chaosblade-tool
          image: chaosbladeio/chaosblade-tool:1.7.0
          imagePullPolicy: IfNotPresent
          command: [ "cp", "-R","/opt/chaosblade", "/home" ]
          volumeMounts:
            - mountPath: /home
              name: chaosblade
      containers:
        - name: chaosblade-operator
          image: chaosbladeio/chaosblade-operator:1.7.0
          command: ["chaosblade-operator"]
          args:
          - '--chaosblade-image-repository=chaosbladeio/chaosblade-tool'
          - '--chaosblade-version=1.7.0'
          - '--chaosblade-image-pull-policy=IfNotPresent'
          - '--log-level=info'
          - '--webhook-enable'
          - '--daemonset-enable'
          - '--remove-blade-interval=72h'
          - '--chaosblade-namespace=default'
          imagePullPolicy: IfNotPresent
          env:
            - name: WATCH_NAMESPACE
              value: ""
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: OPERATOR_NAME
              value: "chaosblade-operator"
          ports:
            - containerPort: 9443
              protocol: TCP
          volumeMounts:
            - mountPath: /tmp/k8s-webhook-server/serving-certs
              name: cert
              readOnly: true
            - mountPath: /opt
              name: chaosblade
      volumes:
        - name: cert
          secret:
            defaultMode: 420
            secretName: chaosblade-webhook-server-cert
        - name: chaosblade
          emptyDir: {}
---
# Source: chaosblade-operator/templates/secret.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: chaosblade-operator
  namespace: default
  labels:
    app: chaosblade-operator
    chart: "chaosblade-operator-1.7.0"
    release: "my-release"
    heritage: "Helm"
webhooks:
  - clientConfig:
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPakNDQWlLZ0F3SUJBZ0lSQUtWY0pwQlYwbVBCSzJQM09XblZhY1V3RFFZSktvWklodmNOQVFFTEJRQXcKSnpFbE1DTUdBMVVFQXhNY1kyaGhiM05pYkdGa1pTMTNaV0pvYjI5ckxYTmxjblpsY2kxallUQWVGdzB5TkRBMgpNVFl3TURBeE1qbGFGdzB6TkRBMk1UUXdNREF4TWpsYU1DY3hKVEFqQmdOVkJBTVRIR05vWVc5ellteGhaR1V0CmQyVmlhRzl2YXkxelpYSjJaWEl0WTJFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUIKQVFDbnRDQlQ4RnVWWEV3Tm1EWFo3cnZiNWVSMGlxSFpjUGJuUmVTNXhhRkNNWkl0ejltSGErRFcvYkpUK0pRWQpud3M3czRSNmF5QnM1WW1vYitUdFlTYnFnUld1SCsvdGFKQkljcmdNV0cxUGZwcTRtRjRJRjhzYy8wWnVzV09jCkhGd1RhNE5sTmJvZ1l2bGhpVExCUGNobmFWUFZJYjhYaEgxOHU2cEUySkFkaFh2V1dZWkNCVUZWb0syL2U3d2cKSjF1em1BQ2Qxc2ZtSTNTNWVyMzcrVng1Q2QwZTQ4VVE3MXJhQUxvZi9USEJXSnF6ZkJnYVNBV3haVEZHT1VKZQpaNnlpaUc4NVhLMSs4MW51L1dnSDhYaDBMSmhQa2JGK1Q2dng4dkdGR1ZYUUd0aWJQNVFtRmhQYXB5WlR1Q0d5Ck83eFArYnlNMExnUis1NGRXa1F6NWJNUEFnTUJBQUdqWVRCZk1BNEdBMVVkRHdFQi93UUVBd0lDcERBZEJnTlYKSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJS3dZQkJRVUhBd0l3RHdZRFZSMFRBUUgvQkFVd0F3RUIvekFkQmdOVgpIUTRFRmdRVUdMOXFxSGlMUFVyTmFyRkpSQWdOT25pR0Zrb3dEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQzBrCkg3ZzhhZVgxYkt2TGc5NC9PdjZwSXlZd1lDOVlrOWlvMUpCa3U3MWpteGhLMnhtTGtDeVdTVkY4aHFLWExqSCsKWjQ3aUZ3OUZKeGtzWmluSTlxTlVGWk5lUnFFZWdIM3VUcTVZQWdFSVZEV0g5U0p0NVB4V1Nqa05lZ09kb1ZvMApoWnNhaW5NZ1VacU1MZkxQM09zdGFDL1VTTTRJbDN4MGRKV3JFUi9wNU1oaHA0dVVSL1p3dmNnTWoxb0RzVFoyClAxVm8wQWFPVEJaUThVTUZtOVJVQnk2Q3IzVTFzVHRhMTVJb3h5ejZpNTJyOGhLTk4yZlhmQ0FIZjFTTEV0U2wKZUpnS1lnM1Jtc01nTEs0dU16NDJaOUlnd2hGd2Vad2tBYXk5UFc2VXlZYmNkQW55SDRsWjl2cmh0VDlHUDJaYQpqd1lqOGxRZG91dnJIcU9la2FNPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
      service:
        name: chaosblade-webhook-server
        namespace: default
        path: /mutating-pods
    name: "chaosblade-operator.default.svc"
    failurePolicy: Ignore
    rules:
      - apiGroups:
          - ""
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - pods
    sideEffects: None
    admissionReviewVersions: ["v1beta1"]
