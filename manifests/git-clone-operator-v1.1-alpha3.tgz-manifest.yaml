---
# Source: git-clone-operator/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
    name: git-clone-operator-sa
    labels:
        helm.sh/chart: git-clone-operator-v1.1-alpha3
        app.kubernetes.io/name: git-clone-operator
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/version: "v1.1-alpha3"
        app.kubernetes.io/managed-by: Helm
---
# Source: git-clone-operator/templates/mutatingwebhookconfiguration.yaml
apiVersion: v1
kind: Secret
metadata:
    name: my-release-git-clone-operator
data:
    tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURuekNDQW9lZ0F3SUJBZ0lRZXJ2b0NzUklDbStHY3FvY2FuOWRXREFOQmdrcWhraUc5dzBCQVFzRkFEQXEKTVNnd0pnWURWUVFERXg5bmFYUXRZMnh2Ym1VdGIzQmxjbUYwYjNJdFlXUnRhWE56YVc5dUxXTmhNQjRYRFRJMApNRFl4TmpBd01qZ3dORm9YRFRNME1EWXhOREF3TWpnd05Gb3dOREV5TURBR0ExVUVBeE1wYlhrdGNtVnNaV0Z6ClpTMW5hWFF0WTJ4dmJtVXRiM0JsY21GMGIzSXVaR1ZtWVhWc2RDNXpkbU13Z2dFaU1BMEdDU3FHU0liM0RRRUIKQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUURuUFVaYm5hczFQYjRxU05TWDZGRW5weEZKektEREZYTXZOZHUySE9JQgp3b0krRmloVGtPZGtyd1h6dUYvV0Q5SHdYNXhrTTNiTTd5MUdqdmRKSmRla3FuWFZiYW5YeHNNSW9IVUU5YjUvCmg3b3ZCNWhqcFJmRDFxRE51TDR0aWpHNE1jbGYwR0s0NmdDSVlEMFgreEhzYnMwbjBFbXpjcGhVVnRjbDlDMU4KMStGOXpkZmplSDZDQjlnU1l0c3FPWHVFSU8zM1dMR3VBTi9Samd1VmhvM2VxdjhMUU9zTW9RTUMxM1FWV291VgpIMzZTK1VDTFVVQWF1TGoxZkN1UlYyeHVmdzFDaFZxWnFjQUQ0KzRqWkVEbDVJOGlTYjl1V3BtSFpETFNuWFRWCnhHNHdaQlZvWHNqdHcwcUxVN3NaSHM2VloxS2Y3ejFaUmZSTEFhWXh6a3VIQWdNQkFBR2pnYll3Z2JNd0RnWUQKVlIwUEFRSC9CQVFEQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVgpIUk1CQWY4RUFqQUFNQjhHQTFVZEl3UVlNQmFBRkgyMnovSVhGVHBOL2M2VW55aDk4SThxOG9lVU1GTUdBMVVkCkVRUk1NRXFDS1cxNUxYSmxiR1ZoYzJVdFoybDBMV05zYjI1bExXOXdaWEpoZEc5eUxtUmxabUYxYkhRdWMzWmoKZ2gxdGVTMXlaV3hsWVhObExXZHBkQzFqYkc5dVpTMXZjR1Z5WVhSdmNqQU5CZ2txaGtpRzl3MEJBUXNGQUFPQwpBUUVBU3VEVUFxdlYvVjJoSzhYc1duN2dtNy9MS2E1dkc4L2NoNmhxUmdBRHlUbTZkOGNpNDRSSHNkeVlwdFFUCjFOKzFub2pJbG5UZEM4S2RlYThNQ2Q4b3VWVmcrYkMxOHBkMFdzY3cxZitxRnZvWkE2NmR6VmlSWWp1eGNiOGgKMnNMNDR6RWZPNjFIRngxTHNIaEI0RWpsazY0cWw5clN2TEloVWpXMkpHd0N2Wm9VVzE1RFN4dlQ2WjhnZno5RApVREFXTGVPZ0RBSVUwQjdyQW91bDNROVFoekt1T3NmZVFZbm03b21jb2xEODlvK0dmT09NdlhkWjR5Q3hNU2VPCjhObUd6OCtZZzNvOU52QzJkZ1QvV0hmZkhGWmRPWnlIbE5vV0FnYUd4dWhNdUxOZGMwQmI0VVZqSkgwcXoxUjIKNEpGeE4vV0FITEtwbEVoaEpwVXBTZmk2Rnc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBNXoxR1c1MnJOVDIrS2tqVWwraFJKNmNSU2N5Z3d4VnpMelhidGh6aUFjS0NQaFlvClU1RG5aSzhGODdoZjFnL1I4RitjWkROMnpPOHRSbzczU1NYWHBLcDExVzJwMThiRENLQjFCUFcrZjRlNkx3ZVkKWTZVWHc5YWd6YmkrTFlveHVESEpYOUJpdU9vQWlHQTlGL3NSN0c3Tko5QkpzM0tZVkZiWEpmUXRUZGZoZmMzWAo0M2grZ2dmWUVtTGJLamw3aENEdDkxaXhyZ0RmMFk0TGxZYU4zcXIvQzBEckRLRURBdGQwRlZxTGxSOStrdmxBCmkxRkFHcmk0OVh3cmtWZHNibjhOUW9WYW1hbkFBK1B1STJSQTVlU1BJa20vYmxxWmgyUXkwcDEwMWNSdU1HUVYKYUY3STdjTktpMU83R1I3T2xXZFNuKzg5V1VYMFN3R21NYzVMaHdJREFRQUJBb0lCQUJ2VURQYVRsL29WVHlCcAptV1FhcWtHYVlvTStKQTYyTXlGNFd0T2swRElrQldhUlpoTUFla2hzbzh1NzRaU3lYTEtQM3hOVCtqVVpoNXBaCk5EdFNXWXhRazFPM0dkeUU2QTNPdWFaNktJM1NlTDZXTEdtNWdZMm84N3N1UTN6Wmg3aENEWmtCVEJBeTRST0kKZVhHOFhtRFV5TTNFekVuVFBhL1FyNTI2c0FVUS9sc3dUN29wOXFpMW5rVFZ0TncyS0o5VklPY2FieFNJalI4SgpvNVQxNHRSNkNMV3UrS1JWS3ErNkFEaTZZOEdqUkNsRVpueUZEZS9kaHQrNzlzVDZaSnI5d1g2NkgwRENJOSs3CnFISmFmNm04aVFBejlLQW8xc3h2K2M2ek1LQ05KRXRTOXRkOWtsN0h4Q1pvRkEyN0FvQXVGR3dMN3BFcFVpa1YKNGRjL0ZBa0NnWUVBOGsyVVQ2NUl1M2cvMnMvZnNHelVUQTVxWXhrMkYyR3NBd3NHSG43cGNJN3ZBTFdwWjhqQwpQNGVudGhBaDQ4L1ByUFpoMHpFWjNCcFhscUhjRDhseU8zdjQ4d3J0Y0t6YkRkYzRIMGNmSkEzSnE1d3o0aDR6ClRPWnFHMnBQZmRWbnV1MXhQWWNrQ3diQThWb0oybis0V1RqUGlKcXRnMWw0b2pVbTRiVlQ0M01DZ1lFQTlFK1gKSlNFS05wR0x4NDhNM1o4RGRWTzBaSDZJdGcwZFJiSFVpbHpXczkvakNQVWFhRC95NjNEb1JUZi92V3R1L0ViNgo4KzJISUZRQ2hxNEhET3F2ZkdhZHQyWGI4b2ZJcTYvWjNGemZTamFtYjdBZTNHN1lHaDFNMmtRbFdVTDVjbjNpCmd1T0ZSVjlrcXRvNlAvZnEwUXo4WkJCNTA4ejV4ejlOZW1sdGVwMENnWUFlbEZubVlIbC9aMkt2cTlKd1FwdmMKYVdsVnptVzhON0JzeGVSa3p1R0pPaERCeHl0MUZLb25PR2liR3BnY1Z5cS9pbXk0S1pjNDV2NHMzWXFYVjNZYQpPY0FtZERlWkk4ZVZqSmJobzZremRLWUNDWG1tek9idWlwblRrZXdzVmxWOEN1Rml3WDUwQWNzeDZvb1owRXFrCnYvMjVJTVJMTW14K0ZEVXZBU0p3THdLQmdRREhCbk9kOXEySVNNZHpXYkRrZGw3dDNMUFBUbGwyM1hZa1NidFkKd0VyVUhDYXJMR2xIMWhqQi9xZnBnN1llRElCTW1sSmtGdk9HdlltVlIvNU1ZbjkxTzI5dWNWZGQyNG41ZTNkaQprbklBMWtaK0pCN3Yrb2ludFlqZklyYStZZFl1bENqTDhpZW1uUkM0TXJGVFhWYjQyTGhmbUNCM0Q3dkh1bVVXCnZQNUg3UUtCZ0dQOC8ya1lFV2s2UFg2SzdRTTdBNi9VZWtwSHRXQ0Qxd3ZBb051b3RsUmN5OVZJZXdRVnNTUDUKWWJ4Smc2eXZ2dXVjdVp4L1hpemxvM2xoeUxSZG95MTZGUjBGbGc3ZVM0eHpXcFJLZG0xUEZzODBiSGpEUjV1RAp5dXhLMGdpZ1dwZ1ZEeHpGVUFMMTZHUnBPejFoZGJUNGk3bEJVOXNSbHMyMlFmaCtQMndBCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
type: kubernetes.io/tls
---
# Source: git-clone-operator/templates/role.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
    name: my-release-git-clone-operator
rules:
    # parsing incoming requests
    - apiGroups:
          - ""
      resources:
          - pods
      verbs:
          - get
          - list
          #- update

    # injecting secrets into target namespace
    - apiGroups:
          - ""
      resources:
          - secrets
      verbs:
          - get
          - list
          - create
          - update
          - delete
          #- update
---
# Source: git-clone-operator/templates/role.yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
    name: my-release-git-clone-operator
roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: my-release-git-clone-operator
subjects:
    - kind: ServiceAccount
      name: git-clone-operator-sa
      namespace: default
---
# Source: git-clone-operator/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
    name: my-release-git-clone-operator
    labels:
        helm.sh/chart: git-clone-operator-v1.1-alpha3
        app.kubernetes.io/name: git-clone-operator
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/version: "v1.1-alpha3"
        app.kubernetes.io/managed-by: Helm
spec:
    type: ClusterIP
    ports:
        - port: 8080
          targetPort: http
          protocol: TCP
          name: http

        - port: 4443
          targetPort: https
          protocol: TCP
          name: https
    selector:
        app.kubernetes.io/name: git-clone-operator
        app.kubernetes.io/instance: my-release
---
# Source: git-clone-operator/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
    name: my-release-git-clone-operator
    labels:
        helm.sh/chart: git-clone-operator-v1.1-alpha3
        app.kubernetes.io/name: git-clone-operator
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/version: "v1.1-alpha3"
        app.kubernetes.io/managed-by: Helm
spec:
    replicas: 1
    selector:
        matchLabels:
          app.kubernetes.io/name: git-clone-operator
          app.kubernetes.io/instance: my-release
    template:
        metadata:
            labels:
                app.kubernetes.io/name: git-clone-operator
                app.kubernetes.io/instance: my-release
        spec:
            terminationGracePeriodSeconds: 5
            serviceAccountName: git-clone-operator-sa
            securityContext:
              fsGroup: 65161
              runAsGroup: 65161
              runAsNonRoot: true
              runAsUser: 65161
            containers:
                - name: webhook-handler
                  image: ghcr.io/riotkit-org/git-clone-operator:v1.1-alpha3
                  imagePullPolicy: Always
                  args: ["serve", "--tls", "--default-image", "ghcr.io/riotkit-org/git-clone-operator:v1.1-alpha3"]
                  env:
                      - name: LOG_JSON
                        value: "false"
                      - name: LOG_LEVEL
                        value: "debug"
                  volumeMounts:
                      - name: tls
                        mountPath: "/etc/admission-webhook/tls"
                        readOnly: true
                  ports:
                      - name: http
                        containerPort: 8080
                        protocol: TCP
                      - name: https
                        containerPort: 4443
                        protocol: TCP
                  livenessProbe:
                      failureThreshold: 1
                      httpGet:
                          path: /health
                          scheme: HTTPS
                          port: https
                  readinessProbe:
                      httpGet:
                          path: /health
                          scheme: HTTPS
                          port: https
                  resources:
                    limits:
                      cpu: 1
                      memory: 128Mi
                    requests:
                      cpu: 0
                      memory: 16Mi
            volumes:
                - name: tls
                  secret:
                      secretName: my-release-git-clone-operator
---
# Source: git-clone-operator/templates/mutatingwebhookconfiguration.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
    name: my-release-git-clone-operator
    namespace: default
    labels:
        helm.sh/chart: git-clone-operator-v1.1-alpha3
        app.kubernetes.io/name: git-clone-operator
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/version: "v1.1-alpha3"
        app.kubernetes.io/managed-by: Helm
webhooks:
    - name: my-release-git-clone-operator.default.svc.cluster.local
      failurePolicy: Fail
      objectSelector:
          matchLabels:
              riotkit.org/git-clone-operator: "true"
      rules:
          - apiGroups: [""]
            apiVersions: ["v1"]
            operations: ["CREATE"]
            resources: ["pods"]
            scope: "*"
      clientConfig:
          service:
              namespace: default
              name: my-release-git-clone-operator
              path: /mutate-pods
              port: 4443
          caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURQekNDQWllZ0F3SUJBZ0lRT01yRjE0N2pxK1R4N25LbkR2VG04akFOQmdrcWhraUc5dzBCQVFzRkFEQXEKTVNnd0pnWURWUVFERXg5bmFYUXRZMnh2Ym1VdGIzQmxjbUYwYjNJdFlXUnRhWE56YVc5dUxXTmhNQjRYRFRJMApNRFl4TmpBd01qZ3dORm9YRFRNME1EWXhOREF3TWpnd05Gb3dLakVvTUNZR0ExVUVBeE1mWjJsMExXTnNiMjVsCkxXOXdaWEpoZEc5eUxXRmtiV2x6YzJsdmJpMWpZVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0MKQVFvQ2dnRUJBTUY2MXBER3oycWkrVVRMQ05lc1VBZTUvMmhQNExldzNVcWRjUXBrbS8wL3ZrUlgxR0dkdVNWQgpBZHVDYWtRWXMvM3JmaW1md09KYXk2OGhQRFp2UWM5K2tMTWRUdXhZaTU5RGNjeVFQOE0zVnpUcU1RWHdRclROCkRHVitwRDJyZll4TzFiSjZlbWx3NTFFOTNVQWtTdERaRlV4U283QkhOYWdrNnVNb05mUXVFbVdPMWxxSDZIczgKZE5SdkU1RDBVVDQxdTBSdGRzNzVyanBkRURQMEgvMjlCalN0bEhSbU5VZEx6bElmK2ZoWUhuN0hzanQvRGVWMAp3UlQ2QkZOdTI5SUFwYTF1Nzd4bHE2UHFrdmhLSTdkU3Vpc0ppZER1RXlYT1ZhdWMzL1k1azVqUTkzRlVLWTF5CkpkcUlwU1B3Q240VEFvSFI1aDN3ZGk4RTVsUDhuN01DQXdFQUFhTmhNRjh3RGdZRFZSMFBBUUgvQkFRREFnS2sKTUIwR0ExVWRKUVFXTUJRR0NDc0dBUVVGQndNQkJnZ3JCZ0VGQlFjREFqQVBCZ05WSFJNQkFmOEVCVEFEQVFILwpNQjBHQTFVZERnUVdCQlI5dHMveUZ4VTZUZjNPbEo4b2ZmQ1BLdktIbERBTkJna3Foa2lHOXcwQkFRc0ZBQU9DCkFRRUFrMTBLNldKdnlJQkE0eUxpVCtaWGVzRTBmNmlIN1N4b094V3ZHMnVHYzZGbjE4ZHMzWVo2WWg4SU9CVG8KTkRWWTd2SjhCcEx3MXRKYWhmK2VBTndud1B4aXJDNnEyaFR2RzdOUEZOMUFTbllvejN6c2EzUnl2MExaUlEvcwpvWG1ZVEtsNFZYS2k3d1pRUktVeFJGM24ybVBCZWRwMUdhVzczTmpUZkhoNlB1cTZNbXF6ZHRCcERhL0xBZEczClNQQUlKeGNZNUJFdHJNTXFIU2JJMndUTVAvT0llMkE4ZVFFamtNTFlsWHRtTHduRkVaZ09vdlVSaW0zSlFpMSsKa2wwQ0FQSGowaXZESC9UNDlMVi8zYlkvU3UrK2g5VXp6azZVeWxQTzh4L1cxN0VGOUV2T0c0ekI3Vmo5UXJsSwpUd3V1WVAzdGJ2Qk1PTkQwbFV2TXVkMGhJZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      admissionReviewVersions: ["v1"]
      sideEffects: NoneOnDryRun
      timeoutSeconds: 2
